# 1. Giá»›i thiá»‡u

**Audition** - Má»™t tá»±a game online má»—i khi nháº¯c tá»›i thÃ¬ Ä‘áº¡i Ä‘a sá»‘ tháº¿ há»‡ **8x** vÃ  **9x** Ä‘á»i Ä‘áº§u sáº½ báº¥t chá»£t cÃ³ cáº£m giÃ¡c bá»“i há»“i, xao xuyáº¿n vá»›i bao nhiÃªu ká»‰ niá»‡m Ã¹a vá» ğŸ˜ŠğŸ˜ŠğŸ˜Š LÃ  tháº¿ há»‡ giá»¯a 9x nhÆ°ng may sao ngÃ y bÃ©, mÃ¬nh Ä‘Æ°á»£c cÃ¡c Ã´ng anh dáº«n Ä‘i NET cá» Ä‘Æ°a mÃ¬nh vÃ o con Ä‘Æ°á»ng nghiá»‡n game online ngÃ y áº¥y... ğŸ˜ƒ

![image.png](https://images.viblo.asia/e133c05d-9102-44c3-8e45-d31ca3f86ece.png)

MÃ¬nh chÆ¡i Audition tá»« hÃ¨ 2006 ( lá»›p 5, lá»›p 6 ) vá»›i biáº¿t bao ká»‰ niá»‡m Ä‘áº¹p vá» tá»±a game nÃ y. LÃªn 2009 thÃ¬ quen em - hai Ä‘á»©a cÃ¹ng chÆ¡i Audition vÃ  quen táº¡i quÃ¡n net. Em - top xinh trong trÆ°á»ng lÃºc báº¥y giá». Biáº¿t bao ká»‰ niá»‡m Ä‘áº¡p xe Ä‘i chÆ¡i tá»‘i, trá»‘n há»c ra net nháº£y Audition. Láº§n nÃ o trá»‘n tiáº¿t ra xong Ä‘áº¿n lÃºc vÃ o lá»›p, mÃ¬nh cÅ©ng pháº£i hÃ´n 1 cÃ¡i khiáº¿n bá»n lá»›p lá»›n hÆ¡n nhÃ¬n choÃ¡ng :D YÃªu 5,6 nÄƒm thÃ¬ chia tay. QuÃ¡ nhiá»u ká»‰ niá»‡m tá»« kÃªnh itv, Ä‘áº¿n Ola, Avatar... ká»ƒ ra thÃ¬ cáº£ quyá»ƒn. GiÃ¡ mÃ  cÃ³ thá»ƒ yÃªu nhau Ä‘áº¿n cuá»‘i thÃ¬ Ä‘áº¹p... :'(

VÃ¬ Ä‘á»ƒ thoáº£ mÃ£n cÃ¡i ká»‰ niá»‡m Ä‘áº¹p Ä‘áº½, ngÃ¢y ngÃ´ ngÃ y áº¥y cá»§a tuá»•i tráº», mÃ¬nh sáº½ ra má»™t series xÃ¢y dá»±ng cÃ¡c chá»©c nÄƒng cá»§a tá»±a game nÃ y ğŸ˜ƒ á» bÃ i viáº¿t pháº§n 1 nÃ y mÃ¬nh sáº½ lÃ m cÃ¡c chá»©c nÄƒng cÆ¡ báº£n cá»§a game Ä‘á»ƒ cÃ³ thá»ƒ chÆ¡i: Nháº£y 4K, 4K cÃ³ del, load nháº¡c, tÃ­nh Ä‘iá»ƒm... Dá»± Ä‘á»‹nh mÃ¬nh sáº½ dÃ¹ng JavaScript ( not NodeJS nha ğŸ˜†) Ä‘á»ƒ build game. MÃ¬nh hi vá»ng sáº½ Ä‘Æ°á»£c sá»± Ä‘Ã³n nháº­n, pháº£n há»“i tá»« má»i ngÆ°á»i Ä‘á»ƒ game Ä‘Æ°á»£c tá»‘t vÃ  nhiá»u chá»©c nÄƒng hÆ¡n ğŸ˜˜

# 2. Cáº¥u trÃºc project

![image.png](https://images.viblo.asia/12f3c87c-f5e2-46f1-91a9-a4f94101a80f.png)

- **images**: ThÆ° má»¥c sáº½ lÆ°u cÃ¡c hÃ¬nh áº£nh cá»§a trÃ² chÆ¡i : PhÃ­m báº¥m, áº£nh ná»n,...
- **js**: ThÆ° má»¥c chá»©a cÃ¡c file JavaScript Ä‘á»ƒ xá»­ lÃ½ cÃ¡c chá»©c nÄƒng cá»§a game.
- **musics**: ThÆ° má»¥c lÆ°u cÃ¡c bÃ i hÃ¡t cá»§a trÃ² chÆ¡i. NgÆ°á»i chÆ¡i sáº½ Ä‘Æ°á»£c lá»±a chá»n trong list nÃ y.

# 3. Xá»­ lÃ½ trÃ² chÆ¡i cho chá»©c nÄƒng nháº£y 4K

- **audition.html**: File nÃ y chá»©a giao diá»‡n cá»§a trÃ² chÆ¡i ( MÃ¬nh khÃ´ng pháº£i dÃ¢n chuyÃªn Front-end nÃªn html, css khÃ´ng tá»‘t láº¯m nÃªn cÃ¡c báº¡n cá»‘ gáº¯ng bá» qua nha ğŸ˜ƒğŸ˜ƒğŸ˜ƒ ) Cáº¥u trÃºc cÅ©ng tÆ°Æ¡ng tá»± nhÆ° cÃ¡c html bÃ¬nh thÆ°á»ng: CÃ³ **Html, Css** vÃ  nhÃºng **JavaScript** Ä‘á»ƒ xá»­ lÃ½.

![image.png](https://images.viblo.asia/456b7048-8f16-4671-9bc8-0b54a3154358.png)

- **constants.js**: File nÃ y lÆ°u cÃ¡c biáº¿n háº±ng sá»‘ trong trÃ² chÆ¡i: VÃ­ dá»¥ danh sÃ¡ch cÃ¡c key nháº£y, level max,...

```javascript
// Const variable
const MAX_LEVEL = 11
const MIN_COUNT_TO_PLAY = 5
const LIST_KEY_HAS_REVERSE = ["right", "up", "down", "left", "right-reverse", "up-reverse", "down-reverse", "left-reverse"]
const LIST_KEY = ["right", "up", "down", "left"]
const MAP_KEY = new Map([["right", "right"], ["up", "up"], ["down", "down"], ["left", "left"], ["right-reverse", "left"], ["up-reverse", "down"], ["down-reverse", "up"], ["left-reverse", "right"],])
```

- **main.js**: File xá»­ lÃ½ chÃ­nh cÃ¡c tÃ¡c vá»¥, chá»©c nÄƒng trong game. Hiá»‡n táº¡i, trÃ² chÆ¡i chá»‰ cÃ³ vÃ i chá»©c nÄƒng nÃªn mÃ¬nh sáº½ viáº¿t gá»™p vÃ o Ä‘Ã¢y ğŸ˜ƒğŸ˜ƒğŸ˜ƒ khi nÃ o Ä‘i qua tá»«ng chá»©c nÄƒng mÃ  file to quÃ¡ mÃ¬nh sáº½ refactor tÃ¡ch nhá» dáº§n. NÃ o xem file nÃ y chÃºng ta sáº½ pháº£i xá»­ lÃ½ logic gÃ¬ nÃ o. GÃ©t gÃ´...

**Variable** cÃ¡c biáº¿n cáº§n cÃ³

```javascript
let audio = new Audio() // Khá»Ÿi táº¡o audio Ä‘á»ƒ xá»­ lÃ½ nháº¡c
let isReverse = false // Kiá»ƒm tra xem ngÆ°á»i chÆ¡i cÃ³ báº­t nháº£y ngÆ°á»£c phÃ­m hay khÃ´ng?
let isSpaced = false // Kiá»ƒm tra ngÆ°á»i chÆ¡i Ä‘Ã£ áº¥n space Ä‘á»ƒ nháº£y chÆ°a?
let increase = 1 // Tá»‘c Ä‘á»™ cháº¡y cá»§a box trÃªn thanh progress bar
let pos = 0 // Vá»‹ trÃ­ cá»§a box trÃªn thanh progress bar
let count = 0 // Sá»‘ láº§n box vÆ°á»£t quÃ¡ thanh progress bar
let countToIncreaseLevel = 0 // Sá»‘ láº§n count Ä‘á»ƒ tÄƒng level chÆ¡i
let score = 0 // Äiá»ƒm ngÆ°á»i chÆ¡i
let level = 1 // Level hiá»‡n táº¡i
let listKeyRandom = [] // Danh sÃ¡ch key generate random
let listKeyPress = [] // Danh sÃ¡ch key ngÆ°á»i chÆ¡i nháº­p
const boxElement = document.getElementById("box") // Box element trong html
let picElement = document.getElementById("pic") // áº¢nh trong html
let scoreElement = document.getElementById("score") // Äiá»ƒm trong html
let intervalID = setInterval(move, 0)  // Id interval
```

**Show, hide, set key** theo id element

```javascript
// Hiá»‡n pháº§n tá»­ trÃªn html theo id
function show(id) {
    document.getElementById(id).style.display = 'block'
}

// áº¨n pháº§n tá»­ trÃªn html theo id
function hide(id) {
    document.getElementById(id).style.display = 'none'
}

// Hiá»ƒn thá»‹ áº£nh phÃ­m báº¥m theo key vÃ  id element
function setKey(key, id) {
    document.getElementById(id).src = "images/" + key + ".png"
}
```

**compareKeyPressAndRandom**: So sÃ¡nh danh sÃ¡ch key ngÆ°á»i chÆ¡i báº¥m cÃ³ báº±ng vá»›i danh sÃ¡ch key random theo tá»«ng level khÃ´ng?

```javascript
function compareKeyPressAndRandom(key) {
    if (listKeyPress.length === listKeyRandom.length) {
        return
    }

    if (MAP_KEY.get(listKeyRandom[listKeyPress.length]) === key && !isReverse) {
        listKeyPress.push(key + "-success")
        setKey(key + "-success", listKeyPress.length)
    } else if (MAP_KEY.get(listKeyRandom[listKeyPress.length]) === key && isReverse) {
        listKeyPress.push(key + "-success")
        setKey(key + "-success", listKeyPress.length)
    } else {
        listKeyPress = []
        for (let i = 0; i < listKeyRandom.length; i++) {
            setKey(listKeyRandom[i], i + 1)
        }
    }
}
```

**getListKey**: Láº¥y ra danh sÃ¡ch key theo level Ä‘Æ°á»£c random theo list key. VÃ­ dá»¥ 4K thÃ¬ **listRandom = ["right", "up", "down", "left"]**

```javascript
function getListKey(level, listRandom) {
    let list = []
    Array.prototype.random = function () {
        return this[Math.floor((Math.random() * this.length))];
    }
    for (let i = 0; i < level; i++) {
        list.push(listRandom.random())
    }
    return list
}
```

**resetKeyRandom, resetListKeyPress**: Táº¡o láº¡i danh sÃ¡ch key random vÃ  key mÃ  ngÆ°á»i chÆ¡i báº¥m

```javascript
function resetKeyRandom() {
    for (let i = 1; i <= 11; i++) {
        document.getElementById(i.toString()).src = ""
    }
}

function resetListKeyPress() {
    listKeyPress = []
}
```

**setScore**: Set láº¡i Ä‘iá»ƒm má»—i khi ngÆ°á»i chÆ¡i báº¥m phÃ­m vÃ  sau Ä‘Ã³ cÄƒn box Ä‘á»ƒ space -> CÃ³ cÃ¡c kiá»ƒu : Perfect, Great, Cool, Bad, Miss cÃ³ cÃ¡c vá»‹ trÃ­ trÃªn thanh bar vÃ  giáº£m dáº§n Ä‘iá»ƒm theo thá»© tá»±.

```javascript
function setScore(pos) {
    if (listKeyPress.length !== listKeyRandom.length) {
        picElement.src = "images/Miss.png"
        return
    }
    if (840 <= pos && pos <= 860) {
        picElement.src = "images/Perfect.png"
        score += isReverse ? 1200 : 800
    } else if ((790 <= pos && pos < 840) || (860 < pos && pos <= 910)) {
        picElement.src = "images/Great.png"
        score += isReverse ? 600 : 350
    } else if ((760 <= pos && pos < 790) || (910 < pos && pos <= 940)) {
        picElement.src = "images/Cool.png"
        score += isReverse ? 350 : 150
    } else if ((750 <= pos && pos < 760) || (940 < pos && pos <= 950)) {
        picElement.src = "images/Bad.png"
        score += isReverse ? 200 : 50
    } else {
        picElement.src = "images/Miss.png"
    }
    scoreElement.textContent = score
}
```

**move**: Function nÃ y xá»­ lÃ½ sá»± kiá»‡n cho khá»‘i box di chuyá»ƒn

```javascript
function move() {
    if (pos > 1150) {
        pos = 0
        count++
        if (count >= MIN_COUNT_TO_PLAY) {
            resetKeyRandom()
            setTimeout(function () {
                listKeyRandom = isReverse ? getListKey(level, LIST_KEY_HAS_REVERSE) : getListKey(level, LIST_KEY)
                console.log(listKeyRandom)
                for (let i = 0; i < listKeyRandom.length; i++) {
                    setKey(listKeyRandom[i], i + 1)
                }
            }, 1000)
        }
        if (count >= MIN_COUNT_TO_PLAY && countToIncreaseLevel % 1 === 0) {
            level++
        }
        if (level > MAX_LEVEL) {
            level = 1;
        }
        if (count > MIN_COUNT_TO_PLAY && !isSpaced) {
            countToIncreaseLevel++
            picElement.src = "images/Miss.png"
            resetListKeyPress()
            hide("box")
            setTimeout(function () {
                show("box")
                pos = 0
            }, 3000)
        }
    }

    pos += increase
    boxElement.style.left = pos + "px"
}
```

**Xá»­ lÃ½ sá»± kiá»‡n má»—i khi ngÆ°á»i chÆ¡i báº¥m phÃ­m**

```javascript
document.body.onkeyup = function (e) {
    if (e.code === "Space" && count >= MIN_COUNT_TO_PLAY) {
        isSpaced = true
        setScore(pos)
        hide("box")
        resetListKeyPress()
        setTimeout(function () {
            show("box")
            pos = 0
            isSpaced = false
        }, 3000)
        countToIncreaseLevel++
    }

    // Key dance
    if (e.code === "ArrowUp") {
        compareKeyPressAndRandom("up")
    }
    if (e.code === "ArrowDown") {
        compareKeyPressAndRandom("down")
    }
    if (e.code === "ArrowRight") {
        compareKeyPressAndRandom("right")
    }
    if (e.code === "ArrowLeft") {
        compareKeyPressAndRandom("left")
    }

    // Key turn on, turn off reverse
    if (e.code === "NumpadDecimal") {
        isReverse = !isReverse
        if (isReverse) {
            document.getElementById("reverse").textContent = "Reverse"
            show("reverse")
        } else {
            hide("reverse")
        }
    }
}
```

**initAudio**: Khá»Ÿi táº¡o Ä‘á»‘i tÆ°á»£ng audio Ä‘á»ƒ xá»­ lÃ½ nháº¡c trong game vÃ  xá»­ lÃ½ phÃ¡t nháº¡c má»—i khi ngÆ°á»i chÆ¡i thay Ä‘á»•i trÃªn list.

```javascript
function initAudio() {
    clearInterval(intervalID)
    let ext, plist
    ext = ".mp3"

    plist = document.getElementById("list-music")
    plist.addEventListener("change", changeTrack)

    function changeTrack(event) {
        audio.src = "musics/" + event.target.value + ext
        audio.play()
        intervalID = setInterval(move, 0)
        initVariable()
    }
}

window.addEventListener("load", initAudio)
```

**Báº¯t sá»± kiá»‡n má»—i khi bÃ i nháº¡c káº¿t thÃºc**: Khi Ä‘Ã³ chÃºng ta sáº½ thÃ´ng bÃ¡o Ä‘iá»ƒm cho ngÆ°á»i chÆ¡i vÃ  init láº¡i cÃ¡c variable láº¡i tá»« Ä‘áº§u

```javascript
audio.onended = function () {
    clearInterval(intervalID)
    alert("ChÃºc má»«ng báº¡n Ä‘Ã£ Ä‘áº¡t: " + score + " Ä‘iá»ƒm")
    initVariable()
    scoreElement.textContent = "0"
}
```

# 4. Káº¿t luáº­n

Äá»ƒ lÃ m 1 con game audition cÃ³ cÃ¡c chá»©c nÄƒng cÆ¡ báº£n cÅ©ng khÃ´ng khÃ³ láº¯m pháº£i khÃ´ng cÃ¡c báº¡n ğŸ˜ƒğŸ˜ƒğŸ˜ƒ HÃ£y cÅ©ng táº­n hÆ°á»Ÿng thÃ nh quáº£ nÃ o -> Video dÆ°á»›i Ä‘Ã¢y lÃ  demo chá»— Ä‘oáº¡n code nÃ y :D

{@embed: https://www.youtube.com/embed/MwCteIDIZNk}

- Website game : https://audition-js.herokuapp.com/audition.html
- Source code : https://github.com/nguyenvantuan2391996/audition-js