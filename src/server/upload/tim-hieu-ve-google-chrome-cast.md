# 1. Chromecast lÃ  gÃ¬.

Pháº§n bÃ i viáº¿t nÃ y giÃ nh cho cÃ¡c báº¡n viáº¿t á»±ng cÃ³ liÃªn quan Ä‘áº¿n Video, Audio vÃ  cÃ¡c á»©ng dá»¥ng liÃªn quan Ä‘áº¿n Ä‘a phÆ°á»£ng tiá»‡n.

Láº§n Ä‘áº§u tiÃªn Chromecast Ä‘Æ°á»£c gá»›i thiá»‡u vÃ o nÄƒm 2013 táº¡i US. Ngay tá»« phiÃªn báº£n Ä‘áº§u tiÃªn Google thiáº¿t káº¿ ChromeCast nháº±m Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch vá»›i cÃ¡ch á»©ng dá»¥ng cá»§a bÃªn thá»© 3, má»¥c Ä‘Ã­ch táº¡o ra ban Ä‘áº§u lÃ  báº¡n cÃ³ thá»ƒ truyá»n dáº«n, chia sáº» táº¥t cáº£ má»i thá»© lÃªn cÃ¡c thiáº¿t bá»‹ TV cá»§a báº¡n, nhÆ°ng cÃ ng vá» sau thÃ¬ cÃ¡c phiÃªn báº£n káº¿ nhiÃªm vÃ  cáº£ phiÃªn báº£n cuá»‘i cÃ¹ng thÃ¬ nÃ³ Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t káº¿ nghiÃªng háº³n vá» cÃ¡c á»©ng dá»¥ng Ä‘a phÆ°Æ¡ng tiá»‡n.

Äáº§u tiÃªn cÃ¡c báº¡n cáº©n tÃ¬m hiá»ƒu vá» `cast technology` lÃ  gÃ¬ vÃ  cÃ¡ch thá»©c nÃ³ hoáº¡t Ä‘á»™ng nhÆ° tháº¿ nÃ o trÆ°á»›c khi báº¡n tÃ¬m hiá»ƒu sÃ¢u hÆ¡n vá» cÃ¡ch triá»ƒn khai nÃ³.

Äiá»u quan trá»ng báº¡n cáº§n hiá»ƒu lÃ  cÃ¡c á»©ng dá»¥ng `Chromecast` khÃ´ng Ä‘á»c thÃ´ng tin trá»±c tiáº¿p tá»« á»©ng dá»¥ng cá»§a báº¡n. NÃ³ giao tiáº¿p vá»›i á»©ng dá»¥ng cá»§a báº¡n thÃ´ng qua 1 `Socket`. `Socket` Ä‘Ã³ Ä‘Æ°á»£c má»Ÿ khi á»©ng dá»¥ng cá»§a báº¡n yÃªu cáº§u thiáº¿t láº­p 1 cáº§u truyá»n dáº«n thÃ´ng tin tá»›i cÃ¡c Android TV hoáº·c cÃ¡c thiáº¿t bá»‹ `Chromecast` Ä‘áº·c thÃ¹.

![](https://images.viblo.asia/d224e153-d786-420e-99f4-53d16590483b.png)

Khi báº¡n cáº§n â€œCast onâ€¦â€  tá»« 1 á»©ng dá»¥ng gá»­i (á»Ÿ Ä‘Ã¢y mÃ¬nh gá»i táº¡m lÃ  sender app) thÃ¬ tháº­t ra lÃ  báº¡n Ä‘ang nÃ³i vá»›i `cast device` lÃ  má»Ÿ 1 trang web tÄ©nh, vÃ  á»©ng dá»¥ng web tÄ©nh Ä‘Ã³ Ä‘Æ°á»£c gá»i lÃ  `receiver app`. Bá»™ á»©ng dá»¥ng `receiver app` nÃ y Ä‘Æ°á»£c lÆ°u trá»¯ online vÃ  nÃ³ sáº½ Ä‘Æ°á»£c táº£i vá» khi nháº­n Ä‘Æ°á»£c yÃªu cáº§u káº¿t ná»‘i tá»« thiáº¿t bá»‹ `sender app`.

Google khuyáº¿n nghá»‹ báº¡n lÃ  cÃ¡c á»©ng dá»¥ng cÃ³ káº¿t ná»‘i vá»›i thiáº¿t bá»‹ `receiver app` tá»‘t nháº¥t lÃ  khi cáº£ 2 cÃ¹ng sá»­ dá»¥ng chung máº¡ng Wifi. VÃ¬ thá»±c cháº¥t `Sokcet`  sáº½ Ä‘Æ°á»£c má»Ÿ vÃ  truyá»n dáº«n dá»¯ liá»‡u thÃ´ng qua 1 cÃ¡i gá»i lÃ  `Wi-Fi Direct`, má»™t Ä‘á»‹nh nghÄ©a vá» 1  giao thá»©c truyá»n dáº«n ngang hÃ ng giá»¯a cÃ¡c thiáº¿t bá»‹ cÃ¹ng chung 1 káº¿t ná»‘i máº¡ng Wifi.

Oke ngÆ°ng táº¡m luyÃªn thuyÃªn vá» lÃ½ thuyáº¿t 1 chÃºt, giá» chung ta sáº½ báº¯t Ä‘áº§u tá»«ng chÃºt 1 Ä‘á»ƒ biáº¿t cÃ¡c táº¡o ra 1 á»©ng dá»¥ng ChromeCast vÃ  cÃ¡ch chia sáº» thÃ´ng tin thÃ´ng qua á»©ng dá»¥ng ChromeCast Ä‘Ã³. Äá»ƒ lÃ m Ä‘Æ°á»£c viá»‡c Ä‘Ã³ thÃ¬ cÃ¡c báº¡n cáº§n lÃ m cÃ¡c cÃ´ng viá»‡c theo thá»© tá»± sau.

- ÄÄƒng kÃ½ **Cast Develop** vá»›i Google
- Táº¡o liÃªn káº¿t **ChromeCast** tá»›i tÃ i khoáº£n **Cast Develop**.
- Khai bÃ¡o á»©ng dá»¥ng **receiver app**
- Thiáº¿t láº­p vÃ  cáº¥u hÃ¬nh **receiver app**
- Thiáº¿t láº­p vÃ  cáº¥u hÃ¬nh **sender app**

"CÃ¡c bÆ°á»›c trÃªn lÃ  theo kinh nghiá»‡m mÃ¬nh tá»•ng há»£p ra, chá»© chÆ°a cháº¯c 1 á»©ng dá»¥ng Ä‘Ã£ cáº§ tráº£i qua Ä‘áº§y Ä‘á»§ cÃ¡c bÆ°á»›c trÃªn Ä‘Ã¢u nhÃ©"
 
 NÃ o bÃ¢y giá» chÃºng ta sáº½ Ä‘i tÃ¬m hiá»ƒu tá»«ng bÆ°á»›c Ä‘á»ƒ cÃ³ thá»ƒ táº¡o ra 1 á»©ng dá»¥ng cÃ³ Ã¡p dá»¥ng cÃ´ng nghá»‡ ChromeCast hoÃ n chá»‰nh.
 
#  2. Register a dev account
Äá»ƒ hoÃ n táº¥t bÆ°á»›c nÃ y, trÆ°á»›c háº¿t báº¡n cáº§n pháº£i cÃ³ 2 thá»©.

```
- A Google Account
- A credit card ğŸ’°
```

KhÃ´ng giá»‘ng vá»›i cÃ¡c dá»‹ch vá»¥ khÃ¡c  cá»§a Google thuá»ng lÃ  miá»…n phÃ­ cho Deverlop nhÆ°ng dá»‹ch vá»¥ **Chromecast**  sáº½ cáº§n 5$ Ä‘á»ƒ Ä‘Äƒng kÃ½, Ä‘Ã³ lÃ  lÃ½ do táº¡i sao cho dÃ¹ báº¡n chá»‰ lÃ  Deverlop nhá»¯ng Ä‘á»ƒ phÃ¡t triá»ƒn "dÃ¹ cÃ³ lÃ  thá»­ nghiá»‡m" thÃ¬ báº¡n váº«n cáº§n 1 tháº» **credit card** vá»›i tá»‘i thiá»ƒu 5$ trong Ä‘Ã³ :D.

Äáº§u tiá»n báº¡n sáº½ cáº§n truy cáº­p vÃ o [link Ä‘á»ƒ cÃ³ thá»ƒ Ä‘Äƒng kÃ½ tÃ i khoáº£n phÃ¡t triá»ƒn](https://cast.google.com/publish/#/signup), sau khi Ä‘Äƒng kÃ½ xong thÃ¬ báº¡n sáº½ Ä‘Æ°á»£c chuyá»ƒn tiáº¿p Ä‘á»ƒ trang `Google Cast SDK Developer Console`

![](https://images.viblo.asia/06bca13f-8439-4951-ad4e-32523fcb200d.png)

Táº¡i Ä‘Ã¢y báº¡n báº¡n sáº½ cáº§n thiáº¿t láº­p cÃ¡c thÃ´ng tin vá» á»©ng dá»¥ng **sender app** trong pháº§n **Applications** vÃ  **receiver app** trong pháº§n **Cast Receiver Devices** "tháº­t ra mÃ¬nh tháº¥y cÃ¡i `Cast Receiver Devices` nÃ y cÃ³ nhiá»u tÃ¡c dá»¥ng cho viá»‡c Debug hÆ¡n lÃ  viá»‡c cung cáº¥p sáº£n pháº©m tá»›i ngÆ°á»i dÃ¹ng sau nÃ y"


# 3. LiÃªn káº¿t thiáº¿t bá»‹ ChromeCast vá»›i tÃ i khoáº£n Develop

Click on **ADD NEW DEVICE**  táº¡i Ä‘Ã¢y báº¡n cáº§n Ä‘iá»n sá»‘ **Serial Number** á»Ÿ máº·t sau cá»§a thiáº¿t bá»‹ **ChromeCast**, viá»‡c nÃ y chá»§ yáº¿u khai bÃ¡o Ä‘á»ƒ báº¡n cÃ³ thá»ƒ cháº¡y **receiver app** dÆ°á»›i cháº¿ Ä‘á»™ Debug trÃªn thiáº¿t bá»‹ Ä‘Æ°á»£c khai bÃ¡o.

Vá»›i 1 team size phÃ¡t triá»ƒn lá»›n thÃ¬ báº¡n cÃ³ thá»ƒ thÃªm 3 Ä‘áº¿n 4 thiáº¿t bá»‹ **ChromeCast** vÃ o Ä‘Ã¢y Ä‘á»ƒ phá»¥c vá»¥ cÃ´ng viá»‡c phÃ¡t triá»ƒn Ä‘Æ°á»£c thuáº­n lá»£i hÆ¡n.

# 4. Khai bÃ¡o á»©ng dá»¥ng Receiver App

Click on **ADD NEW APPLICATION**. Táº¡i Ä‘Ã¢y báº¡n cáº§n khai bÃ¡o 1 sá»‘ thÃ´ng tin quan trá»ng sau.

- Application ID, Nam cá»§a á»©ng dá»¥ng Android hay IOS **sender app**
- Link [**Custom Receiver**](https://developers.google.com/cast/docs/web_receiver), nÆ¡i báº¡n thiáº¿t káº¿ 1 web site Ä‘á»ƒ nháº­n dá»¯ liá»‡u tá»« **sender app**

Sau khi thiáº¿t láº­p hoÃ n chá»‰nh cÃ¡c bÆ°á»›c trÃªn thÃ¬ báº¡n sáº½ nháº­n Ä‘Æ°á»£c 1 dÃ£y kÃ½ tá»± cÃ³ tÃªn lÃ  **receiver_id** vÃ  **receiver_id** nÃ y sáº½ Ä‘Æ°á»£c cáº¥u hÃ¬nh trong **sender app** cá»§a báº¡n.

NÃ o nÃ o cÃ¹ng chÃº Ã½ tá»›i cÃ¡i gá»i lÃ  **Custom Receiver** 1 chÃºt. NÃ³ lÃ  1 trang web tÄ©nh nÆ¡i nháº­n dá»¯ liá»‡u Ä‘Æ°á»£c chia sáº» tá»« **sender app** vÃ  hiá»ƒn thá»‹ tá»›i ngÆ°á»i xem trÃªn thiáº¿t bá»‹ ChromeCast. Trang web nÃ y sáº½ Ä‘Æ°á»£c báº¡n tá»± viáº¿t vÃ  nÃ³ cáº§n Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn 1 hosting nÃ o Ä‘Ã³. 

Báº¡n cáº§n hiá»ƒu nÃ´m na Ä‘Æ¡n giáº£n nhÆ° tháº¿ nÃ y.  Khi thiáº¿t bá»‹ **ChromeCast** nháº­n Ä‘Æ°á»£c yÃªu cáº§u chia sáº» thÃ´ng tin tá»« **sender app** kÃ¨m 1 **receiver_id** thÃ¬ thiáº¿t bá»‹ sáº½ sá»­ dá»¥ng link báº¡n Ä‘Ã£ cáº¥u hÃ¬nh trong **Custom Receiver**  Ä‘á»ƒ load trang web Ä‘Ã³ vá» thiáº¿t bá»‹ vÃ  hiá»ƒn thá»‹ nÃ³ trÃªn thiáº¿t bá»‹ Ä‘áº§u cuá»‘i. 

ÄÃ³ lÃ  cÃ¡c bÆ°á»›c hoÃ n chá»‰nh cáº§n thiáº¿t láº­p trÃªn trang [Dev Account](https://cast.google.com/publish), tá»›i Ä‘Ã¢y báº¡n cÃ³ thá»ƒ táº¯t trang web nÃ y Ä‘i Ä‘Æ°á»£c rá»“i, nhÆ°ng mÃ  hÃ£y nhá»› dÃ£y kÃ½ tá»± cÃ³ tÃªn lÃ   **receiver_id** nhÃ©.


# 5.  Thiáº¿t láº­p vÃ  cáº¥u hÃ¬nh Receiver App

Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu **very simple receiver** táº¡i Ä‘Æ°á»ng dáº«n [CAF SDK](https://developers.google.com/cast/docs/web_receiver). Theo Ä‘á»‹nh nghÄ©a cá»§a Google thÃ¬ **Receiver App** sáº½ Ä‘áº£m nháº­n cÃ¡c nhiá»‡m vá»¥ sau.

- Cung cáº¥p `interface` Ä‘á»ƒ hiá»ƒn thá»‹ cÃ¡c ná»™i dung trÃªn thiáº¿t bá»‹ Ä‘áº§u cuá»‘i.
- Xá»­ lÃ½ cÃ¡c tin nháº¯n tá»« **sender app** Ä‘á»ƒ hiá»ƒn thá»‹ ná»™i dá»¥ng cho ngÆ°á»i xem trÃªn thiáº¿t bá»‹ nháº­n
- Xá»­ lÃ½ cÃ¡c thao tÃ¡c cá»§a ngÆ°á»i dÃ¹ng trÃªn thiáº¿t bá»‹ nháº­n vÃ  gá»­i tráº£ láº¡i thÃ´ng tin cho **sender app**

Vá» cÆ¡ báº£n lÃ  nÃ³ xá»­ lÃ½ má»i thÃ´ng tin thiá»ƒn thá»‹ trÃªn mÃ n hÃ¬nh cá»§a cá»§a thiáº¿t bá»‹ nháº­n. VÃ  dÆ°á»›i Ä‘Ã¢y lÃ  1 á»©ng dá»¥ng cÆ¡ báº£n cá»§a **Receiver App** 

```html
<!doctype html>
<html>
  <head>
    <title>Estimate It</title>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>

    <style>
    body {
      background: white;
      color: black;
    }

    #container {
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #content {
      font-family: 'Roboto', sans-serif;
      font-size: 6em;
    }
    </style>
  </head>
  <body>

    <div id="container">
      <span id="content">Waiting...</span>
    </div>

    <script src="//www.gstatic.com/cast/sdk/libs/caf_receiver/v3/cast_receiver_framework.js"></script>
    
    <script type="text/javascript">
        window.onload = function () {
          
          var ctx = cast.framework.CastReceiverContext.getInstance();
          var options = new cast.framework.CastReceiverOptions();
          var CHANNEL = 'urn:x-cast:com.github.quentin7b.estimateit';

          options.customNamespaces = Object.assign({});
          options.customNamespaces[CHANNEL] = cast.framework.system.MessageType.JSON;

          ctx.addCustomMessageListener(CHANNEL, function(customEvent) {
            var message = customEvent.data
            console.log("Message received from " + 
                        "[" +  customEvent.senderId +  "] " +
                        ": " + message);
            document.getElementById("content").innerHTML = message;
          });

          ctx.start(options);
        }
    </script>
  </body>
</html>
```

Pháº§n thiáº¿t káº¿ nÃ y mÃ¬nh cÅ©ng Ä‘i tham kháº£o, vÃ¬ mÃ¬nh lÃ  láº­p trÃ¬nh viÃªn Android hay ngáº¯n gá»n hÆ¡n mÃ¬nh lÃ  ngÆ°á»i láº­p trÃ¬nh cho **sender app** :D :D :D. Pháº§n nÃ y sáº½ giÃ nh cho cÃ¡c báº¡n chuyÃªn vá» HTML, CSS vÃ  JS nhiá»u hÆ¡n.

# 6. Thiáº¿t láº­p vÃ  cáº¥u hÃ¬nh Sender App

ToÃ n bá»™ pháº§n huá»›ng dáº«n chi tiáº¿t cá»§a Google báº¡n cÃ³ thá»ƒ [tham kháº£o táº¡i Ä‘Ã¢y](https://developers.google.com/cast/docs/android_sender/integrate)

Äáº§u tiÃªn báº¡n cáº§n khai bÃ¡o trong `build.gradle` cÃ¡c thÆ° viá»‡n cáº§n Ä‘á»ƒ sá»­ dá»¥ng cho **Sender App**

```Kotlin
    implementation 'androidx.appcompat:appcompat:1.1.0'
    implementation 'androidx.mediarouter:mediarouter:1.1.0'
    implementation 'com.google.android.gms:play-services-cast-framework:17.1.0'
```

Trong á»©ng dá»¥ng **Sender App** báº¡n cáº§n biáº¿t 2 pháº§n quan trá»ng sau Ä‘Ã¢y
- **OptionsProvider** Ä‘Ã¢y lÃ  Class giÃºp framework cÃ³ thá»ƒ káº¿t ná»‘i tá»›i **Receiver App** 
- **Activity** hoáº·c **Fragment** class sáº½ quáº£n lÃ½ giao tiáº¿p vÃ  hÃ nh Ä‘á»™ng liÃªn quan tá»›i á»©ng dá»¥ng  **Receiver App** 


## 6.1 OptionsProvider

Khá»Ÿi táº¡o class CastOptionsProvider káº¿ thá»«a tá»« [`OptionsProvider`](https://developers.google.com/android/reference/com/google/android/gms/cast/framework/OptionsProvider) cá»§a há»‡ thá»‘ng. DÆ°á»›i Ä‘Ã¢y sáº½ lÃ  pháº§n cáº¥u hÃ¬nh `CastOptionsProvider` cÆ¡ báº£n nháº¥t
```Kotlin
class CastOptionsProvider : OptionsProvider {
  override fun getCastOptions(ctx: Context): CastOptions {
    return CastOptions
             .Builder()
             .setReceiverApplicationId(
               ctx.getString(R.string.receiver_id)
             )
             .build()
  }

  override fun getAdditionalSessionProviders(ctx: Context) = null
}
```

VÃ  class `CastOptionsProvider` sáº½ cáº§n Ä‘Æ°á»£c khai trong trong file `manifest`
```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
  package="x.x.x">

  <application
    android:icon="@mipmap/ic_launcher"
    android:label="@string/app_name">

      <meta-data
        android:name="com.google.android.gms.cast.framework.OPTIONS_PROVIDER_CLASS_NAME"
        android:value="x.x.x.CastOptionsProvider" />
  </application>

</manifest>
```

Sau khi hoÃ n táº¥t báº¡n hÃ£y táº¡o 1 Activity vá»›i 2 sá»± kiá»‡n cÆ¡ báº£n nhÆ° sau.

- Hiá»ƒn thá»‹ nÃºt Cast vÃ  káº¿t ná»‘i tá»›i thiáº¿t bá»‹ Cast.
- Gá»­i 1 `message` tá»›i thiáº¿t bá»‹ Cast


## 6.2 Hiá»ƒn thá»‹ Button Cast

Hiá»ƒn thá»‹ trÃªn Menu cá»§a há»‡ thá»‘ng
```Kotlin
override fun onCreateOptionsMenu(menu: Menu?): Boolean {
        super.onCreateOptionsMenu(menu)
        Log.i("MainActivity", "onCreateOptionsMenu")

        /*
        <?xml version="1.0" encoding="utf-8"?>
           <menu xmlns:android="http://schemas.android.com/apk/res/android"
                 xmlns:app="http://schemas.android.com/apk/res-auto">
                <item
                    android:id="@+id/media_route_menu_item"
                    android:title="@string/cast"
                    app:actionProviderClass="androidx.mediarouter.app.MediaRouteActionProvider"
                    app:showAsAction="always" />
            </menu>
         */
        menuInflater.inflate(R.menu.estimate, menu)
        
        CastButtonFactory.setUpMediaRouteButton(getApplicationContext(), menu, R.id.media_route_menu_item)
        return true
    }
```

Hoáº·c hiá»ƒn thá»‹ trÃªn layout cá»§a á»©ng dá»¥ng

```xml
// activity_layout.xml
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
   android:layout_width="match_parent"
   android:layout_height="wrap_content"
   android:gravity="center_vertical"
   android:orientation="horizontal" >

   <android.support.v7.app.MediaRouteButton
       android:id="@+id/media_route_button"
       android:layout_width="wrap_content"
       android:layout_height="wrap_content"
       android:layout_weight="1"
       android:mediaRouteTypes="user"
       android:visibility="gone" />

</LinearLayout>
```

```Kotlin
// MyActivity.java
@Override
protected void onCreate(Bundle savedInstanceState) {
   super.onCreate(savedInstanceState)
   setContentView(R.layout.activity_layout)

   val mediaRouteButton = findViewById<MediaRouteButton>(R.id.media_route_button);
   CastButtonFactory.setUpMediaRouteButton(getApplicationContext(), mediaRouteButton)

   mCastContext = CastContext.getSharedInstance(this);
}
```

Báº¡n cÃ³ thá»ƒ tÃ¬m hiá»ƒu thÃªm vá» **Cast Button** [táº¡i Ä‘Ã¢y](https://developers.google.com/cast/docs/design_checklist/cast-button)

Sá»± kiá»‡n Click vÃ o **Cast Button** nÃ y Ä‘Ã£ Ä‘Æ°á»£c Google Ä‘á»‹nh nghÄ©a sáºµn bÃªn trong Framework. Khi báº¡n click vÃ o cast button thÃ¬ sáº½ cÃ³ 1 dialog hiá»ƒn thá»‹ danh sÃ¡ch cÃ¡c thiáº¿t bá»‹ ChromeCast cÃ³ cÃ¹ng chung máº¡ng Wifi vá»›i Ä‘iá»‡n thoáº¡i cá»§a báº¡n.

![](https://images.viblo.asia/07c656cb-1a67-43a5-b1e2-fb92f8227fab.png)

## 6.3 Gá»­i tin nháº¯n tá»›i thiáº¿t bá»‹ ChromeCast

```Kotlin
class MainActivity : AppCompatActivity() {

    private var castSession: CastSession? = null

    private val castContext by lazy { CastContext.getSharedInstance(baseContext) }

    private val nameSpace by lazy { baseContext.getString(R.string.namespace) }

    private var mediaSelector: MediaRouteSelector? = null
    private val sessionManagerListener = object : SessionManagerListener<CastSession> {
            override fun onSessionStarting(p0: CastSession?) {
            }

            override fun onSessionStarted(p0: CastSession?, p1: String?) {
                    castSession = p0
                    invalidateOptionsMenu()
            }

            override fun onSessionStartFailed(p0: CastSession?, p1: Int) {
            }

            override fun onSessionEnding(p0: CastSession?) {
  
            }

            override fun onSessionEnded(p0: CastSession?, p1: Int) {
                    if (pCastSession == castSession) {
                        cleanup()
                    }
                    invalidateOptionsMenu()
            }

            override fun onSessionResuming(p0: CastSession?, p1: String?) {
            }

            override fun onSessionResumed(p0: CastSession?, p1: Boolean) {
                    castSession = p0
                    invalidateOptionsMenu()
            }

            override fun onSessionResumeFailed(p0: CastSession?, p1: Int) {
            }

            override fun onSessionSuspended(p0: CastSession?, p1: Int) {
            }
    }

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        Log.i("MainActivity", "onCreate")
        setContentView(R.layout.activity_estimate)
        
        btn_send_message.setOnClickListener {
            castSession?.sendMessage(nameSpace, Random().nextInt(5).toString())
        }

        mediaSelector = MediaRouteSelector.Builder()
                // On ajoute les intents auxquels on va rÃ©pondre, ici c'est uniquement systemr
                .addControlCategory(MediaControlIntent.CATEGORY_REMOTE_PLAYBACK)
                // On spÃ©cifie notre app id
                .addControlCategory(CastMediaControlIntent.categoryForCast(baseContext.getString(R.string.receiver_id)))
                .build()
    }

    override fun onResume() {
        super.onResume()
        Log.i("MainActivity", "onResume")

        castContext.sessionManager.addSessionManagerListener(sessionManagerListener, CastSession::class.java)
        if (castSession == null) {
            castSession = castContext.sessionManager.currentCastSession
        }
    }

    override fun onPause() {
        Log.i("MainActivity", "onPause")

        castContext.sessionManager.removeSessionManagerListener(sessionManagerListener, CastSession::class.java)
        super.onPause()
    }

    override fun onStop() {
        cleanup()
        super.onStop()
    }

    private fun cleanup() {
        castSession = null
    }

}
```

Äáº§u tiÃªn hÃ£y Ä‘i tá»«ng bÆ°á»›c má»™t nÃ o.

```Kotlin
private val castContext by lazy { CastContext.getSharedInstance(baseContext) }
```

Khi báº¡n khai bÃ¡o á»©ng dá»¥ng cá»§a mÃ¬nh cÃ³ sá»­ dá»¥ng framework ChromeCast thÃ¬ Framework sáº½ táº¡o ra 1 `Instance` Ä‘á»ƒ sá»­ dá»¥ng chung cho toÃ n há»‡ thá»‘ng. Tá»©c lÃ  cÃ¡c dá»¥ng  khÃ¡c trong Ä‘iá»‡n thoáº¡i cá»§a báº¡n cÅ©ng cÃ³ tÃ­nh nÄƒng **ChromeCast** thÃ¬ cÅ©ng sáº½ sá»­ dá»¥ng chung `Instance`  cá»§a **CastContext** nÃ y. 

**CastContext** sáº½ chá»©a cÃ¡c **CastSession**  má»—i 1 Session nÃ y sáº½ thá»ƒ hiá»ƒn 1 liÃªn káº¿t tá»« thiáº¿t bá»‹ cá»§a báº¡n tá»›i 1 thiáº¿t bá»‹ **ChromeCast** cÃ¹ng chung trong 1 máº¡ng Wifi. 

Khi báº¡n liÃªn káº¿t thiáº¿t bá»‹ di Ä‘á»™ng cá»§  mÃ¬nh tá»›i 1 thiáº¿t bá»‹ **ChromeCast** thÃ¬ **CastContext** sáº½ táº¡o ra 1 **CastSession** riÃªng cho liÃªn káº¿t Ä‘Ã³, vÃ  báº¡n cÃ³ thá»ƒ láº¥y Session Ä‘Ã³ thÃ´ng qua cÃ¢u lá»‡nh

```Kotlin
castSession = castContext.sessionManager.currentCastSession
```

Khi 1 liÃªn káº¿t Ä‘Æ°á»£c thiáº¿t láº­p thÃ¬ chÃºng cÅ©ng cÃ³ vÃ²ng Ä‘á»i nhÆ° vÃ²ng Ä‘á»i cá»§a Activity hay Fragment váº­y Ä‘Ã³. ChÃºng ta sáº½ dá»±a trÃªn vÃ²ng Ä‘á»i cá»§a **CastSession** Ä‘á»ƒ biáº¿t khi nÃ o thiáº¿t bá»‹ cá»§a mÃ¬nh báº¯t Ä‘áº§u liÃªn káº¿t vÃ  chia sáº» thÃ´ng tin vá»›i thiáº¿t bá»‹ **ChromeCast**.

```Kotlin
// write code in onResume()
castContext.sessionManager.addSessionManagerListener(sessionManagerListener, CastSession::class.java)
```

vÃ  khi Fragment hay Activity call `onPause()` thÃ¬ cÃ¡c báº¡n hÃ£y remove Session Ä‘Ã³ Ä‘i.

```Kotlin
// write code in onPause()
castContext.sessionManager.removeSessionManagerListener(sessionManagerListener, CastSession::class.java)
```

CÃ¡c báº¡n chÃº Ã½ dÃ²ng code

```Kotlin
      btn_send_message.setOnClickListener {
            castSession?.sendMessage(nameSpace, Random().nextInt(5).toString())
        }
```

á»Ÿ Ä‘Ã¢y báº¯t sá»± kiá»‡n khi Click vÃ o 1 button vÃ  thá»±c hiá»‡n gá»­i 1 message lÃªn tá»›i thiáº¿t bá»‹ ChromeCast
- **nameSpace** Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a lÃ  "KhÃ´ng gian tÃªn cho tin nháº¯n" vÃ  cáº§n Ä‘Æ°á»£c báº¯t Ä‘áº§u báº±ng tiá»n tá»‘ "urn:x-cast:" vÃ  `nameSpace` nÃ y cÅ©ng sáº½ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÃªn **Receiver App** 
- **Random().nextInt(5).toString()** Ä‘Ã¢y lÃ  pháº§n ná»™i dung thÃ´ng tin mÃ  message gá»­i lÃªn **Receiver App**  Ä‘á»ƒ hiá»ƒn thá»‹ trÃªn thiáº¿t bá»‹ Ä‘áº§u cuá»‘i.


> Tá»›i Ä‘Ã¢y mÃ¬nh cÅ©ng Ä‘oÃ¡n lÃ  khÃ¡ nhiá»u báº¡n chÆ°a hÃ¬nh dÃ¹ng Ä‘Æ°á»£c cÆ¡ cháº¿ hoáº¡t Ä‘á»™ng giá»¯a **Sender App** vÃ  **Receiver App**.

CÃ¡c báº¡n cÃ³ thá»ƒ hiá»ƒu Ä‘Æ¡n giáº£n nhÆ° tháº¿ nÃ y.

- Khi ngÆ°á»i dÃ¹ng Click vÃ o **CastButton** thÃ¬ `Framework` sáº½ hiá»ƒn thá»‹ lÃªn 1 danh sÃ¡ch cÃ¡c thiáº¿t bá»‹ **ChromeCast** cÃ³ cÃ¹ng chung máº¡ng Wifi. NgÆ°á»i dÃ¹ng sau Ä‘Ã³ sáº½ lá»±a chá»n thiáº¿t bá»‹ mÃ¬nh muá»‘n káº¿t ná»‘i vÃ  chia sáº» thÃ´ng tin. 
- Khi ngÆ°á»i dÃ¹ng click chá»n 1 thiáº¿t bá»‹ Ä‘á»ƒ káº¿t ná»‘i thÃ¬ `Framework` sáº½ tá»± Ä‘á»™ng káº¿t ná»‘i tá»›i thiáº¿t bá»‹ Ä‘Ã³ vÃ  tráº£ vá»  thÃ´ng tin cho **Sender App** thÃ´ng qua **sessionManagerListener** vÃ  cÃ´ng viá»‡c cá»§a láº­p trÃ¬nh viÃªn cá»§a chÃºng ta lÃ  báº¯t cÃ¡c sá»± kiá»‡n trong **sessionManagerListener** Ä‘Ã³ Ä‘á»ƒ xá»­ lÃ½. 
- Táº¥t cáº£ cÃ¡c thÃ´ng tin mÃ  **Sender App** muá»‘n chia sáº» vá»›i **Receiver App** Ä‘á»u pháº£i thÃ´ng qua **castSession**. NhÆ° á»Ÿ vÃ­ dá»¥ trÃªn mÃ¬nh chá»‰ gá»­i 1 thÃ´ng tin khÃ¡ lÃ  Ä‘Æ¡n giáº£n tá»« á»©ng dá»¥ng Ä‘iá»‡n thoáº¡i tá»›i **Receiver App** Ä‘á»ƒ **Receiver App** hiá»ƒn thá»‹ tá»›i ngÆ°á»i xem.


BÃ i viáº¿t trÃªn mÃ¬nh Ä‘Ã£ giá»›i thiá»‡u vá»›i cÃ¡c báº¡n cÃ¡c Ä‘á»‹nh nghÄ©a cÆ¡ báº£n nháº¥t vá» **ChromeCast** vÃ  cÃ¡ch triá»ƒn khai 1 á»©ng dá»¥ng cÆ¡ báº£n cÃ³ tÃ­nh nÄƒng **ChromeCast**. Trong pháº§n sau mÃ¬nh sáº½ huá»›ng dáº«n chi tiáº¿t hÆ¡n tá»›i cÃ¡c báº¡n vá» 1 á»©ng dá»¥ng chia sáº» video tá»« Ä‘iá»‡n thoáº¡i lÃªn thiáº¿t bá»‹ TV thÃ´ng qua Framework **ChromeCast**.