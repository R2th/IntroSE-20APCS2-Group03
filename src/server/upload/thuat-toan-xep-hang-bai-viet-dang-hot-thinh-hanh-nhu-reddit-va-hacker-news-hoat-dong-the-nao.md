CÃ³ bao giá» báº¡n tá»± há»i, ngÆ°á»i ta lÃ m tháº¿ nÃ o Ä‘á»ƒ sáº¯p xáº¿p cÃ¡c bÃ i viáº¿t táº¡i trang chá»§, **má»¥c "hot"** cá»§a cÃ¡c trang tin nhÆ° *Reddit*, *Hacker News*, cÃ¡c trang giáº£i trÃ­ nhÆ° **má»¥c thá»‹nh hÃ nh** cá»§a *Youtube*, *9GaG*, *HÃ i Vá» Lá»*, *CÃ³ Ai Biáº¿t*,... Hay gáº§n gÅ©i nháº¥t Ä‘á»‘i vá»›i chÃºng ta lÃ  nhÆ° **má»¥c Trending** cá»§a *Viblo*? 

Khoan hÃ£y nghÄ© Ä‘áº¿n viá»‡c cÃ¡ nhÃ¢n hÃ³a ná»™i dung cho tá»«ng ngÆ°á»i dÃ¹ng hay Ã¡p dá»¥ng machine learning vÃ o viá»‡c xáº¿p háº¡ng. Trong bÃ i viáº¿t láº§n nÃ y, mÃ¬nh xin Ä‘Æ°á»£c cÃ¹ng cÃ¡c báº¡n tÃ¬m hiá»ƒu, phÃ¢n tÃ­ch vá» viá»‡c tÃ­nh Ä‘iá»ƒm, xáº¿p háº¡ng bÃ i viáº¿t Ä‘ang "hot" qua sá»­ dá»¥ng **thuáº­t toÃ¡n tÃ­nh Ä‘iá»ƒm** má»™t cÃ¡ch Ä‘Æ¡n giáº£n, thuáº§n tÃºy nháº¥t.

![Thuáº­t toÃ¡n xáº¿p háº¡ng bÃ i viáº¿t Ä‘ang hot, thá»‹nh hÃ nh nhÆ° Reddit vÃ  Hacker News](https://images.viblo.asia/34a9afc9-5ca4-4cf1-96b2-afb53a95ace3.jpg)

# Tá»•ng quan
TrÆ°á»›c háº¿t, báº¡n cáº§n xÃ¡c Ä‘á»‹nh xem **Ä‘áº·c thÃ¹ cá»§a há»‡ thá»‘ng/trang web cá»§a báº¡n lÃ  gÃ¬**, cáº§n viá»‡c xáº¿p háº¡ng cÃ¡c bÃ i viáº¿t táº¡i trang chá»§ nhÆ° tháº¿ nÃ o:
* Náº¿u há»‡ thá»‘ng cá»§a báº¡n **cung cáº¥p kiáº¿n thá»©c, giáº£i Ä‘Ã¡p** nhÆ° *Quora*, *StackOverFlow*: báº¡n cáº§n Æ°u tiÃªn viá»‡c cung cáº¥p thÃ´ng tin há»¯u Ã­ch nháº¥t cho ngÆ°á»i dÃ¹ng trÆ°á»›c tiÃªn, ná»™i dung cÅ© hay má»›i Ã­t quan trá»ng hÆ¡n. Quora vÃ  StackOverFlow Ä‘á»u xáº¿p háº¡ng nhá»¯ng cÃ¢u tráº£ lá»i cÃ³ lÆ°á»£t upvote - downvote cao nháº¥t lÃªn trÃªn Ä‘áº§u. Xáº¿p háº¡ng theo Ä‘á»™ "hot" sáº½ khÃ´ng há»¯u dá»¥ng láº¯m trong trÆ°á»ng há»£p nÃ y.
* Náº¿u há»‡ thá»‘ng cá»§a báº¡n lÃ  má»™t dáº¡ng **máº¡ng xÃ£ há»™i tin tá»©c, giáº£i trÃ­**: á»Ÿ trÃªn trang chá»§, báº¡n sáº½ cáº§n cung cáº¥p nhá»¯ng thÃ´ng tin má»›i máº», háº¥p dáº«n vá»›i sá»‘ Ä‘Ã´ng, háº¡n cháº¿ cÃ¡c thÃ´ng tin cÅ©, nhÃ m chÃ¡n. NhÆ° váº­y báº¡n cáº§n má»™t dáº¡ng thuáº­t toÃ¡n ranking tÃ­nh Ä‘iá»ƒm Ä‘á»ƒ sáº¯p xáº¿p bÃ i viáº¿t cho há»£p lÃ½. ÄÃ¢y lÃ  pháº§n mÃ¬nh sáº½ nháº¯m Ä‘áº¿n chá»§ yáº¿u trong bÃ i viáº¿t nÃ y.

CÃ²n dÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ yáº¿u tá»‘ mÃ  báº¡n cÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ tÃ­nh Ä‘iá»ƒm cho bÃ i viáº¿t:
* **LÆ°á»£t thÃ­ch/vote**: ÄÃ¢y lÃ  yáº¿u tá»‘ Ä‘Ã¡ng tin cáº­y nháº¥t, do thÆ°á»ng chá»‰ dÃ nh cho ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng kÃ½ tÃ i khoáº£n, cáº§n ngÆ°á»i dÃ¹ng thá»±c hiá»‡n hÃ nh Ä‘á»™ng cá»¥ thá»ƒ lÃ  báº¥m vÃ o nÃºt Like/(+) vÃ  má»—i ngÆ°á»i thÆ°á»ng chá»‰ vote/like Ä‘Æ°á»£c má»™t láº§n. TÃ¹y nÆ¡i mÃ  báº¡n chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c tháº£ tim/like, hay cÃ²n cÃ³ thá»ƒ dislike, hay downvote cÃ¡c bÃ i viáº¿t. LÆ°á»£t thÃ­ch/vote cÃ ng cao, Ä‘Æ°Æ¡ng nhiÃªn Ä‘iá»ƒm pháº£i cÃ ng cao.
* **Thá»i gian bÃ i viáº¿t Ä‘Æ°á»£c Ä‘Äƒng**: ÄÃ¢y lÃ  nhÃ¢n tá»‘ ráº¥t quan trá»ng, thá»© giÃºp báº¡n xÃ¡c Ä‘á»‹nh nhá»¯ng bÃ i viáº¿t má»›i máº», há»£p "trend" Ä‘á»ƒ Ä‘Æ°a cho ngÆ°á»i dÃ¹ng. NhÆ° váº­y, cÃ¡c bÃ i viáº¿t cÅ©, lá»—i thá»i cáº§n pháº£i bá»‹ trá»« nhiá»u Ä‘iá»ƒm hÆ¡n, vÃ  cÃ¡c bÃ i viáº¿t má»›i, gáº§n Ä‘Ã¢y cáº§n pháº£i bá»‹ trá»« Ã­t Ä‘iá»ƒm hÆ¡n. ÄÃ´i khi cÃ³ há»‡ thá»‘ng cÅ©ng tÃ­nh Ä‘iá»ƒm theo kiá»ƒu: "bÃ i viáº¿t cÃ ng viáº¿t gáº§n Ä‘Ã¢y thÃ¬ cÃ ng Ä‘Æ°á»£c cá»™ng nhiá»u Ä‘iá»ƒm", vÃ­ dá»¥ nhÆ° Reddit, cÅ©ng tÆ°Æ¡ng tá»± nhau cáº£ thÃ´i.
* **Sá»‘ lÆ°á»£ng bÃ¬nh luáº­n**/**lÆ°á»£ng ngÆ°á»i bÃ¬nh luáº­n**: CÃ¡i nÃ y khÃ´ng quan trá»ng báº±ng 2 cÃ¡i á»Ÿ trÃªn, vÃ¬ ta cháº³ng biáº¿t ngÆ°á»i ta bÃ¬nh luáº­n Ä‘á»ƒ khen hay chá»­i, nhÆ°ng cÅ©ng cÃ³ Ã­ch. Nháº­n Ä‘Æ°á»£c nhiá»u bÃ¬nh luáº­n chá»©ng tá» chá»§ Ä‘á» nÃ y Ä‘ang sÃ´i ná»•i vÃ  Ä‘Æ°á»£c quan tÃ¢m.
* **LÆ°á»£t xem**/**thá»i gian xem**: CÃ¡i nÃ y lÃ  yáº¿u tá»‘ thiáº¿u cháº¯c cháº¯n nháº¥t, báº¡n nÃªn háº¡n cháº¿ dÃ¹ng nÃ³ Ä‘á»ƒ xáº¿p háº¡ng. Tuy nhiÃªn váº«n cÃ³ trÆ°á»ng há»£p, nhÆ° Google rÃµ rÃ ng lÃ  cÃ³ theo dÃµi lÆ°á»£ng click/bounce rate Ä‘á»ƒ xÃ¡c Ä‘á»‹nh xáº¿p háº¡ng cá»§a trang Web trÃªn káº¿t quáº£ tÃ¬m kiáº¿m.

## CÃ´ng thá»©c tá»•ng quan
MÃ¬nh xin táº¡m Ä‘Æ°a ra cÃ´ng thá»©c tÃ­nh Ä‘iá»ƒm cho bÃ i viáº¿t Ä‘Æ¡n giáº£n nháº¥t nhÆ° sau:
$$
{score} = ({upvote}-{downvote})-{timeelasped}
$$
Vá»›i ${timeelapsed}$ lÃ  **Ä‘iá»ƒm bá»‹ trá»« theo thá»i gian trÃ´i qua**. Báº¡n cÃ³ thá»ƒ tá»± Ä‘á»‹nh nghÄ©a Ä‘iá»ƒm sáº½ bá»‹ trá»« nhÆ° tháº¿ nÃ o. VÃ­ dá»¥, mÃ¬nh cÃ³ thá»ƒ Ä‘áº·t ráº±ng cá»© 4 giá» trÃ´i qua, bÃ i viáº¿t sáº½ bá»‹ trá»« 1 Ä‘iá»ƒm.

VÃ­ dá»¥ má»™t vÃ i trÆ°á»ng há»£p:
* BÃ i viáº¿t Ä‘Äƒng cÃ¡ch Ä‘Ã¢y 6 giá» trÆ°á»›c, cÃ³ 5 upvote, 1 downvote, sáº½ cÃ³ sá»‘ Ä‘iá»ƒm lÃ  $(5-1)-(\frac{6}{4})=2.5$ Ä‘iá»ƒm.
* BÃ i viáº¿t Ä‘Äƒng cÃ¡ch Ä‘Ã¢y 12 giá» trÆ°á»›c, cÃ³ 25 upvote, 4 downvote, sáº½ cÃ³ sá»‘ Ä‘iá»ƒm lÃ  $(25-4)-(\frac{12}{4})=18$ Ä‘iá»ƒm.
* BÃ i viáº¿t Ä‘Äƒng cÃ¡ch Ä‘Ã¢y 30 ngÃ y trÆ°á»›c, cÃ³ 32 upvote, 2 downvote, sáº½ cÃ³ sá»‘ Ä‘iá»ƒm lÃ  $(32-2)-(\frac{720}{4})=-150$ Ä‘iá»ƒm.

NhÃ¬n qua vÃ­ dá»¥, ta cÃ³ thá»ƒ tháº¥y cÃ´ng thá»©c trÃªn trÃ´ng cÃ³ váº» "táº¡m" Ä‘Ãºng, vÃ¬ bÃ i cÃ³ lÆ°á»£ng upvote cÃ ng cao sáº½ cÃ ng á»Ÿ trÃªn Ä‘áº§u, nhÆ°ng váº«n láº¡i cÃ³ sá»‘ Ä‘iá»ƒm cÃ ng ngÃ y cÃ ng giáº£m theo thá»i gian.

Tuy nhiÃªn váº«n cÃ³ trÆ°á»ng há»£p, má»™t bÃ i viáº¿t lÃªn Ä‘Æ°á»£c vá»‹ trÃ­ Ä‘áº§u, rá»“i cá»© má»—i ngÃ y nÃ³ láº¡i nháº­n Ä‘Æ°á»£c 6, 7 sá»‘ lÆ°á»£t upvote hay nhiá»u hÆ¡n. VÃ¬ bÃ i viáº¿t Ä‘ang Ä‘á»©ng Ä‘áº§u nÃªn viá»‡c nÃ³ **bá»‹ snowball** (hiá»‡u á»©ng lÄƒn cáº§u tuyáº¿t, ae nÃ o cÃ³ chÆ¡i LOL cháº¯c rÃµ nháº¥t ğŸ˜), tá»©c cÃ ng ngÃ y láº¡i cÃ ng nhiá»u upvote hÆ¡n cho nÃ³ lÃ  ráº¥t hay xáº£y ra nhÃ©. Váº­y háº­u quáº£ lÃ  sau... 2 nÄƒm sau bÃ i viáº¿t nÃ y váº«n loanh quanh Ä‘Ã¢u Ä‘Ã³ top 10 trending cá»§a báº¡n(?)

Giá» chÃºng ta sáº½ xem má»™t vÃ i cÃ¡c trang ná»•i tiáº¿ng Ã¡p dá»¥ng viá»‡c xáº¿p háº¡ng bÃ i viáº¿t hot cá»§a há», vÃ  phÃ¢n tÃ­ch xem há» kháº¯c phá»¥c trÆ°á»ng há»£p bá»‹ "snowball" nhÆ° trÃªn nhÆ° tháº¿ nÃ o.
# Thuáº­t toÃ¡n cá»§a Reddit (cÅ©)
Sá»Ÿ dÄ© nÃ³i cÅ© vÃ¬ **Reddit** tá»«ng má»Ÿ mÃ£ nguá»“n há»‡ thá»‘ng cá»§a há», nhÆ°ng Ä‘Ã£ **chuyá»ƒn sang Ä‘Ã³ng mÃ£ nguá»“n** cá»§a há» Ä‘Æ°á»£c má»™t thá»i gian. Tuy nhiÃªn mÃ£ nguá»“n cá»§a há» lÃºc cÃ²n má»Ÿ mÃ£ nguá»“n váº«n Ä‘Æ°á»£c chia sáº» vÃ  Ä‘Ã¡ng Ä‘á»ƒ ta há»c há»i.
## MÃ£ nguá»“n
Pháº§n tÃ­nh Ä‘iá»ƒm Ä‘á»ƒ xáº¿p háº¡ng bÃ i viáº¿t Ä‘ang hot cá»§a há» nhÆ° tháº¿ nÃ y ([GitHub](https://github.com/reddit-archive/reddit/blob/8af415476bcbecc6729c20ada7fcd1d041495140/r2/r2/lib/db/_sorts.pyx#L45)):
```python
cpdef long score(long ups, long downs):
    return ups - downs

cpdef double hot(long ups, long downs, date):
    return _hot(ups, downs, epoch_seconds(date))

cpdef double _hot(long ups, long downs, double date):
    """The hot formula. Should match the equivalent function in postgres."""
    s = score(ups, downs)
    order = log10(max(abs(s), 1))
    if s > 0:
        sign = 1
    elif s < 0:
        sign = -1
    else:
        sign = 0
    seconds = date - 1134028003
    return round(order + sign * seconds / 45000, 7)
```

## Giáº£i thÃ­ch
Giáº£i thÃ­ch sÆ¡ qua vá» thuáº­t toÃ¡n trÃªn nhÆ° sau:
Gá»i:
- $date$ lÃ  thá»i gian bÃ i viáº¿t Ä‘Æ°á»£c Ä‘Äƒng theo dáº¡ng Unix Timestamp,
- $1134028003$ lÃ  lÃ  má»™t thá»i gian cá»‘ Ä‘á»‹nh (12/08/2005 @ 7:46am (UTC), cÃ³ thá»ƒ táº¡m hiá»ƒu lÃ  thá»i gian Reddit báº¯t Ä‘áº§u hoáº¡t Ä‘á»™ng), chÃ­nh lÃ  thá»i gian dáº¡ng Unix Timestamp.

Ta Ä‘Æ°á»£c $seconds$ lÃ  khoáº£ng thá»i gian giá»¯a chÃºng (theo sá»‘ giÃ¢y):
$$
seconds={date}-1134028003
$$

Gá»i $s$ lÃ  sá»‘ chÃªnh lá»‡ch upvote - downvote cá»§a bÃ i viáº¿t:
$$
s=ups - downs
$$

Tá»« Ä‘Ã³ ta cÃ³ $sign$ chÃ­nh lÃ  dáº¥u cá»§a $s$ vá»«a rá»“i. NÃ³i cÃ¡ch khÃ¡c, $sign$ biá»ƒu thá»‹ cho dáº¥u cá»§a káº¿t quáº£ vote lÃ  Ã¢m hay dÆ°Æ¡ng:
- $sign=1$ náº¿u $s>0$
- $sign=-1$ náº¿u $s<0$
- $sign=0$ náº¿u $s=0$.

Äá»ƒ Ä‘Æ°a Ä‘Æ°á»£c $s$ vÃ o hÃ m logarit, ngÆ°á»i ta pháº£i Ä‘á»•i $s$ vá» dáº¡ng giÃ¡ trá»‹ tuyá»‡t Ä‘á»‘i, tá»©c khÃ´ng thá»ƒ Ã¢m; vÃ  báº¯t nÃ³ luÃ´n lá»›n hÆ¡n 1. MÃ¬nh táº¡m Ä‘áº·t sá»‘ Ä‘áº¥y lÃ  $n$:
- $n=|s|$ náº¿u $|s|\geq1$
- $n=1$ náº¿u $|s|<1$

Cuá»‘i cÃ¹ng, ta cÃ³ thá»ƒ tÃ­nh ra Ä‘iá»ƒm Ä‘á»™ "hot" cá»§a bÃ i viáº¿t:
$$
f(seconds,sign,n)=\log_{10}n+\frac{{sign}*{seconds}}{45000}
$$
## PhÃ¢n tÃ­ch
NhÃ¬n cÃ´ng thá»©c cá»§a Reddit, ta cÅ©ng tháº¥y ngay sá»± tÆ°Æ¡ng Ä‘á»“ng vá»›i "cÃ´ng thá»©c tá»•ng quan" á»Ÿ Ä‘áº§u bÃ i cá»§a mÃ¬nh:
- **Sá»‘ háº¡ng Ä‘áº§u tiÃªn** ($\log_{10}n$) Ä‘á»ƒ tÃ­nh ra Ä‘iá»ƒm tá»« lÆ°á»£ng vote cá»§a bÃ i
- **Sá»‘ háº¡ng thá»© hai** ($\frac{{sign}*{seconds}}{45000}$) Ä‘á»ƒ tÃ­nh ra Ä‘iá»ƒm tá»« thá»i gian Ä‘Äƒng bÃ i

TÃ­nh tá»•ng cá»§a hai sá»‘ háº¡ng nÃ y, ta sáº½ ra Ä‘iá»ƒm cuá»‘i cÃ¹ng cá»§a bÃ i viáº¿t. NhÆ°ng cÃ³ nhiá»u thá»© khÃ¡ "thÃº vá»‹" á»Ÿ Ä‘Ã¢y: táº¡i sao láº¡i cáº§n hÃ m logarit? táº¡i sao láº¡i chia cho sá»‘ 45000? Giá» chÃºng ta sáº½ Ä‘i tÃ¬m hiá»ƒu tá»« tá»« tá»«ng chÃºt má»™t.

### Sá»‘ háº¡ng 2 (pháº§n tÃ­nh Ä‘iá»ƒm tá»« thá»i gian Ä‘Äƒng bÃ i)
Pháº§n nÃ y cÅ©ng chung má»¥c Ä‘Ã­ch lÃ  giÃºp cho bÃ i viáº¿t Ä‘Äƒng gáº§n Ä‘Ã¢y cÃ³ Ä‘iá»ƒm cao hÆ¡n bÃ i viáº¿t Ä‘Äƒng trÆ°á»›c Ä‘Ã³. NhÆ°ng thay vÃ¬ **trá»« Ä‘iá»ƒm** dá»±a theo thá»i gian trÃ´i qua, Reddit láº¡i chá»n cÃ¡ch **cá»™ng thÃªm Ä‘iá»ƒm** cho bÃ i viáº¿t viáº¿t gáº§n Ä‘Ã¢y.

Cá»¥ thá»ƒ hÆ¡n, há» Ä‘Ã£ lÃ m tháº¿ báº±ng cÃ¡ch: trÆ°á»›c tiÃªn há» chá»n má»™t má»‘c thá»i gian cá»‘ Ä‘á»‹nh trong quÃ¡ khá»©, vÃ  tÃ­nh hiá»‡u giá»¯a má»‘c thá»i gian Ä‘Ã³ vá»›i thá»i gian viáº¿t bÃ i. VÃ­ dá»¥ (giáº£ sá»­ chÆ°a tÃ­nh Ä‘áº¿n lÆ°á»£ng vote):
- Trang Web cá»§a mÃ¬nh Ä‘Æ°á»£c ra máº¯t vÃ o Ä‘Ãºng Ä‘Ãªm GiÃ¡ng Sinh, tá»©c ngÃ y 0:00 ngÃ y 25/12/2019 theo giá» Viá»‡t Nam, vÃ  mÃ¬nh muá»‘n chá»n thá»i Ä‘iá»ƒm nÃ y má»‘c thá»i gian nÃ y lÃ m "má»‘c thá»i gian cá»‘ Ä‘á»‹nh". NÃ³ cÃ³ giÃ¡ trá»‹ theo kiá»ƒu Unix Timestamp báº±ng 1577206800.
- BÃ i viáº¿t Ä‘áº§u tiÃªn Ä‘Æ°á»£c Ä‘Äƒng vÃ o 6h sÃ¡ng (6h sau Ä‘Ã³), Unix Timestamp lÃ  1577228400, hiá»‡u thá»i gian lÃ  $1577228400-1577206800=21600$, váº­y nÃ³ sáº½ Ä‘Æ°á»£c cá»™ng: $\frac{21600}{45000}=0.48$ Ä‘iá»ƒm.
- BÃ i viáº¿t thá»© 2 Ä‘Æ°á»£c Ä‘Äƒng vÃ o 12h30, hiá»‡u thá»i gian lÃ  $1577251800-1577206800=45000$, váº­y nÃ³ Ä‘Æ°á»£c cá»™ng: $\frac{45000}{45000}=1.00$ Ä‘iá»ƒm.
- BÃ i viáº¿t thá»© 3 Ä‘Æ°á»£c Ä‘Äƒng vÃ o 1h sÃ¡ng ngÃ y tiáº¿p theo (ngÃ y 26), hiá»‡u thá»i gian lÃ  $1577296800-1577206800=90000$, váº­y nÃ³ Ä‘Æ°á»£c cá»™ng: $\frac{90000}{45000}=2.00$ Ä‘iá»ƒm.

Tá»« vÃ­ dá»¥ trÃªn, ta tháº¥y ráº±ng, cá»© vá»›i má»—i 12,5h sau má»‘c thá»i gian lÃ  Ä‘Ãªm GiÃ¡ng Sinh, bÃ i viáº¿t má»›i Ä‘Äƒng sáº½ Ä‘Æ°á»£c cá»™ng thÃªm 1 Ä‘iá»ƒm. 45000 chÃ­nh lÃ  sá»‘ giÃ¢y tÆ°Æ¡ng á»©ng vá»›i 12,5h. NgÆ°á»i ta chá»n cÃ¡ch nÃ y cÃ³ thá»ƒ lÃ  vÃ¬ náº¿u Ä‘Æ°a thá»i Ä‘iá»ƒm hiá»‡n táº¡i vÃ o cÃ´ng thá»©c sáº½ khiáº¿n Ä‘iá»ƒm bá»‹ thay Ä‘á»•i liÃªn tá»¥c vÃ  háº¡n cháº¿ kháº£ nÄƒng sá»­ dá»¥ng cache hay thá»±c thi tÃ­nh Ä‘iá»ƒm dÆ°á»›i ná»n.

### Sá»‘ háº¡ng 1 (pháº§n tÃ­nh Ä‘iá»ƒm tá»« sá»‘ vote)
TrÆ°á»›c háº¿t, cháº¯c háº³n nhiá»u báº¡n Ä‘á»c bÃ i cÅ©ng Ä‘Ã£ lÃ¢u khÃ´ng tiáº¿p xÃºc vá»›i ToÃ¡n cáº¥p 3, nÃªn mÃ¬nh xin máº¡n phÃ©p nháº¯c láº¡i chÃºt vá» hÃ¬nh thÃ¹ cá»§a má»™t hÃ m logarit cÆ¡ sá»‘ 10:
![HÃ m logarit cÆ¡ sá»‘ 10](https://images.viblo.asia/02e2f996-4de9-47a1-8cc5-955236e67ba0.png)
Äá»ƒ dá»… hÃ¬nh dung hÆ¡n, mÃ¬nh xin Ä‘Æ°a ra má»™t vÃ i trÆ°á»ng há»£p:
- Vá»›i bÃ i viáº¿t cÃ³ **10 vote** (tá»©c sá»‘ upvote - downvote), bÃ i Ä‘Ã³ sáº½ Ä‘Æ°á»£c cá»™ng háº³n $\log_{10}10=1$ Ä‘iá»ƒm.
- Vá»›i bÃ i viáº¿t cÃ³ gáº¥p Ä‘Ã´i sá»‘ vote trÃªn, tá»©c **20 vote**, bÃ i Ä‘Ã³ láº¡i chá»‰ nháº­n Ä‘Æ°á»£c $\log_{10}20\approx1.3$ Ä‘iá»ƒm.
- Má»™t bÃ i viáº¿t khÃ¡c cÃ³ sá»‘ vote gáº¥p 10 bÃ i viáº¿t Ä‘áº§u, tá»©c táº­n **100 vote**, bÃ i Ä‘Ã³ láº¡i chá»‰ nháº­n Ä‘Æ°á»£c $\log_{10}100=2$ Ä‘iá»ƒm.

CÅ©ng má»™t vÃ­ dá»¥ khÃ¡c, Ä‘á»ƒ **bÃ i viáº¿t Ä‘Äƒng cÃ¡ch Ä‘Ã¢y 3 ngÃ y trÆ°á»›c cÃ³ háº¡ng cao hÆ¡n má»™t bÃ i vá»«a má»›i Ä‘Äƒng**, nÃ³ cáº§n pháº£i cÃ³ Ä‘áº¿n hÆ¡n $\frac{259200}{45000}=5.76$ Ä‘iá»ƒm tá»« sá»‘ vote, tá»©c nÃ³ cáº§n pháº£i cÃ³ Ä‘áº¿n gáº§n **600000 lÆ°á»£t vote**!

NhÆ° váº­y, nhá» vÃ o hÃ m logarit mÃ :
- CÃ¡c lÆ°á»£t vote Ä‘áº§u cÃ³ giÃ¡ trá»‹ cao nháº¥t
- CÃ¡c lÆ°á»£t vote vá» sau cÃ ng ngÃ y cÃ ng cÃ³ Ã­t giÃ¡ trá»‹ hÆ¡n
- Äá»ƒ bÃ i viáº¿t cÃ ng cÅ© giá»¯ Ä‘Æ°á»£c trÃªn trending thÃ¬ cÃ ng pháº£i nháº­n Ä‘Æ°á»£c lÆ°á»£ng vote cá»±c lá»›n

TÃ³m láº¡i, Ä‘Ã¢y chÃ­nh lÃ  cÃ¡ch **Reddit** dÃ¹ng Ä‘á»ƒ **chá»‘ng láº¡i trÆ°á»ng há»£p "snowball"** nhÆ° mÃ¬nh Ä‘Ã£ Ä‘á» cáº­p á»Ÿ pháº§n Tá»•ng quan, Ä‘á»“ng thá»i giÃºp ná»™i dung á»Ÿ trÃªn frontpage cá»§a Reddit luÃ´n luÃ´n tÆ°Æ¡i má»›i.
# Thuáº­t toÃ¡n cá»§a HackerNews thÃ¬ sao?
KhÃ¡c vá»›i Reddit, HackerNews váº«n Ä‘ang lÃ  open source Ä‘áº¿n thá»i Ä‘iá»ƒm hiá»‡n táº¡i. Há»‡ thá»‘ng cá»§a HackerNews Ä‘Æ°á»£c viáº¿t báº±ng Arc, vÃ  mÃ£ nguá»“n cá»§a pháº§n chá»©c nÄƒng tÃ­nh ranking cÃ¡c bÃ i viáº¿t trÃªn trang chá»§ nhÆ° sau:

```scala:lisp
; Votes divided by the age in hours to the gravityth power.
; Would be interesting to scale gravity in a slider.

(= gravity* 1.8 timebase* 120 front-threshold* 1 
   nourl-factor* .4 lightweight-factor* .3 )

(def frontpage-rank (s (o scorefn realscore) (o gravity gravity*))
  (* (/ (let base (- (scorefn s) 1)
          (if (> base 0) (expt base .8) base))
        (expt (/ (+ (item-age s) timebase*) 60) gravity))
     (if (no (in s!type 'story 'poll))  1
         (blank s!url)                  nourl-factor*
         (lightweight s)                (min lightweight-factor* 
                                             (contro-factor s))
                                        (contro-factor s))))
```

Vá»›i mÃ¬nh thÃ¬ code dáº¡ng nhÆ° Lisp hay Arc nhÆ° trÃªn trÃ´ng khÃ¡ Ä‘Ã¡ng sá»£. Äoáº¡n code trÃªn náº¿u viáº¿t láº¡i báº±ng Python thÃ¬ trÃ´ng nhÆ° sau:
```python
def calculate_score(votes, item_hour_age, gravity=1.8):
    return (votes - 1) / pow((item_hour_age+2), gravity)
```
TÃ³m gá»n láº¡i Ä‘oáº¡n code trÃªn lÃ  cÃ´ng thá»©c khÃ¡ Ä‘Æ¡n giáº£n nhÆ° dÆ°á»›i Ä‘Ã¢y.
## CÃ´ng thá»©c
CÃ´ng thá»©c cá»§a HackerNews cÃ³ pháº§n dá»… hiá»ƒu vÃ  Ä‘Æ¡n giáº£n hÆ¡n cÃ´ng thá»©c cá»§a Reddit, cá»¥ thá»ƒ nhÆ° sau:
$$
score=\frac{p-1}{(t+2)^{G}}
$$
Vá»›i:
- $p$: LÆ°á»£t upvote cá»§a bÃ i viáº¿t (upvote-downvote). LÆ°á»£t vote nÃ y cáº§n trá»« Ä‘i 1 Ä‘á»ƒ khÃ´ng tÃ­nh upvote cá»§a ngÆ°á»i viáº¿t bÃ i.
- $t$: Thá»i gian giá»¯a thá»i gian Ä‘Äƒng bÃ i vÃ  thá»i Ä‘iá»ƒm hiá»‡n táº¡i (theo giá»). VÃ­ dá»¥ nhÆ° bÃ i Ä‘Äƒng 2 giá» trÆ°á»›c sáº½ cÃ³ $t=2$.
- Háº±ng sá»‘ "trá»ng lá»±c", máº·c Ä‘á»‹nh lÃ  $1.8$.

## Giáº£i thÃ­ch
Thay vÃ¬ dÃ¹ng tÃ­nh Ä‘iá»ƒm theo lÆ°á»£t vote vÃ  tÃ­nh Ä‘iáº¿m theo thá»i gian vÃ  tÃ­nh tá»•ng, HackerNews sá»­ dá»¥ng **phÃ©p chia giá»¯a sá»‘ vote vÃ  thá»i gian Ä‘Äƒng** (theo giá») Ä‘á»ƒ tÃ­nh ra Ä‘iá»ƒm rank cá»§a bÃ i viáº¿t.

CÃ³ thá»ƒ Ä‘Æ°a ra má»™t vÃ i nháº­n xÃ©t nhÆ° sau:
- Thá»i gian viáº¿t bÃ i cÃ ng lÃ¢u, sá»‘ Ä‘iá»ƒm sáº½ cÃ ng giáº£m, vÃ¬ sá»‘ $t$ Ä‘Æ°á»£c Ä‘áº·t á»Ÿ pháº§n máº«u sá»‘.
- Äá»ƒ Ä‘iá»u khiá»ƒn viá»‡c sá»‘ Ä‘iá»ƒm bá»‹ giáº£m nhanh hay giáº£m cháº­m theo thá»i gian, ngÆ°á»i ta sá»­ dá»¥ng háº±ng sá»‘ $G$ lÃ  sá»‘ gravity. Náº¿u sá»‘ gravity cÃ ng cao, Ä‘iá»ƒm sá»‘ sáº½ cÃ ng giáº£m nhanh hÆ¡n theo thá»i gian.

Vá»›i $G=1.8$ thÃ¬ sau 24h, Ä‘iá»ƒm sá»‘ cá»§a bÃ i viáº¿t sáº½ giáº£m ráº¥t náº·ng vÃ  cÃ ng vá» sau Ä‘iá»ƒm sá»‘ sáº½ ngÃ y cÃ ng gáº§n vá»›i 0:

![HackerNews ranking algorithm](https://images.viblo.asia/ab9bd50e-543d-4ead-9b48-6a097be1b5a1.gif)

# Tham kháº£o
- [Báº£n backup cá»§a trang amix.dk/blog/post/19588](https://perma.cc/ECF5-HTAS)
- [How Hacker News ranking algorithm works](https://medium.com/hacking-and-gonzo/how-hacker-news-ranking-algorithm-works-1d9b0cf2c08d)
- [An introduction to ranking algorithms seen on social news aggregators](https://coderwall.com/p/cacyhw/an-introduction-to-ranking-algorithms-seen-on-social-news-aggregators)
- [Reddit, Stumbleupon, Del.icio.us and Hacker News Algorithms Exposed!](https://moz.com/blog/reddit-stumbleupon-delicious-and-hacker-news-algorithms-exposed)