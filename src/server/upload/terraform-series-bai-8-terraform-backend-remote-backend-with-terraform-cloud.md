## Gi·ªõi thi·ªáu
Ch√†o c√°c b·∫°n t·ªõi v·ªõi series v·ªÅ Terraform, ·ªü b√†i tr∆∞·ªõc ch√∫ng ta ƒë√£ n√≥i v·ªÅ S3 Standard Backend. ·ªû b√†i n√†y ch√∫ng ta s·∫Ω t√¨m hi·ªÉu v·ªÅ lo·∫°i Backend ti·∫øp theo, l√† Remote Backend. Ch√∫ng ta s·∫Ω s·ª≠ d·ª•ng Terraform Cloud ƒë·ªÉ l√†m remote backend.

![image.png](https://images.viblo.asia/791c2fe0-c917-4d5d-bdc7-0ec741135e1a.png)
*<div align="center">Terraform Cloud - image from [Hashicorp](https://www.hashicorp.com/)</div>*

## Implement Terraform Cloud Remote Backend
C√°c b·∫°n c√≥ th·ªÉ ƒë·ªçc [b√†i 6](https://viblo.asia/p/terraform-series-bai-6-terraform-backend-understand-backend-924lJRr6lPM) ƒë·ªÉ hi·ªÉu r√µ h∆°n v·ªÅ ∆∞u v√† nh∆∞·ª£c ƒëi·ªÉm c·ªßa remote backend.

ƒê·ªÉ s·ª≠ d·ª•ng remote backend, ta c·∫ßn ph·∫£i t·∫°o t√†i kho·∫£n v√† login v√†o trong Terraform Cloud.

### Terraform Cloud
Terraform Cloud l√† m·ªôt d·ªãch v·ª• c·ªßa HashiCorp, n√≥ s·∫Ω gi√∫p ta trong vi·ªác qu·∫£n l√Ω terraform resource m·ªôt c√°ch d·ªÖ d√†ng v√† b·∫£o m·∫≠t h∆°n. Ngo√†i ra Terraform Cloud c√≤n gi√∫p ta trong vi·ªác x√¢y d·ª±ng CI/CD cho infrastructure provisioning m·ªôt c√°ch r·∫•t ƒë∆°n gi·∫£n.

![image.png](https://images.viblo.asia/203d58fb-d2ba-4ba2-93b6-2765797bd0f2.png)
*<div align="center">Terraform Cloud - image from [Amazic](https://amazic.com/terraform-cloud-operator-for-kubernetes-is-now-ga/)</div>*

Terraform Cloud c√≥ ba c√°ch s·ª≠ d·ª•ng l√†:
+ Version control workflow.
+ CLI-driven workflow.
+ API-driven workflow.

Ta s·∫Ω s·ª≠ d·ª•ng CLI-driven workflow cho remote backend, Version control workflow cho CI/CD.

### Create a account
ƒê·∫ßu ti√™n ƒë·ªÉ l√†m vi·ªác v·ªõi Terraform Cloud ta ph·∫£i t·∫°o t√†i kho·∫£n tr∆∞·ªõc, c√°c b·∫°n truy c·∫≠p v√†o link n√†y https://app.terraform.io/signup/account ƒë·ªÉ t·∫°o t√†i kho·∫£n.

![image.png](https://images.viblo.asia/04d81969-5784-4845-a9b8-fd3d75061b93.png)

Sau ƒë√≥ c√°c b·∫°n ƒëƒÉng nh·∫≠p v√†o Terraform Cloud th√¨ c√°c b·∫°n s·∫Ω th·∫•y UI nh∆∞ sau, ch√∫ng ta ch·ªçn **Start from scratch**.

![image.png](https://images.viblo.asia/374830f9-fdc1-413c-983d-4208ff628f84.png)

B∆∞·ªõc ti·∫øp theo n√≥ s·∫Ω b·∫Øt b·∫°n nh·∫≠p th√¥ng tin v·ªÅ organization, c√°c b·∫°n nh·∫≠p g√¨ c≈©ng ƒë∆∞·ª£c. Sau ƒë√≥ b·∫•m t·∫°o, khi t·∫°o xong b·∫°n s·∫Ω th·∫•y ta c√≥ UI nh∆∞ sau.

![image.png](https://images.viblo.asia/b72f221e-f1ad-40b6-b825-7ad348f3025f.png)

Oke, v·∫≠y l√† ta ƒë√£ chu·∫©n b·ªã ƒë·∫ßy ƒë·ªß, b∆∞·ªõc ti·∫øp theo ta s·∫Ω l√†m vi·ªác v·ªõi remote backend.

### Use Remote Backend
ƒê·ªÉ s·ª≠ d·ª•ng ƒë∆∞·ª£c remote backend, ·ªü UI Workspaces b·∫°n b·∫•m v√†o t·∫°o Workspaces, ·ªü trang ti·∫øp theo c√°c b·∫°n ch·ªçn CLI-driven workflow.

![image.png](https://images.viblo.asia/f1484fdb-2c60-4f77-bf66-0e5a7844c7fc.png)

Sau ƒë√≥ c√°c b·∫°n nh·∫≠p v√†o t√™n c·ªßa Workspace v√† b·∫•m t·∫°o.

![image.png](https://images.viblo.asia/7cfc26e4-b422-4317-a406-0c28e28d53cb.png)

Sau khi t·∫°o xong th√¨ workspace c·ªßa ta ƒë√£ s·∫µn s√†ng ƒë·ªÉ s·ª≠ d·ª•ng.

![image.png](https://images.viblo.asia/681480be-8eeb-4fc6-b8f0-d63f29340145.png)

B·∫°n s·∫Ω th·∫•y status c·ªßa workspace l√† Waiting for configuration, ti·∫øp theo ta s·∫Ω c·∫•u h√¨nh ƒë·ªÉ terraform local c·ªßa ta c√≥ th·ªÉ s·ª≠ d·ª•ng Remote Backend n√†y. K√©o xu·ªëng x√≠u th√¨ b·∫°n s·∫Ω th·∫•y c√≥ ph·∫ßn h∆∞·ªõng d·∫´n ƒë·ªÉ ta c·∫•u h√¨nh v√† s·ª≠ d·ª•ng.

![image.png](https://images.viblo.asia/4779f4a9-f978-4389-9aa7-6f0cd5e1e8ad.png)

C√°c b·∫°n c√≥ th·ªÉ l√†m theo n√≥ cho nhanh ho·∫∑c l√†m theo h∆∞·ªõng d·∫´n c·ªßa m√¨nh.

ƒê·∫ßu ti√™n ta t·∫°o m·ªôt folder v√† file `main.tf` v·ªõi ƒëo·∫°n code.

```main.tf
provider "aws" {
  region = "us-west-2"
}

data "aws_ami" "ami" {
  most_recent = true

  filter {
    name   = "name"
    values = ["ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*"]
  }

  owners = ["099720109477"]
}

resource "aws_instance" "server" {
  ami           = data.aws_ami.ami.id
  instance_type = "t3.micro"

  lifecycle {
    create_before_destroy = true
  }

  tags = {
    Name = "Server"
  }
}

output "public_ip" {
  value = aws_instance.server.public_ip
}
```

ƒê·ªÉ s·ª≠ d·ª•ng remote backend ta c·∫ßn th√™m config nh∆∞ sau v√†o file terraform c·ªßa ta.

```
terraform {
  cloud {
    organization = <organization-name>

    workspaces {
      name = <workspace-name>
    }
  }
}
```
 Ta s·∫Ω x√†i **cloud** block v·ªõi hai thu·ªôc t√≠nh l√† organization v√† workspaces. C·∫≠p nh·∫≠t file `main.tf` v·ªõi config c·ªßa workspace ta v·ª´a t·∫°o ·ªü tr√™n. 
 
>  S·ª≠ d·ª•ng **cloud** block v·ªõi terraform version 1.1 tr·ªü l√™n, ƒë·ªëi v·ªõi version nh·ªè h∆°n 1.1 ta x√†i **remote** block.
 
 ```main.tf
 terraform {
  cloud {
    organization = "HPI"

    workspaces {
      name = "terraform-series-remote-backend"
    }
  }
}

provider "aws" {
  region = "us-west-2"
}

...
 ```

Oke, sau khi vi·∫øt code xong, ta s·∫Ω ch·∫°y c√¢u l·ªánh terraform login ƒë·ªÉ ta ƒëƒÉng nh·∫≠p v√†o remote backend c·ªßa ta. Ch·∫°y `terraform login` n√≥ s·∫Ω m·ªü m·ªôt UI nh∆∞ sau cho ta.

![image.png](https://images.viblo.asia/efc4121c-ed58-4c6d-9a4e-fb7f0ed0d082.png)

B·∫•m Create API token.

![image.png](https://images.viblo.asia/117a6d38-4a28-42ec-8388-4c33641fbf01.png)

Nh·ªõ copy nh√©. Sau ƒë√≥ b·∫•m Done, quay l·∫°i terminal d√°n gi√° tr·ªã ta v·ª´a copy v√†o.

![image.png](https://images.viblo.asia/ee55bc47-af3f-40d0-bf96-b1a3e5070aa4.png)

N·∫øu gi√° tr·ªã ƒë√∫ng th√¨ terraform local c·ªßa ta ƒë√£ login v√†o Terraform Cloud th√†nh c√¥ng.

![image.png](https://images.viblo.asia/3ef6706e-c6b2-482e-a921-c34f152f0e87.png)

Sau khi login xong, ta ch·∫°y c√¢u l·ªánh init.

```
$ terraform init

Initializing Terraform Cloud...

Initializing provider plugins...
- Finding latest version of hashicorp/aws...
- Installing hashicorp/aws v4.8.0...
- Installed hashicorp/aws v4.8.0 (signed by HashiCorp)

Terraform has created a lock file .terraform.lock.hcl to record the provider
selections it made above. Include this file in your version control repository
so that Terraform can guarantee to make the same selections by default when
you run "terraform init" in the future.

Terraform Cloud has been successfully initialized!

You may now begin working with Terraform Cloud. Try running "terraform plan" to
see any changes that are required for your infrastructure.

If you ever set or change modules or Terraform Settings, run "terraform init"
again to reinitialize your working directory.
```

V·∫≠y l√† ta ƒë√£ config remote backend th√†nh c√¥ng üòÅ. B√¢y gi·ªù b·∫°n ch·∫°y c√¢u l·ªánh `terraform plan` th·ª≠.

```
$ terraform plan

Running plan in Terraform Cloud. Output will stream here. Pressing Ctrl-C
will stop streaming the logs, but will not stop the plan running remotely.

Preparing the remote plan...

To view this run in a browser, visit:
https://app.terraform.io/app/HPI/terraform-series-remote-backend/runs/run-7R7giQVT4TqnaAzL

Waiting for the plan to start...

Terraform v1.1.7
on linux_amd64
Configuring remote state backend...
Initializing Terraform configuration...
‚ï∑
‚îÇ Error: error configuring Terraform AWS Provider: no valid credential sources for Terraform AWS Provider found.
```

B·∫°n s·∫Ω th·∫•y n√≥ b√°o l·ªói, v√¨ b√¢y gi·ªù khi ta s·ª≠ d·ª•ng remote backend th√¨ to√†n b·ªô config li√™n quan t·ªõi credential nh∆∞ l√† secret key v√† access key c·ªßa AWS ta ƒë·ªÅu ph·∫£i config ·ªü tr√™n remote backend. ƒê√¢y l√† m·ªôt ƒëi·ªÉm m·∫°nh khi ta x√†i remote backend, v√¨ to√†n b·ªô config li√™n quan t·ªõi credential ta ƒë·ªÅu setting ·ªü m·ªôt ch·ªó, kh√¥ng c·∫ßn ph·∫£i l∆∞u credential d∆∞·ªõi m√°y c·ªßa ta => tƒÉng t√≠nh b·∫£o m·∫≠t.

ƒê·ªÉ c·∫•u h√¨nh credential ta b·∫•m qu√° menu **Settings** ch·ªçn **Variable sets**.

![image.png](https://images.viblo.asia/1c32d435-c961-452f-8859-f0c1db436c5e.png)

B·∫•m t·∫°o. ƒê·∫∑t t√™n variable sets l√† AWS Credentials, ch·ªçn **Apply to all workspaces in this organization**.

![image.png](https://images.viblo.asia/a4143f75-0294-424d-8960-21a18757c05e.png)

Ti·∫øp theo ta t·∫°o bi·∫øn ƒë·ªÉ l∆∞u hai gi√° tr·ªã `AWS_ACCESS_KEY_ID` v√† `AWS_SECRET_ACCESS_KEY`. B·∫•m Add variable cho AWS_ACCESS_KEY_ID, ch·ªçn option l√† Environment variable, ƒëi·ªÅn v√†o gi√° tr·ªã, **nh·ªõ check bi·∫øn ƒë√≥ l√† Sensitive**.

![image.png](https://images.viblo.asia/74486656-e4ab-482b-acbf-394c593d6c66.png)

L√†m t∆∞∆°ng t·ª± cho AWS_SECRET_ACCESS_KEY.

![image.png](https://images.viblo.asia/f17d3538-4279-4e58-9992-9a01321bdef6.png)

B·∫•m save.

![image.png](https://images.viblo.asia/863dab17-7095-4ef9-9190-db5b48c6995e.png)

Ok, gi·ªù ta ch·∫°y l·∫°i c√¢u l·ªánh `terraform plan` ta s·∫Ω th·∫•y n√≥ ch·∫°y th√†nh c√¥ng.

```
$ terraform plan

Running plan in Terraform Cloud. Output will stream here. Pressing Ctrl-C
will stop streaming the logs, but will not stop the plan running remotely.

Preparing the remote plan...
...

Plan: 1 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + public_ip = (known after apply)
```

Gi·ªù ta ch·∫°y c√¢u l·ªánh apply n√†o.

```
$ terraform apply

...
aws_instance.server: Creating...
aws_instance.server: Still creating... [10s elapsed]
aws_instance.server: Creation complete after 12s [id=i-0839b6f71c5749de4]

Apply complete! Resources: 1 added, 0 changed, 0 destroyed.

Outputs:

public_ip = "34.220.170.155"
```

Khi c√¢u l·ªánh apply ch·∫°y xong th√¨ l√∫c n√†y state file c·ªßa ta s·∫Ω ƒë∆∞·ª£c l∆∞u ·ªü remote, b·∫°n c√≥ th·ªÉ ki·ªÉm tra ·ªü tr√™n terraform cloud, b·∫•m qua tab **State**.

![image.png](https://images.viblo.asia/1ca34b38-723e-4c02-88f0-b9c10853baa5.png)

B·∫•m v√†o **Triggered via CLI** ta s·∫Ω th·∫•y gi√° tr·ªã c·ªßa state file. Ngo√†i ra terraform cloud c√≤n hi·ªÉn th·ªã c√°c resource hi·ªán t·∫°i ƒëang c√≥ cho ta, gi√∫p ta c√≥ c√°i nh√¨n t·ªët h∆°n v·ªÅ c√°c resource hi·ªán t·∫°i. B·∫•m qua tab **Overview** k√©o xu·ªëng ph√≠a d∆∞·ªõi.

![image.png](https://images.viblo.asia/45fd7ac8-a895-472e-848b-d311df769d73.png)

**Quan tr·ªçng:** l∆∞u √Ω m·ªôt ƒëi·ªÅu l√† khi ta ch·∫°y c√°c c√¢u l·ªánh c·ªßa terraform v·ªõi remote backend, th√¨ terraform runtime s·∫Ω kh√¥ng ch·∫°y ·ªü m√°y c·ªßa ta m√† s·∫Ω ch·∫°y ·ªü remote server, v√† n√≥ s·∫Ω stream k·∫øt qu·∫£ v·ªÅ m√°y local c·ªßa ta. Do ƒë√≥, khi b·∫°n ƒëang ch·∫°y m√† b·∫°n c√≥ b·∫•m Ctrl + C ƒë·ªÉ t·∫Øt qu√° tr√¨nh ch·∫°y th√¨ n√≥ ch·ªâ t·∫Øt stream th√¥i, c√≤n runtime ·ªü remote server c·ªßa ta v·∫´n ch·∫°y b√¨nh th∆∞·ªùng.

![](https://images.viblo.asia/f58313a7-f219-4afd-a731-b4d170b1f237.jpg)

## K·∫øt lu·∫≠n
V·∫≠y l√† ta ƒë√£ t√¨m hi·ªÉu xong v·ªÅ c√°ch s·ª≠ d·ª•ng Terraform Remote Backend, s·ª≠ d·ª•ng remote backend gi√∫p ta t·∫≠p trung to√†n b·ªô c·∫•u h√¨nh credentials v·ªÅ chung m·ªôt ch·ªó, gi√∫p team c√≥ th·ªÉ l√†m vi·ªác m·ªôt c√°ch hi·ªáu qu·∫£ h∆°n v√† ƒë·∫£m b·∫£o security. N·∫øu c√≥ th·∫Øc m·∫Øc ho·∫∑c c·∫ßn gi·∫£i th√≠ch r√µ th√™m ch·ªó n√†o th√¨ c√°c b·∫°n c√≥ th·ªÉ h·ªèi d∆∞·ªõi ph·∫ßn comment. H·∫πn g·∫∑p m·ªçi ng∆∞·ªùi ·ªü b√†i ti·∫øp theo ta s·∫Ω t√¨m hi·ªÉu v·ªÅ **CI/CD v·ªõi Terraform Cloud**.

## M·ª•c t√¨m ki·∫øm ƒë·ªìng ƒë·ªôi

![Ho√†ng Ph√∫c](https://images.viblo.asia/9fbde6d9-5e57-4429-a903-10a961e1c96c.png)

Team c√¥ng ngh·ªá Ho√†ng Ph√∫c c·ªßa b·ªçn m√¨nh ƒë∆∞·ª£c th√†nh l·∫≠p v·ªõi nhi·ªám v·ª• l√† x√¢y d·ª±ng m·ªôt h·ªá th·ªëng c√¥ng ngh·ªá n·ªôi b·ªô cho c√¥ng ty, Ho√†ng Ph√∫c l√† m·ªôt c√¥ng ty b√°n l·∫ª trong lƒ©nh v·ª±c th·ªùi trang v√† c√≥ h∆°n 30 nƒÉm tu·ªïi ƒë·ªùi, v·ªõi chu·ªói c·ª≠a h√†ng r·∫•t nhi·ªÅu tr√™n to√†n qu·ªëc, n√™n vi·ªác v·∫≠n h√†nh c·ªßa Ho√†ng Ph√∫c l√† r·∫•t l·ªõn v√† vi·ªác x√¢y d·ª±ng ƒë∆∞·ª£c m·ªôt h·ªá th·ªëng c√¥ng ngh·ªá ƒë·ªÉ ƒë√°p ·ª©ng vi·ªác v·∫≠n h√†nh n·ªôi b·ªô cho c√¥ng ty l√† m·ªôt c√¥ng vi·ªác r·∫•t th·ª≠ th√°ch, ƒë√¢y l√† m·ªôt qu√° tr√¨nh chuy·ªÉn ƒë·ªïi s·ªë v√† team b·ªçn m√¨nh ƒë√£ l√†m ƒë∆∞·ª£c nh·ªØng b∆∞·ªõc ban ƒë·∫ßu.

Th·ª© m√† team m√¨nh th·∫•y c·∫•n duy nh·∫•t l√† c√°i website, ƒë√¢y l√† trang web m√† tr∆∞·ªõc khi team m√¨nh ƒë∆∞·ª£c th√†nh l·∫≠p ƒë√£ c√≥ m·ªôt ƒë·ªôi outsource kh√°c l√†m, v√† nh·ªØng g√¨ h·ªç ƒë·ªÉ l·∫°i cho b·ªçn m√¨nh l√† m·ªôt trang web v·ªõi ƒë·ªëng b√πi nh√πi, v·ªõi s·ªë ƒëi·ªÉm t·ª´ google l√† 1 tr√™n 100. V·∫≠y b·ªçn m√¨nh s·∫Ω l√†m g√¨ v·ªõi trang web n√†y ƒë√¢y, n·∫£n ch√≠ sao? ƒêi·ªÅu ƒë√≥ kh√¥ng c√≥ trong t·ª´ ƒëi·ªÉn c·ªßa hai s·∫øp m√¨nh, v√† v·ªõi s·ª± d·∫´n d·∫Øt c·ªßa hai s·∫øp team m√¨nh s·∫Ω bi·∫øn ƒë·ªëng website b√πi nh√πi ƒë√≥ th√†nh kim c∆∞∆°ng, nh∆∞ c√°ch b·ªçn m√¨nh ƒë√£ c·∫£i thi·ªán h·ªá th·ªëng n·ªôi b·ªô. B·ªçn m√¨nh ƒëang c·∫£i thi·ªán trang web h·∫±ng ng√†y v√† h·∫±ng ng√†y, t·ª´ 1 ƒëi·ªÉm b·ªçn m√¨nh ƒë√£ c·∫£i thi·ªán n√≥ l√™n 70 ƒëi·ªÉm, v√† m·ª•c ti√™u l√† tr√™n 90 ƒëi·ªÉm.

Hi·ªán t·∫°i team b·ªçn m√¨nh ƒëang c·∫ßn c√°c ƒë·ªìng ƒë·ªôi tham gia ƒë·ªÉ c·∫£i thi·ªán l·∫°i trang web v·ªõi s·ªë l∆∞·ª£ng ng∆∞·ªùi d√πng truy c·∫≠p kh√° l·ªõn, ƒë√¢y l√† m·ªôt th·ª≠ th√°ch r·∫•t th√∫ v·ªã, c√≥ bao gi·ªù c√°c b·∫°n ƒë∆∞·ª£c tham gia thi·∫øt k·∫ø m·ªôt h·ªá th·ªëng l·ªõn t·ª´ ƒë·∫ßu ch∆∞a, m√¨nh kh√° ch·∫Øc l√† s·ªë l∆∞·ª£ng ƒë√≥ r·∫•t √≠t. B·ªçn m√¨nh ƒë√£ c√≥ kh√°ch h√†ng, nh·ªØng g√¨ c√≤n l·∫°i l√† c·∫ßn nh·ªØng ƒë·ªìng ƒë·ªôi ƒë·ªÉ c√πng nhau ph√°t tri·ªÉn m·ªôt h·ªá th·ªëng ƒë·ªÉ ph·ª•c v·ª• r·∫•t nhi·ªÅu ng∆∞·ªùi d√πng. M·ª•c ti√™u c·ªßa c√¥ng ty Ho√†ng Ph√∫c l√† tr·ªü th√†nh nh√† b√°n l·∫ª v·ªÅ th·ªùi trang l·ªõn nh·∫•t Vi·ªát Nam, h√£y tham gia v·ªõi b·ªçn m√¨nh nh√©. M·ªôt th√†nh vi√™n trong team m√¨nh kh√¥ng y√™u c·∫ßn ph·∫£i gi·ªèi, ch·ªâ c·∫ßn h√≤a ƒë·ªìng, h·ª£p t√°c v√† s·∫µn s√†ng h·ª£p t√°c v·ªõi nhau. C√≥ th·ªÉ b·∫°n kh√¥ng l√† gi·ªèi nh·∫•t nh∆∞ng n·∫øu gia nh·∫≠p v·ªõi b·ªçn m√¨nh th√¨ b·∫°n s·∫Ω t·∫°o ra ƒë∆∞·ª£c nh·ªØng th·ª© gi√° tr·ªã nh·∫•t.

ƒê·ªìng ƒë·ªôi [Backend Engineer (Magento - PHP)](https://tuyendung.hoang-phuc.com/job/backend-engineer-magento-php-1538).

ƒê·ªìng ƒë·ªôi [Senior Backend Engineer](https://tuyendung.hoang-phuc.com/job/senior-backend-engineer-1022).

ƒê·ªìng ƒë·ªôi [Senior Frontend Engineer](https://tuyendung.hoang-phuc.com/job/senior-frontend-engineer-1021).