Cháº¯c háº³n ai trong sá»‘ chÃºng ta cÅ©ng Ä‘Ã£ tá»«ng dÃ¹ng 1 sá»‘ dá»‹ch vá»¥ URL Shortening (rÃºt gá»n link) nhÆ° Bitly hay TinyURL.

Äá»‘i vá»›i 1 engineer thÃ¬ viá»‡c dÃ¹ng lÃ  1 chuyá»‡n, nhÆ°ng lÃ m tháº¿ nÃ o Ä‘á»ƒ thiáº¿t káº¿ Ä‘Æ°á»£c 1 há»‡ thá»‘ng chá»‹u táº£i hÃ ng tá»‰ click má»—i thÃ¡ng cháº¯c háº³n cÅ©ng nhiá»u ngÆ°á»i quan tÃ¢m.

HÃ´m nay mÃ¬nh viáº¿t bÃ i nÃ y Ä‘á»ƒ Ä‘Ã o sÃ¢u vÃ o nhá»¯ng há»‡ thá»‘ng Ä‘Ã³ xem há» Ä‘Ã£ thiáº¿t káº¿ nhÆ° tháº¿ nÃ o nhÃ©.

**Má»¥c tiÃªu cá»§a bÃ i viáº¿t:**

* Sáº½ giÃºp cÃ¡c báº¡n cÃ³ cÃ¡i nhÃ¬n tá»•ng quan vá» cÃ¡ch thiáº¿t káº¿ há»‡ thá»‘ng hÃ ng triá»‡u ngÆ°á»i dÃ¹ng, hÃ ng tá»‰ click má»—i thÃ¡ng nÃ³ nhÆ° tháº¿ nÃ o. Tá»« cÃ¡ch tÆ° duy Ä‘áº¿n cÃ¡ch tiáº¿p cáº­n bÃ i toÃ¡n.
* CÃ³ thá»ƒ tá»± mÃ¬nh xÃ¢y dá»±ng Ä‘Æ°á»£c 1 há»‡ thá»‘ng URL Shortening giá»‘ng Bitly, TinyURL.
* GiÃºp cÃ¡c báº¡n cÃ³ kinh nghiá»‡m Ä‘i phá»ng váº¥n vÃ o vá»‹ trÃ­ system design.

## Há»‡ thá»‘ng URL Shortening lÃ  gÃ¬?

Cháº¯c háº³n cÅ©ng cÃ³ 1 sá»‘ báº¡n chÆ°a tá»«ng dÃ¹ng dá»‹ch vá»¥ rÃºt gá»n link bao giá». Váº­y Ä‘á»ƒ mÃ¬nh giáº£i thÃ­ch ngáº¯n gá»n xem URL Shortening lÃ  gÃ¬ Ä‘Ã£ nhÃ©.

URL Shortening (rÃºt gá»n link) lÃ  1 dá»‹ch vá»¥ giÃºp chÃºng ta cÃ³ thá»ƒ lÃ m ngáº¯n link gá»‘c láº¡i Ä‘Æ°á»£c.

VÃ­ dá»¥ nhÆ° link gá»‘c cá»§a chÃºng ta lÃ : [https://nghethuatcoding.com/2019/05/06/cac-ki-su-grab-da-thiet-ke-he-thong-dan-hoi-su-dung-circuit-breaker-nhu-the-nao/](https://nghethuatcoding.com/2019/05/06/cac-ki-su-grab-da-thiet-ke-he-thong-dan-hoi-su-dung-circuit-breaker-nhu-the-nao/)

Sau khi dÃ¹ng qua rÃºt gá»n link thÃ¬ nÃ³ sáº½ trá»Ÿ thÃ nh tháº¿ nÃ y: [http://bit.ly/2VXBAw4](http://bit.ly/2VXBAw4)

BÃ¢y giá» náº¿u chÃºng ta má»Ÿ link [http://bit.ly/2VXBAw4](http://bit.ly/2VXBAw4) á»Ÿ trÃ¬nh duyá»‡t thÃ¬ nÃ³ sáº½ chuyá»ƒn hÆ°á»›ng Ä‘áº¿n link gá»‘c.

## Táº¡i sao cáº§n dÃ¹ng rÃºt gá»n link?

ÄÃ¢y cháº¯c háº³n lÃ  cÃ¢u há»i mÃ  nhiá»u ngÆ°á»i quan tÃ¢m. VÃ­ dá»¥ nhÆ°: cá»© gá»­i link gá»‘c cho ngÆ°á»i xem chá»© cáº§n gÃ¬ pháº£i rÃºt gá»n link lÃ m gÃ¬ cho nÃ³ máº¥t thá»i gian? Rá»“i bÃ¢y giá» cÃ³ ai pháº£i tá»± nháº­p link báº±ng tay ná»¯a Ä‘Ã¢u mÃ  pháº£i lÃ m máº¥t cÃ´ng? â€¦

CÃ´ng nháº­n nhá»¯ng tháº¯c máº¯c Ä‘Ã³ cá»§a má»i ngÆ°á»i khÃ´ng sai.

**Má»¥c Ä‘Ã­ch chÃ­nh cá»§a viá»‡c dÃ¹ng rÃºt gá»n link lÃ :**

* NhÃ¬n link ngáº¯n gá»n trÃ´ng Ä‘áº¹p máº¯t hÆ¡n.
* CÃ³ thá»ƒ thá»‘ng kÃª lÆ°á»£ng ngÆ°á»i click vÃ o link Ä‘á»ƒ phÃ¢n tÃ­ch, Ä‘Ã¡nh giÃ¡ káº¿t quáº£. Phá»¥c vá»¥ cho marketing.
* CÃ³ thá»ƒ áº©n 1 sá»‘ link tiáº¿p thá»‹ liÃªn káº¿t vá»›i má»¥c Ä‘Ã­ch lÃ  kiáº¿m tiá»n (ÄÃ¢y lÃ  1 vÃ­ dá»¥ [Kiáº¿m tiá»n vá»›i link rÃºt gá»n](https://kiemtiencaptoc.com/link-rut-gon-kiem-tien-tot-nhat-2019/))

## YÃªu cáº§u vá» máº·t chá»©c nÄƒng há»‡ thá»‘ng

Háº§u háº¿t cÃ¡c há»‡ thá»‘ng rÃºt gá»n link pháº£i Ä‘Ã¡p á»©ng Ä‘Æ°á»£c nhá»¯ng yÃªu cáº§u sau:

**YÃªu cáº§u vá» máº·t chá»©c nÄƒng:**

* Äáº§u vÃ o lÃ  1 link gá»‘c, há»‡ thá»‘ng sáº½ rÃºt gá»n link gá»‘c Ä‘Ã³ thÃ nh 1 dáº¡ng link ngáº¯n hÆ¡n vÃ  duy nháº¥t
* Khi ngÆ°á»i dÃ¹ng access vÃ o link rÃºt gá»n, há»‡ thá»‘ng sáº½ chuyá»ƒn nÃ³ Ä‘áº¿n link gá»‘c
* NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ lá»±a chá»n customize link rÃºt gá»n cá»§a mÃ¬nh theo Ã½ muá»‘n.
* Link rÃºt gá»n sáº½ háº¿t háº¡n sau 1 khoáº£ng thá»i gian máº·c Ä‘á»‹nh nÃ o Ä‘Ã³. Tuy nhiÃªn ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘iá»u chá»‰nh cÃ¡i khoáº£ng thá»i gian nÃ y.

**YÃªu cáº§u phi chá»©c nÄƒng:**

* Há»‡ thá»‘ng cÃ³ tÃ­nh available (sáºµn sÃ ng) cao. VÃ¬ sao pháº£i cáº§n cÃ¡i nÃ y? VÃ¬ náº¿u há»‡ thá»‘ng die thÃ¬ toÃ n bá»™ link rÃºt gá»n lÃºc Ä‘Ã³ cÅ©ng die theo.
* Khi click vÃ o link rÃºt gá»n Ä‘á»ƒ chuyá»ƒn sang link gá»‘c, thÃ¬ thá»i gian redirection Ä‘Ã³ pháº£i tá»‘i thiá»ƒu (minimal latency).
* Link rÃºt gá»n khÃ´ng thá»ƒ Ä‘oÃ¡n Ä‘Æ°á»£c.

**YÃªu cáº§u má»Ÿ rá»™ng:**

* CÃ³ thá»ƒ phÃ¢n tÃ­ch Ä‘Æ°á»£c bao nhiÃªu láº§n click vÃ o link rÃºt gá»n?
* Cung cáº¥p API cho bÃªn thá»© 3 cÃ³ thá»ƒ dÃ¹ng Ä‘Æ°á»£c.

## PhÃ¢n tÃ­ch há»‡ thá»‘ng

á» pháº§n nÃ y mÃ¬nh sáº½ trÃ¬nh bÃ y cho cÃ¡c báº¡n cÃ¡ch Æ°á»›c lÆ°á»£ng sá»‘ lÆ°á»£ng request hÃ ng thÃ¡ng, dung lÆ°á»£ng disk, dung lÆ°á»£ng memory cáº§n dÃ¹ng, bÄƒng thÃ´ng máº¡ng tiÃªu tá»‘n lÃ  bao nhiÃªu â€¦

Äa sá»‘ nhá»¯ng há»‡ thá»‘ng rÃºt gá»n link nÃ y sáº½ cÃ³ lÆ°á»£ng access khÃ¡ lÃ  cao.

Giáº£ sá»­ nhÆ° há»‡ thá»‘ng chÃºng ta thiáº¿t káº¿ sáº½ cÃ³ tá»‰ lá»‡ **read:write lÃ  100:1**. (CÃ¡c báº¡n nhá»› tá»‰ lá»‡ nÃ y nhÃ© vÃ¬ nÃ³ dÃ¹ng trong suá»‘t bÃ i viáº¿t)

Trong Ä‘Ã³:

* tá»‰ lá»‡ read á»Ÿ Ä‘Ã¢y tá»©c lÃ  sá»‘ lÆ°á»£ng ngÆ°á»i click vÃ o link rÃºt gá»n
* tá»‰ lá»‡ write lÃ  sá»‘ ngÆ°á»i táº¡o ra link rÃºt gá»n.

### Æ¯á»›c lÆ°á»£ng traffic

Giáº£ sá»­ nhÆ° há»‡ thá»‘ng cá»§a chÃºng ta cÃ³ 500 triá»‡u link rÃºt gá»n trong 1 thÃ¡ng.

Vá»›i tá»‰ lá»‡ read:write lÃ  100:1 thÃ¬ khi Ä‘Ã³ sá»‘ lÆ°á»£ng read sáº½ lÃ : 500M * 100 = 50B (M lÃ  milion, B lÃ  bilion)

Sá»‘ lÆ°á»£ng write trong 1 giÃ¢y lÃ  bao nhiÃªu?

500M / (30 days * 24 hours * 3600 seconds) = 200 URL/s

Sá»‘ lÆ°á»£ng read trong 1 giÃ¢y lÃ  bao nhiÃªu?

200 * 100 = 20K URL/s (vÃ¬ tá»‰ lá»‡ read:write lÃ  100:1)

### Æ¯á»›c lÆ°á»£ng storage

Giáº£ sá»­ nhÆ° chÃºng ta sáº½ lÆ°u táº¥t cáº£ link rÃºt gá»n trong 5 nÄƒm.

Do chÃºng ta cÃ³ 500M link rÃºt gá»n trong 1 thÃ¡ng, khi Ä‘Ã³ 5 nÄƒm chÃºng ta sáº½ cÃ³:

500M * 12 months * 5 years = 30B URLs

Giáº£ sá»­ má»—i 1 link rÃºt gá»n chÃºng ta sáº½ dÃ¹ng máº¥t 500 bytes Ä‘á»ƒ lÆ°u nÃ³ trong storage. Dung lÆ°á»£ng á»• Ä‘Ä©a lÆ°u 500M URL trong 5 nÄƒm sáº½ lÃ :

30B * 500 bytes = 15TB

### Æ¯á»›c lÆ°á»£ng bandwith (bÄƒng thÃ´ng máº¡ng)

TrÆ°á»›c tiÃªn mÃ¬nh giáº£i thÃ­ch qua vá» bandwith (bÄƒng thÃ´ng máº¡ng) lÃ  gÃ¬.

**BÄƒng thÃ´ng máº¡ng** lÃ  thuáº­t ngá»¯ chá»‰ lÆ°á»£ng truyá»n dá»¯ liá»‡u (data size) trong khoáº£ng thá»i gian 1 giÃ¢y.

Trong Ä‘Ã³ lÆ°á»£ng truyá»n dá»¯ liá»‡u sáº½ bao gá»“m 2 loáº¡i lÃ  incoming data vá»›i outgoing data:

incoming data lÃ  lÆ°á»£ng dá»¯ liá»‡u truyá»n Ä‘áº¿n server (giá»‘ng nhÆ° kiá»ƒu upload áº¥y)
outgoing data lÃ  lÆ°á»£ng dá»¯ liá»‡u tá»« server tráº£ vá» cho ngÆ°á»i dÃ¹ng (giá»‘ng nhÆ° download)
VÃ¬ há»‡ thá»‘ng cá»§a chÃºng ta cÃ³ 200 URL má»›i trong 1 giÃ¢y thÃ¬ khi Ä‘Ã³:

total incoming data = 200 * 500 bytes = 100 KB/s

Vá»›i read request thÃ¬ há»‡ thá»‘ng cá»§a chÃºng ta cÃ³ 20K URL/s thÃ¬ khi Ä‘Ã³:

total outgoing data = 20K * 500 bytes = 10MB/s

### Æ¯á»›c lÆ°á»£ng memory

Äá»ƒ há»‡ thá»‘ng cÃ³ thá»ƒ cháº¡y nhanh hÆ¡n thÃ¬ giáº£i phÃ¡p tá»‘t nháº¥t Ä‘Ã³ lÃ  cache láº¡i nhá»¯ng cÃ¡i link rÃºt gá»n nÃ o mÃ  cÃ³ nhiá»u ngÆ°á»i dÃ¹ng click.

Váº­y chÃºng ta sáº½ cáº§n bao nhiÃªu memory?

Náº¿u chÃºng ta Ä‘i theo quy táº¯c **80:20** nghÄ©a lÃ  20% sá»‘ lÆ°á»£ng link rÃºt gá»n táº¡o ra 80% traffic há»‡ thá»‘ng. (Hiá»ƒu Ä‘Æ¡n giáº£n lÃ  chá»‰ cÃ³ 20% sá»‘ lÆ°á»£ng link rÃºt gá»n lÃ  nhiá»u ngÆ°á»i dÃ¹ng access, cÃ²n láº¡i 80% ko cÃ³ ai access cáº£. NÃªn 20% link rÃºt gá»n sáº½ táº¡o ra 80% traffic lÃ  vÃ¬ lÃ­ do Ä‘Ã³).

VÃ¬ chÃºng ta cÃ³ tá»•ng cá»™ng 20K URL/s (hay 20K requests/s) thÃ¬ khi Ä‘Ã³ 1 ngÃ y sáº½ cÃ³:

20K * 3600 seconds * 24 hours = 1.7B request/day

Äá»ƒ cache Ä‘Æ°á»£c 20% sá»‘ request nÃ y thÃ¬ chÃºng ta sáº½ cáº§n:

0.2 * 1.7B * 500 bytes = 170GB memory

### TÃ³m táº¯t láº¡i kÃ­ch thÆ°á»›c há»‡ thá»‘ng

Há»‡ thá»‘ng cá»§a chÃºng ta cÃ³ 500M URL trong 1 thÃ¡ng, vÃ  cÃ³ tá»‰ lá»‡ read:write lÃ  100:1. Khi Ä‘Ã³ Ä‘áº·c táº£ vá» há»‡ thá»‘ng cá»§a chÃºng ta sáº½ nhÆ° sau:

* 200 URL Ä‘Æ°á»£c táº¡o ra má»—i giÃ¢y
* Sá»‘ lÆ°á»£ng access: 20K request/s
* Incoming data (giá»‘ng nhÆ° upload): 100KB/s
* Outgoing data (giá»‘ng nhÆ° download): 10MB/s
* Dung lÆ°á»£ng á»• Ä‘Ä©a trong 5 nÄƒm: 15TB
* Dung lÆ°á»£ng memory dÃ¹ng cho cache: 170GB

## Thiáº¿t káº¿ API

ChÃºng ta cÃ³ thá»ƒ dÃ¹ng SOAP hoáº·c lÃ  REST APIs Ä‘á»ƒ thiáº¿t káº¿ API cá»§a há»‡ thá»‘ng.

Qua nhá»¯ng yÃªu cáº§u á»Ÿ bÃªn trÃªn, thÃ¬ ta tháº¥y há»‡ thá»‘ng cá»§a chÃºng ta Ã­t nháº¥t cáº§n 2 api sau:

### createURL

Äáº§u tiÃªn lÃ  cáº§n API Ä‘á»ƒ táº¡o ra link rÃºt gá»n.

```python
createURL(api_dev_key,
          original_url,
          custom_alias=None,
          expire_date=None)
```

**Trong Ä‘Ã³:**

* api_dev_key (string): lÃ  API developer key cá»§a ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng kÃ­ tÃ i khoáº£n. Key nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘á»‹nh danh ngÆ°á»i dÃ¹ng, giá»›i háº¡n sá»‘ lÆ°á»£ng request cá»§a ngÆ°á»i dÃ¹ng (hay cÃ²n gá»i lÃ  [rate-limiting](https://nghethuatcoding.com/2019/05/06/cac-ki-su-grab-da-thiet-ke-he-thong-dan-hoi-su-dung-circuit-breaker-nhu-the-nao/))
original_url (string): link gá»‘c
* custom_alias (string â€“ optional): customize key cho URL
* expire_date (string â€“ optional): ngÃ y háº¿t háº¡n cá»§a link rÃºt gá»n

**GiÃ¡ trá»‹ tráº£ vá» (string):**

* Náº¿u thÃ nh cÃ´ng sáº½ insert vÃ o trong cÆ¡ sá»Ÿ dá»¯ liá»‡u vÃ  tráº£ vá» link rÃºt gá»n
* Náº¿u tháº¥t báº¡i sáº½ tráº£ vá» error code.

### deleteURL

API thá»© 2 cÅ©ng khÃ¡ cáº§n thiáº¿t Ä‘Ã³ lÃ  xoÃ¡ Ä‘i link rÃºt gá»n Ä‘Ã£ Ä‘Äƒng kÃ­.

```erlang
deleteURL(api_dev_key, url_key)
```

**Trong Ä‘Ã³:**

* api_dev_key (string) lÃ  API developer key cá»§a ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng kÃ­ tÃ i khoáº£n
* url_key (string): lÃ  link rÃºt gá»n.

**GiÃ¡ trá»‹ tráº£ vá» (string):**

* Náº¿u thÃ nh cÃ´ng sáº½ tráº£ vá» link rÃºt gá»n Ä‘Ã£ bá»‹ xoÃ¡.
* Náº¿u tháº¥t báº¡i sáº½ tráº£ vá» error code.

### LÃ m tháº¿ nÃ o ngÄƒn cháº·n hacker?

Hacker cÃ³ thá»ƒ dÃ¹ng api Ä‘á»ƒ táº¡o ra thÃ¢t nhiá»u link rÃºt gá»n vÆ°á»£t quÃ¡ thiáº¿t káº¿ há»‡ thá»‘ng hiá»‡n táº¡i. Vá»›i má»¥c Ä‘Ã­ch cho há»‡ thá»‘ng cá»§a chÃºng ta â€œÄ‘áº¯p chiáº¿u luÃ´nâ€.

VÃ­ dá»¥ nhÆ° há»‡ thá»‘ng hiá»‡n táº¡i cá»§a chÃºng ta Ä‘ang thiáº¿t káº¿ Ä‘Ã¡p á»©ng 1 thÃ¡ng 500 triá»‡u URL Ä‘Æ°á»£c táº¡o ra.

VÃ  hacker táº¥n cÃ´ng sáº½ táº¡o gáº¥p 100 láº§n hiá»‡n táº¡i lÃ  khoáº£ng 50 nghÃ¬n tá»‰ URL Ä‘á»ƒ há»‡ thá»‘ng sáº½ tiÃªu thá»¥ nhiá»u tÃ i nguyÃªn hÆ¡n, dÃ¹ng nhiá»u memory hÆ¡n, tá»‘n nhiá»u á»• Ä‘Ä©a hÆ¡n. Khi Ä‘Ã³ cháº¯c cháº¯n há»‡ thá»‘ng sáº½ bá»‹ down. VÃ  toÃ n bá»™ link rÃºt gá»n sáº½ bá»‹ tan biáº¿n.

Váº­y lÃ m tháº¿ nÃ o Ä‘á»ƒ giáº£i quyáº¿t Ä‘c bÃ i toÃ¡n nÃ y? CÃ¡ch Ä‘Æ¡n giáº£n nháº¥t lÃ  sáº½ háº¡n cháº¿ sá»‘ láº§n call api thÃ´ng qua api_dev_key (kÄ© thuáº­t nÃ y Ä‘Æ°á»£c gá»i lÃ  [rate-limiting](https://nghethuatcoding.com/2019/05/06/cac-ki-su-grab-da-thiet-ke-he-thong-dan-hoi-su-dung-circuit-breaker-nhu-the-nao/) mÃ  Grab Ä‘ang xá»­ dá»¥ng). VÃ­ dá»¥ nhÆ° má»—i api_dev_key sáº½ chá»‰ cho táº¡o táº§m 100 link rÃºt gá»n trong 1 ngÃ y cháº³ng háº¡n.

Tuy khÃ´ng pháº£i lÃ  cÃ¡ch hoÃ n háº£o 100% nhÆ°ng Ã­t nhiá»u cÅ©ng háº¡n cháº¿ Ä‘Æ°á»£c 1 sá»‘ váº¥n Ä‘á».

## Thiáº¿t káº¿ database

YÃªu cáº§u vá» database cá»§a chÃºng ta sáº½ nhÆ° sau:

* Cáº§n lÆ°u hÃ ng tá»‰ record
* Má»—i 1 object sáº½ lÆ°u cÃ ng nhá» cÃ ng tá»‘t (táº§m dÆ°á»›i 1KB)
* KhÃ´ng cáº§n má»‘i quan há»‡ dá»¯ liá»‡u giá»¯a cÃ¡c record.
* Há»‡ thá»‘ng cÃ³ tá»‰ lá»‡ read khÃ¡ cao

**Database schema:**

ChÃºng ta sáº½ cáº§n 2 báº£ng chÃ­nh: 1 báº£ng lÆ°u thÃ´ng tin ngÆ°á»i dÃ¹ng, vÃ  1 báº£ng lÆ°u thÃ´ng tin vá» URL.

![](https://images.viblo.asia/e4acda8b-f36a-4e36-9003-3e6df4f3282b.png)

**Loáº¡i Database nÃ o nÃªn sá»­ dá»¥ng?**

VÃ¬ chÃºng ta Ä‘Ã£ dá»± Ä‘oÃ¡n trÆ°á»›c lÃ  sáº½ lÆ°u Ä‘áº¿n hÃ ng tá»‰ record, hÆ¡n ná»¯a cÃ¡c báº£ng khÃ´ng cÃ³ má»‘i quan há»‡ nÃ o vá»›i nhau cáº£ nÃªn viá»‡c dÃ¹ng loáº¡i NoSQL key-value cÃ³ láº½ sáº½ lÃ  lá»±a chá»n tá»‘t nháº¥t. VÃ­ dá»¥ nhÆ° DynamoDB, Cassandra mÃ¬nh tháº¥y Ä‘á»u ok cáº£.

## Thuáº­t toÃ¡n vÃ  thiáº¿t káº¿ há»‡ thá»‘ng cÆ¡ báº£n

Váº¥n Ä‘á» cáº§n giáº£i quyáº¿t á»Ÿ Ä‘Ã¢y lÃ  lÃ m tháº¿ nÃ o cÃ³ thá»ƒ táº¡o ra Ä‘Æ°á»£c 1 link rÃºt gá»n vÃ  nÃ³ duy nháº¥t tá»« 1 link gá»‘c.

Trong pháº§n Ä‘áº§u tiÃªn mÃ¬nh Ä‘Ã£ láº¥y ra 1 vÃ­ dá»¥ vá» link rÃºt gá»n: [http://bit.ly/2VXBAw4](http://bit.ly/2VXBAw4)

ThÃ¬ pháº§n nÃ y chÃºng ta sáº½ Ä‘i thiáº¿t ká»ƒ Ä‘á»ƒ táº¡o ra Ä‘Æ°á»£c pháº§n rÃºt gá»n, chÃ­nh lÃ  **2VXBAw4**.

### Encoding URL

ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng 1 sá»‘ hÃ m bÄƒm (nhÆ° MD5 hay SHA256) Ä‘á»ƒ bÄƒm giÃ¡ trá»‹ Ä‘áº§u vÃ o URL. Sau Ä‘Ã³ sáº½ dÃ¹ng 1 sá»‘ hÃ m mÃ£ hoÃ¡ Ä‘á»ƒ hiá»ƒn thá»‹. VÃ­ dá»¥ nhÆ° base36 ([a-z, 0-9]), hoáº·c base62 ([a-z, A-Z, 0-9]) vÃ  base64 ([a-z, A-A, 0-9, -, .]).

1 cÃ¢u há»i Ä‘Æ°á»£c Ä‘áº·t ra á»Ÿ Ä‘Ã¢y lÃ  chÃºng ta sáº½ dÃ¹ng Ä‘á»™ dÃ i key lÃ  bao nhiÃªu? 6,8 hay lÃ  10?

* Náº¿u dÃ¹ng base64 cho 6 kÃ­ tá»± thÃ¬ tá»•ng chÃºng ta cÃ³ 64^6 = 68.7B URL
* Náº¿u dÃ¹ng base64 cho 8 kÃ­ tá»± thÃ¬ tá»•ng chÃºng ta cÃ³ 64^8 = 281 nghÃ¬n tá»‰ URL

Do há»‡ thá»‘ng cá»§a chÃºng ta cÃ³ 500M URL Ä‘Æ°á»£c táº¡o ra má»—i thÃ¡ng, há»‡ thá»‘ng dÃ¹ng trong 5 nÄƒm sáº½ cÃ³ tá»•ng:

500M * 12 months * 5 = 30B URLs / 5 years.

Do Ä‘Ã³ vá»›i 68.7B URL (vá»›i 6 kÃ­ tá»±) lÃ  cÃ³ thá»ƒ dÃ¹ng Ä‘Æ°á»£c trong 5 nÄƒm rá»“i.

Náº¿u chÃºng ta dÃ¹ng thuáº­t toÃ¡n MD5 nhÆ° hÃ m bÄƒm, thÃ¬ khi Ä‘Ã³ nÃ³ sáº½ táº¡o ra giÃ¡ trá»‹ hash cÃ³ chá»©a 128 bit. Sau Ä‘Ã³ base64 Ä‘á»ƒ encode giÃ¡ trá»‹ bÄƒm, nÃ³ sáº½ táº¡o ra Ã­t nháº¥t 21 kÃ­ tá»± (vÃ¬ má»—i kÃ­ tá»± base64 sáº½ encode 6 bits giÃ¡ trá»‹ hash).

Trong khi Ä‘Ã³ khÃ´ng gian khoÃ¡ cá»§a chÃºng ta chá»‰ cáº§n 6 kÃ­ tá»± thÃ´i. Váº­y lÃ m tháº¿ nÃ o cÃ³ thá»ƒ chá»n ra khoÃ¡? ChÃºng ta cÃ³ thá»ƒ chá»n ra 6 kÃ­ tá»± Ä‘áº§u tiÃªn cÅ©ng Ä‘Æ°á»£c. Máº·c dÃ¹ cÃ³ trÆ°á»ng há»£p nÃ³ trÃ¹ng nhau. nhÆ°ng mÃ  xÃ¡c suáº¥t chá»‰ táº§m 1/(64^6). NÃ³ ráº¥t lÃ  nhá». NÃªn cÃ³ thá»ƒ cháº¥p nháº­n Ä‘Æ°á»£c.

Náº¿u an toÃ n thÃ¬ má»—i láº§n generate ra thÃ¬ sáº½ check trong DB xem cÃ³ hay chÆ°a? Náº¿u chÆ°a cÃ³ thÃ¬ ok, cÃ²n náº¿u cÃ³ rá»“i thÃ¬ sáº½ thÃªm xÃ¢u random nÃ o vÃ o trÆ°á»›c URL vÃ  láº¡i láº·p láº¡i cho Ä‘áº¿n khi sinh ra unique thÃ¬ thÃ´i.

**â€» CÃ¡ch láº¥y 6 kÃ­ tá»± Ä‘áº§u tiÃªn nÃ y chá»‰ lÃ  1 giáº£i phÃ¡p thÃ´i nhÃ©. CÃ¡c báº¡n cÃ³ thá»ƒ tá»± cÃ i Ä‘áº·t cho mÃ¬nh thuáº­t toÃ¡n khÃ¡c, miá»…n nÃ³ sinh ra Ä‘Æ°á»£c 6 kÃ­ tá»± unique lÃ  Ä‘Æ°á»£c.**

ÄÃ¢y lÃ  1 vÃ­ dá»¥ vá» trÆ°á»ng há»£p láº¥y 6 kÃ­ tá»± Ä‘áº§u tiÃªn:

```javascript
const crypto = require('crypto');

module.exports = {
  generateShortURL: (longURL, startIndex, endIndex) => {
    const hash = crypto.createHash('md5').update(longURL).digest('base64');
    return hash.substring(startIndex, endIndex + 1);
  },
};
```

**Giáº£i phÃ¡p cá»§a chÃºng ta Ä‘ang gáº·p váº¥n Ä‘á» gÃ¬?**

* Nhiá»u ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ cÃ¹ng dÃ¹ng chung 1 link gá»‘c, do Ä‘Ã³ link rÃºt gá»n sáº½ bá»‹ trÃ¹ng láº·p. VÃ  Ä‘iá»u nÃ y khÃ´ng thá»ƒ cháº¥p nháº­n Ä‘Æ°á»£c.
* Äiá»u gÃ¬ sáº½ xáº£y ra náº¿u nhÆ° 1 pháº§n nÃ o Ä‘Ã³ trong URL bá»‹ mÃ£ hoÃ¡. VÃ­ dá»¥ nhÆ° http://example.com/index.php?id=design vÃ  http://example.com/index.php%3Fid%3Ddesign lÃ  2 URL hoÃ n toÃ n giá»‘ng nhau nhÆ°ng mÃ  1 pháº§n URL Ä‘Ã£ bá»‹ mÃ£ hoÃ¡.

**Giáº£i quyáº¿t váº¥n Ä‘á» trÃªn nhÆ° tháº¿ nÃ o?**

CÃ³ 2 cÃ¡ch tiáº¿p cáº­n cÃ³ thá»ƒ giáº£i quyáº¿t Ä‘Æ°á»£c váº¥n Ä‘á» nÃ y.

* ChÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng 1 sá»‘ nguyÃªn tÄƒng dáº§n vÃ  gáº¯n vÃ o Ä‘áº§u má»—i link gá»‘c. Khi Ä‘Ã³ nÃ³ sáº½ luÃ´n Ä‘áº£m báº£o link gá»‘c cá»§a chÃºng ta lÃ  duy nháº¥t, ká»ƒ cáº£ cÃ³ nhiá»u ngÆ°á»i cÃ¹ng Ä‘iá»n vÃ o 1 link duy nháº¥t Ä‘i chÄƒng ná»¯a thÃ¬ link rÃºt gá»n sáº½ luÃ´n khÃ¡c nhau. VÃ  sau khi táº¡o xong link rÃºt gá»n thÃ¬ sá»‘ nguyÃªn nÃ y sáº½ tÄƒng thÃªm 1. NhÆ°ng mÃ  cÃ³ 1 váº¥n Ä‘á» lÃ  náº¿u tÄƒng mÃ£i thÃ¬ cÃ³ thá»ƒ sá»‘ nguyÃªn nÃ y sáº½ bá»‹ trÃ n sá»‘. HÆ¡n ná»¯a viá»‡c xá»­ lÃ½ tÄƒng dáº§n nÃ y cÅ©ng áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u suáº¥t cá»§a há»‡ thá»‘ng.
* CÃ¡ch khÃ¡c lÃ  chÃºng ta cÃ³ thá»ƒ thÃªm user_id vÃ o Ä‘áº§u má»—i URL. Tuy nhiÃªn náº¿u ngÆ°á»i dÃ¹ng chÆ°a Ä‘Äƒng nháº­p mÃ  muá»‘n táº¡o link rÃºt gá»n, khi Ä‘Ã³ chÃºng ta pháº£i yÃªu cáº§u nháº­p vÃ o 1 khoÃ¡ ná»¯a. VÃ  khoÃ¡ nÃ y pháº£i duy nháº¥t (Náº¿u khoÃ¡ nháº­p vÃ o khÃ´ng duy nháº¥t sáº½ yÃªu cáº§u nháº­p láº¡i, Ä‘áº¿n khi nÃ o duy nháº¥t thÃ¬ thÃ´i).

VÃ  dÆ°á»›i Ä‘Ã¢y sáº½ lÃ  flow cá»§a há»‡ thá»‘ng:

![](https://images.viblo.asia/a17e5bac-4c5b-4f0f-9213-c4c92a78890e.jpg)

Äáº§u tiÃªn ngÆ°á»i dÃ¹ng nháº­p link muá»‘n rÃºt gá»n, vÃ  áº¥n Enter. Khi Ä‘Ã³ request sáº½ Ä‘Æ°á»£c gá»­i Ä‘áº¿n Server.

á» Server sáº½ nháº­n request vÃ  chuyá»ƒn nÃ³ Ä‘áº¿n bá»™ pháº­n chuyÃªn xá»­ lÃ½ viá»‡c rÃºt gá»n link. MÃ¬nh gá»i Ä‘Ã³ lÃ  Encoding Service Ä‘i.

Encoding Service sáº½ thá»±c hiá»‡n xá»­ lÃ½ rÃºt gá»n URL:

* Náº¿u nhÆ° URL Ä‘Ã³ chÆ°a tá»“n táº¡i trong há»‡ thá»‘ng thÃ¬ sáº½ xá»­ lÃ½, lÆ°u link Ä‘Ã£ rÃºt gá»n vÃ o trong database Ä‘á»“ng thá»i tráº£ vá» cho server káº¿t quáº£.
* Náº¿u nhÆ° URL Ä‘Ã³ Ä‘Ã£ tá»“n táº¡i trong há»‡ thá»‘ng (tá»©c lÃ  cÃ³ ai Ä‘Ã³ Ä‘Ã£ sá»­ dá»¥ng URL nÃ y rá»“i). ThÃ¬ khi Ä‘Ã³ nÃ³ sáº½ thÃªm 1 sequence (sá»‘ nguyÃªn tÄƒng dáº§n) vÃ o Ä‘áº§u URL vÃ  thá»±c hiá»‡n rÃºt gá»n link. Sau Ä‘Ã³ lÆ°u link Ä‘Ã£ rÃºt gá»n vÃ o trong database Ä‘á»“ng thá»i tráº£ káº¿t qá»§a vá» cho server.

PhÃ­a Server nháº­n káº¿t quáº£ vÃ  sáº½ tráº£ vá» cho ngÆ°á»i dÃ¹ng.

## Data Partitioning and Replication

Náº¿u chÃºng ta lÆ°u táº¥t cáº£ 30 tá»‰ URL vÃ o trong DB, vÃ  cÃ³ tá»›i 20K request/s call vÃ o DB. ThÃ¬ khi Ä‘Ã³ cÃ³ thá»ƒ DB sáº½ chá»‹u táº£i khÃ¡ lá»›n vÃ  dáº«n Ä‘áº¿n down. Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y thÃ¬ cÃ³ 2 giáº£i phÃ¡p:

* PhÃ¢n vÃ¹ng dá»¯ liá»‡u trong database (Data Partitioning). Tá»©c lÃ  chÃºng ta sáº½ tÃ¡ch DB ra thÃ nh nhiá»u con DB khÃ¡c nhau. Má»—i con sáº½ chá»©a 1 pháº§n dá»¯ liá»‡u.
* Cache láº¡i URL nÃ o mÃ  hay gá»i Ä‘á»ƒ giáº£m thiá»ƒu query Ä‘áº¿n DB (mÃ¬nh sáº½ giáº£i thÃ­ch cÃ¡i nÃ y trong pháº§n tiáº¿p theo)

Äá»‘i vá»›i Data Partitioning thÃ¬ sáº½ cÃ³ 2 loáº¡i:

### Range Based Partitioning
Loáº¡i phÃ¢n vÃ¹ng nÃ y sáº½ dá»±a vÃ o chá»¯ cÃ¡i Ä‘áº§u tiÃªn trong URL hoáº·c hash key Ä‘á»ƒ phÃ¢n chia dá»¯ liá»‡u.

VÃ­ dá»¥ nhÆ° nhá»¯ng URL (bá» qua pháº§n https:// hay http://) mÃ  báº¯t Ä‘áº§u báº±ng tá»« â€œaâ€ thÃ¬ sáº½ cho vÃ o DB loáº¡i â€œaâ€. Nhá»¯ng URL nÃ o báº¯t Ä‘áº§u báº±ng chá»¯ â€œbâ€ sáº½ cho vÃ o trong database loáº¡i â€œbâ€.

Náº¿u nhÆ° phÃ¢n vÃ¹ng dá»±a vÃ o chá»¯ cÃ¡i Ä‘áº§u tiÃªn nÃ y thÃ¬ chÃºng ta sáº½ cáº§n 26 con database khÃ¡c nhau (tá»« a -> z)

NhÆ°ng mÃ  giáº£i phÃ¡p nÃ y cÃ³ thá»ƒ gáº·p váº¥n Ä‘á» lÃ  giáº£ sá»­ chÃºng ta cho táº¥t cáº£ URL báº¯t Ä‘áº§u báº±ng chá»¯ â€œfâ€ vÃ o trong database loáº¡i â€œfâ€. NhÆ°ng cháº³ng may táº¥t cáº£ URL báº¯t Ä‘áº§u báº±ng chá»¯ â€œfâ€ nÃ y láº¡i lÃ  nhá»¯ng URL cÃ³ access lá»›n nháº¥t. Khi Ä‘Ã³ con DB loáº¡i â€œfâ€ nÃ y láº¡i chá»‹u táº£i khÃ¡ lá»›n.

ChÃº Ã½: Kiá»ƒu phÃ¢n vÃ¹ng dá»±a vÃ o chá»¯ cÃ¡i Ä‘áº§u tiÃªn nÃ y chá»‰ lÃ  1 vÃ­ dá»¥ thÃ´i nhÃ©, cÃ¡c báº¡n cÃ³ thá»ƒ tá»± nghÄ© ra thuáº­t toÃ¡n riÃªng cho mÃ¬nh Ä‘á»ƒ phÃ¢n vÃ¹ng dá»¯ liá»‡u cho há»£p lÃ­ vÃ  hiá»‡u quáº£. Chá»© khÃ´ng nháº¥t thiáº¿t cá»© pháº£i chá»n chá»¯ cÃ¡i Ä‘áº§u tiÃªn Ä‘á»ƒ phÃ¢n vÃ¹ng.

### Hash-Based Partitioning

Loáº¡i nÃ y chÃºng ta sáº½ láº¥y giÃ¡ trá»‹ hash cá»§a object Ä‘ang Ä‘Æ°á»£c lÆ°u trá»¯. Sau Ä‘Ã³ sáº½ tÃ­nh toÃ¡n xem phÃ¢n vÃ¹ng nÃ o sáº½ Ä‘Æ°á»£c xá»­ dá»¥ng dá»±a vÃ o hÃ m bÄƒm. ChÃºng ta cÃ³ thá»ƒ láº¥y giÃ¡ trá»‹ hash cá»§a primary key, hoáº·c lÃ  link gá»‘c Ä‘á»ƒ xÃ¡c Ä‘á»‹nh xem phÃ¢n vÃ¹ng nÃ o sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ dá»¯ liá»‡u.

## Cache

Äá»‘i vá»›i há»‡ thá»‘ng hÃ ng tá»‰ click má»—i thÃ¡ng thÃ¬ cache server lÃ  thá»© khÃ´ng thá»ƒ thiáº¿u Ä‘Æ°á»£c.

**LÃ­ do táº¡i sao chÃºng ta cáº§n 1 cache server?**

Flow chuáº©n sáº½ lÃ :

* BÆ°á»›c 1: ngÆ°á»i dÃ¹ng accees Ä‘áº¿n link rÃºt gá»n
* BÆ°á»›c 2: chÃºng ta pháº£i vÃ o DB Ä‘á»ƒ láº¥y ra link gá»‘c tá»« link rÃºt gá»n
* BÆ°á»›c 3: chuyá»ƒn hÆ°á»›ng ngÆ°á»i dÃ¹ng Ä‘áº¿n link gá»‘c.

Náº¿u khÃ´ng cÃ³ cache server thÃ¬ cá»© má»—i láº§n nhÆ° váº­y sáº½ pháº£i vÃ o trong DB Ä‘á»ƒ láº¥y káº¿t quáº£. VÃ  dáº«n Ä‘áº¿n DB sáº½ pháº£i chá»‹u táº£i khÃ¡ lá»›n. Äá»ƒ giáº£m thiá»ƒu query Ä‘áº¿n DB, chÃºng ta sáº½ cache láº¡i káº¿t quáº£ truy váº¥n trÆ°á»›c Ä‘Ã³. Äá»ƒ tá»« láº§n sau náº¿u ngÆ°á»i dÃ¹ng cÃ³ truy cáº­p vÃ o link rÃºt gá»n thÃ¬ lÃºc nÃ y chÃºng ta chá»‰ cáº§n vÃ o cache láº¥y ra lÃ  xong, mÃ  khÃ´ng pháº£i query vÃ o DB Ä‘á»ƒ láº¥y káº¿t quáº£ ná»¯a.

VÃ¬ Cache Server sáº½ luÃ´n lÆ°u dá»¯ liá»‡u trÃªn memory. NÃªn so vá»›i viá»‡c láº¥y káº¿t quáº£ tá»« DB thÃ¬ viá»‡c láº¥y káº¿t quáº£ tá»« memory sáº½ nhanh hÆ¡n ráº¥t nhiá»u láº§n.

**ChÃºng ta cáº§n dÃ¹ng Cache Server nÃ o?**

Hiá»‡n nay thÃ¬ cÃ³ ráº¥t nhiá»u cache server nhÆ° Redis, Memcache. MÃ¬nh tháº¥y nÃ³ khÃ¡ ná»•i tiáº¿ng vÃ  cÅ©ng Ä‘ang Ä‘Æ°á»£c dÃ¹ng khÃ¡ rá»™ng rÃ£i trÃªn cÃ¡c há»‡ thá»‘ng lá»›n trÃªn tháº¿ giá»›i.

TrÆ°á»›c mÃ¬nh lÃ m cÃ´ng ty vá» Game vÃ  há»‡ thá»‘ng bÃªn mÃ¬nh lÃºc Ä‘Ã³ dÃ¹ng Redis vÃ  mÃ¬nh tháº¥y nÃ³ khÃ¡ á»•n vÃ  support ráº¥t nhiá»u chá»©c nÄƒng. VÃ­ dá»¥ nhÆ° tá»± Ä‘á»™ng xáº¿p háº¡ng ranking káº¿t quáº£, cÃ³ thá»ƒ sync dá»¯ liá»‡u giá»¯a memory vÃ  storage Ä‘á»ƒ phÃ²ng trÃ¡nh máº¥t dá»¯ liá»‡uâ€¦

NÃªn náº¿u báº¡n nÃ o chÆ°a biáº¿t nÃªn dÃ¹ng cÃ¡i nÃ o thÃ¬ mÃ¬nh khuyÃªn nÃªn tÃ¬m hiá»ƒu vÃ  implement tháº±ng Redis nÃ y.

**ChÃºng ta cáº§n bao nhiÃªu GB memory?**

NhÆ° pháº§n trÆ°á»›c mÃ¬nh Ä‘Ã£ tÃ­nh toÃ¡n lÃ  há»‡ thá»‘ng nÃ y sáº½ dÃ¹ng Ä‘áº¿n 170GB memory Ä‘á»ƒ cache 20% URL. MÃ  hiá»‡n nay server cÃ³ 256GB memory cÅ©ng khÃ¡ nhiá»u nÃªn thá»«a sá»©c giáº£i quyáº¿t váº¥n Ä‘á» nÃ y.

NgoÃ i ra chÃºng ta cÃ³ thá»ƒ tá»• há»£p nhiá»u server nhá» (má»—i server cÃ³ 8GB memory cháº³ng háº¡n) Ä‘á»ƒ cache cÃ¡c URL Ä‘Ã³ láº¡i cÅ©ng Ä‘Æ°á»£c cáº£.

**Náº¿u cache full thÃ¬ lÃ m tháº¿ nÃ o?**

Äa sá»‘ há»‡ thá»‘ng cache Ä‘á»u thá»±c hiá»‡n theo 1 sá»‘ cÆ¡ cháº¿ nhÆ° LRU (Least Recently Used) hay LFU (Least Frequently Used).

* LRU (Least Recently Used): bá» Ä‘i cÃ¡c item trong cache Ã­t Ä‘Æ°á»£c dÃ¹ng gáº§n Ä‘Ã¢y nháº¥t.
* LFU (Least Frequently Used): bá» Ä‘i cÃ¡c item trong cache Ã­t Ä‘Æ°á»£c sá»­ dá»¥ng nháº¥t.

Do cÃ³ cÃ¡c cÆ¡ cháº¿ nÃ y nÃªn cache sáº½ luÃ´n Ä‘Æ°á»£c lÃ m má»›i Ä‘á»ƒ trÃ¡nh viá»‡c dÃ¹ng full.

**CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cá»§a Cache Server:**

MÃ¬nh sáº½ giáº£i thÃ­ch qua vá» cÆ¡ cháº¿ cá»§a Cache Server nhÃ©:

* Äáº§u tiÃªn ngÆ°á»i dÃ¹ng access Ä‘áº¿n link rÃºt gá»n.
* Khi Ä‘Ã³, application server sáº½ check xem cÃ³ káº¿t quáº£ á»Ÿ trong cache khÃ´ng?
* Náº¿u káº¿t quáº£ khÃ´ng cÃ³ trong cache, thÃ¬ nÃ³ sáº½ thá»±c hiá»‡n truy váº¥n Ä‘áº¿n DB Ä‘á»ƒ láº¥y káº¿t quáº£ vÃ  tráº£ vá» cho ngÆ°á»i dÃ¹ng. Äá»“ng thá»i update káº¿t quáº£ vÃ o trong cache Ä‘á»ƒ phá»¥c vá»¥ cho láº§n sau.
* Náº¿u káº¿t quáº£ cÃ³ trong cache thÃ¬ sáº½ láº¥y luÃ´n káº¿t quáº£ vÃ  tráº£ vá» cho ngÆ°á»i dÃ¹ng.

CÃ¡c báº¡n tháº¥y cÆ¡ cháº¿ khÃ¡ Ä‘Æ¡n giáº£n pháº£i khÃ´ng nÃ o.

## Load Balancer

Vá»›i há»‡ thá»‘ng nhiá»u access nhÆ° há»‡ thá»‘ng nÃ y thÃ¬ 1 web server chÆ°a cháº¯c Ä‘Ã£ chá»‹u táº£i Ä‘Æ°á»£c. Äá»ƒ giáº£i quyáº¿t bÃ i toÃ¡n nÃ y thÃ¬ mÃ¬nh sáº½ dÃ¹ng nhiá»u web server. Má»—i web server sáº½ chá»‹u 1 pháº§n request tá»« ngÆ°á»i dÃ¹ng.

CÃ¢u há»i Ä‘áº·t ra lÃ  lÃ m tháº¿ nÃ o cÃ³ thá»ƒ tá»± Ä‘á»™ng phÃ¢n request Ä‘áº¿n tá»«ng con web server khÃ¡c nhau?

VÃ  Load Balancer Ä‘Ã£ ra Ä‘á»i Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y.

VÃ­ dá»¥ nhÆ° dÆ°á»›i Load Balancer cÃ³ 1 sá»‘ con web server. Láº§n 1 request tá»« Client gá»­i Ä‘áº¿n Load Balancer sáº½ Ä‘Æ°á»£c forward Ä‘áº¿n con web server 1. Láº§n 2 sáº½ Ä‘Æ°á»£c gá»­i Ä‘áº¿n con web server 2 â€¦.

Hiá»‡n nay 1 sá»‘ nhÃ  cung cáº¥p server nhÆ° AWS, Google hay Azure Ä‘á»u support Load Balancer cáº£. NÃªn cÃ¡c báº¡n khÃ´ng cáº§n pháº£i lo láº¯ng vá» viá»‡c pháº£i build 1 con load balancer. Chá»‰ viá»‡c cÃ i Ä‘áº·t vÃ  dÃ¹ng lÃ  xong.

## Kiáº¿n trÃºc toÃ n bá»™ há»‡ thá»‘ng

Sau khi Ä‘Ã£ hiá»ƒu qua háº¿t cÃ¡c thÃ nh pháº§n thÃ¬ mÃ¬nh tá»•ng há»£p láº¡i kiáº¿n trÃºc tá»•ng thá»ƒ cá»§a há»‡ thá»‘ng nhÆ° sau:
![](https://images.viblo.asia/10e21dfd-5f31-429b-8d71-cb96fe352bef.jpg)

## Káº¿t luáº­n

Äá»c qua bÃ i nÃ y cháº¯c háº³n cÃ¡c báº¡n cÅ©ng cÃ³ 1 chÃºt tÆ° duy trong viá»‡c thiáº¿t káº¿ há»‡ thá»‘ng lá»›n phá»¥c vá»¥ hÃ ng triá»‡u ngÆ°á»i dÃ¹ng nÃ³ nhÆ° tháº¿ nÃ o rá»“i pháº£i khÃ´ng?

Sau khi Ä‘Ã£ cÃ³ tÆ° duy rá»“i thÃ¬ mÃ¬nh nghÄ© náº¿u gáº·p pháº£i 1 há»‡ thá»‘ng tÆ°Æ¡ng tá»± nhÆ° tháº¿ thÃ¬ cÃ¡c báº¡n cÅ©ng thá»«a sá»©c Ä‘á»ƒ giáº£i quyáº¿t. 

VÃ¬ nhiá»u báº¡n má»›i ra trÆ°á»ng hay nhá»¯ng báº¡n chÆ°a tá»«ng lÃ m trong cÃ¡c há»‡ thá»‘ng lá»›n cháº¯c chÆ°a hÃ¬nh dung Ä‘Æ°á»£c nÃªn báº¯t Ä‘áº§u tá»« Ä‘Ã¢u, nÃªn sá»­ dá»¥ng cÃ´ng nghá»‡ nÃ o. ThÃ¬ qua bÃ i nÃ y hi vá»ng sáº½ giÃºp cÃ¡c báº¡n giáº£i Ä‘Ã¡p nhá»¯ng tháº¯c máº¯c Ä‘Ã³.

Nguá»“n: [https://nghethuatcoding.com/2019/05/13/thiet-ke-he-thong-url-shortening/](https://nghethuatcoding.com/2019/05/13/thiet-ke-he-thong-url-shortening/)

==============

Äá»ƒ nháº­n thÃ´ng bÃ¡o khi cÃ³ bÃ i viáº¿t má»›i nháº¥t thÃ¬ cÃ¡c báº¡n cÃ³ thá»ƒ like fanpage cá»§a mÃ¬nh á»Ÿ bÃªn dÆ°á»›i nhÃ©:

ğŸ‘‰ğŸ‘‰ğŸ‘‰ [Nghá»‡ thuáº­t Coding Fanpage Facebook](https://www.facebook.com/669339543503374)

ChÃºc cÃ¡c báº¡n 1 tuáº§n tháº­t vui váº».