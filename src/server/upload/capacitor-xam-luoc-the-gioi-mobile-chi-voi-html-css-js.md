Báº¡n lÃ  má»™t tech lead chuyÃªn vá» web nhÆ°ng bá»—ng má»™t ngÃ y bá»‹ báº¯t pháº£i triá»ƒn khai sáº£n pháº©m cho ná»n táº£ng di Ä‘á»™ng trong thá»i gian ngáº¯n? Hay lÃ  má»™t front-end/back-end/full-stack web dev Ä‘ang muá»‘n láº¥n sÃ¢n sang mobile nhÆ°ng khÃ´ng biáº¿t báº¯t Ä‘áº§u tá»« Ä‘Ã¢u? Hoáº·c báº¡n Ä‘ang cÃ³ má»™t Ã½ tÆ°á»Ÿng Ä‘á»™c Ä‘Ã¡o vá» mobile app cÃ³ thá»ƒ kiáº¿m ğŸš cho mÃ¬nh nhÆ°ng chá»‰ biáº¿t má»—i HTML, CSS vÃ  JS? Hay chá»‰ lÃ  má»™t cá»‘t Ä‘Æ¡ quÃ¨n, muá»‘n khÃ¡m phÃ¡, má»Ÿ rá»™ng kiáº¿n thá»©c nhÆ°ng nÄƒng lá»±c cÃ³ háº¡n, khÃ´ng thá»ƒ nhá»“i nhÃ©t Ä‘Æ°á»£c nhiá»u thá»© giá»‘ng mÃ¬nh ğŸ˜”

**Capacitor** chÃ­nh lÃ  giáº£i phÃ¡p cho anh em ta. CÃ¹ng mÃ¬nh tÃ¬m hiá»ƒu vá» **Capacitor** vÃ  nhá»¯ng Æ°u tháº¿ mÃ  nÃ³ mang láº¡i cho dÃ¢n web trong viá»‡c phÃ¡t triá»ƒn má»™t á»©ng dá»¥ng di Ä‘á»™ng qua bÃ i viáº¿t nÃ y nhÃ©.

> Disclaimer: Capacitor cÅ©ng chá»‰ lÃ  má»™t trong nhiá»u giáº£i phÃ¡p giÃºp anh em dev cÃ³ nhiá»u lá»±a chá»n Ä‘á»ƒ giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» tÃ¹y yÃªu cáº§u, trÆ°á»ng há»£p, hoÃ n cáº£nh vÃ  resources. NÃªn trong bÃ i viáº¿t nÃ y, mÃ¬nh chá»‰ táº­p trung giá»›i thiá»‡u, hÆ°á»›ng dáº«n vá» Capacitor chá»© khÃ´ng chá»‰ ra nhá»¯ng Æ°u, nhÆ°á»£c Ä‘iá»ƒm so vá»›i cÃ¡c giáº£i phÃ¡p tÆ°Æ¡ng tá»± nhÆ° Cordova, PWA, hay React Native...

# Má»™t Ã­t lÃ½ thuyáº¿t

![capacitorjs.jpg](https://images.viblo.asia/1d405b53-b753-418a-aa6c-b11bd51b6e93.jpg)

> A cross-platform native runtime for web apps.

Táº¡m dá»‹ch: Thá»i gian cháº¡y báº©m sinh Ä‘a ná»n táº£ng dÃ nh cho á»©ng dá»¥ng web??? Wtf??? Äá»c tiáº¿ng Anh thÃ¬ khÃ³ hiá»ƒu, mÃ  dá»‹ch ra nghe vá»«a cá»§ chuá»‘i, vá»«a khÃ³ hiá»ƒu hÆ¡n ğŸ˜‚ NhÆ°ng Ä‘Ã³ lÃ  dÃ²ng chá»¯ to bá»± ngay trÃªn [trang chá»§](https://capacitorjs.com) Ä‘á»ƒ giá»›i thiá»‡u vá» **Capacitor**, má»™t sáº£n pháº©m thuá»™c ná»n táº£ng [Ionic](https://ionic.io/) do bá»™ Ä‘Ã´i [Max Lynch](https://github.com/mlynch) vÃ  [Ben Sperry](https://github.com/bensperry) Ä‘á»“ng sÃ¡ng láº­p vÃ  phÃ¡t triá»ƒn. Giáº£i thÃ­ch Ä‘Æ¡n giáº£n thÃ¬ Capacitor lÃ  má»™t cÃ´ng cá»¥ cho phÃ©p anh em dev cÃ³ thá»ƒ xÃ¢y dá»±ng nhá»¯ng á»©ng dá»¥ng di Ä‘á»™ng trÃªn Android vÃ  iOS chá»‰ vá»›i cÃ´ng nghá»‡ web cÆ¡ báº£n nhÆ° HTML, CSS, JS, hoáº·c cao hÆ¡n lÃ  Angular, React, Vue..., hoáº·c cao hÆ¡n ná»¯a lÃ  Nextjs, Nuxt, Quasar...

## CÆ¡ cháº¿ lÃ m viá»‡c

> Äoáº¡n nÃ y mÃ¬nh cÅ©ng chá»‰ dá»‹ch má»™t pháº§n tá»« bÃ i blog cá»§a Max Lynch, cÃ¡c báº¡n gÃºt tiáº¿ng Anh cÃ³ thá»ƒ Ä‘á»c trá»±c tiáº¿p bÃ i blog cá»§a anh Ä‘á»ƒ hiá»ƒu rÃµ hÆ¡n táº¡i [Ä‘Ã¢y](https://capacitorjs.com/blog/how-capacitor-works).

![How capacitor works - basic](https://images.viblo.asia/40052ed9-275d-4b76-b2c7-6bb420e201e2.png)

Vá» cÆ¡ báº£n, Capacitor lÃ  cáº§u ná»‘i giÃºp cho á»©ng dá»¥ng web Ä‘Æ°á»£c viáº¿t tá»« HTML, CSS, JS cÃ³ thá»ƒ cháº¡y vÃ  giao tiáº¿p vá»›i cÃ¡c ná»n táº£ng mobile nhÆ° Android hay iOS. Äi sÃ¢u hÆ¡n chÃºt thÃ¬ cÃ¡c báº¡n cÃ³ thá»ƒ tháº¥y Capacitor gá»“m nhá»¯ng thÃ nh pháº§n sau:

![How capacitor works - advanced](https://images.viblo.asia/58b84cc1-a9d3-4262-94b9-0d23a0e4ee45.png)

Trong sÆ¡ Ä‘á»“ trÃªn, cÃ¡c báº¡n hÃ£y chÃº Ã½ Ä‘áº¿n má»™t thÃ nh pháº§n quan trá»ng lÃ  **Web View**, nÃ³ lÃ  má»™t pháº§n khÃ´ng thá»ƒ thiáº¿u cá»§a há»‡ Ä‘iá»u hÃ nh Android vÃ  iOS. Web View cho phÃ©p hiá»ƒn thá»‹ trang web giá»‘ng nhÆ° má»™t web browser nÃªn cÃ¡c web app cÅ©ng sáº½ hoáº¡t Ä‘á»™ng tá»‘t. Táº­n dá»¥ng Ä‘iá»u nÃ y, Capacitor gÃ³i gá»n web app cá»§a chÃºng ta trong Web View, rá»“i hoáº¡t Ä‘á»™ng nhÆ° má»™t cáº§u ná»‘i giÃºp tÆ°Æ¡ng tÃ¡c vá»›i cÃ¡c tÃ­nh nÄƒng "native" (tá»©c cÃ¡c tÃ­nh nÄƒng Ä‘áº·c thÃ¹ cá»§a há»‡ Ä‘iá»u hÃ nh, vÃ­ dá»¥ Ä‘á»ƒ má»Ÿ má»™t dialog, Android sáº½ cÃ³ cÃ¡ch implement khÃ¡c, iOS cÃ³ cÃ¡ch implement khÃ¡c), khi cáº§n sá»­ dá»¥ng tÃ­nh nÄƒng nÃ o, chá»‰ cáº§n gá»i Ä‘áº¿n tÃ­nh nÄƒng Ä‘Ã³ thÃ´ng qua API.

Äá»‘i vá»›i nhá»¯ng báº¡n Ä‘Ã£ cÃ³ kinh nghiá»‡m trong máº£ng mobile thÃ¬ cháº¯c khÃ´ng cÃ²n xa láº¡ vá»›i mÃ´ hÃ¬nh nÃ y, Ä‘Ã¢y cÃ²n Ä‘Æ°á»£c gá»i lÃ  mÃ´ hÃ¬nh á»©ng dá»¥ng **Hybrid**.

Vá»›i cÃ¡ch thá»©c trÃªn, chÃºng ta cÃ³ thá»ƒ phÃ¡t triá»ƒn mobile app cho nhiá»u ná»n táº£ng chá»‰ vá»›i má»™t codebase viáº¿t tá»« ngÃ´n ngá»¯ web, báº±ng báº¥t kÃ¬ cÃ´ng nghá»‡ web nÃ o mÃ  team Ä‘Ã£ lá»±a chá»n, hoáº·c tháº­m chÃ­ lÃ  má»™t web app Ä‘Ã£ hoÃ n thiá»‡n váº«n cÃ³ thá»ƒ tÃ­ch há»£p Capacitor Ä‘á»ƒ trá»Ÿ thÃ nh má»™t mobile app mÃ  khÃ´ng pháº£i thay Ä‘á»•i nhiá»u vá» codebase.

## Há»‡ sinh thÃ¡i plugin

NhÆ° Ä‘Ã£ ká»ƒ trÃªn, cÃ¡c tÃ­nh nÄƒng "native" cá»§a mobile Ä‘Æ°á»£c Capacitor "bridge" Ä‘á»ƒ web app cá»§a chÃºng ta cÃ³ thá»ƒ gá»i báº¥t kÃ¬ lÃºc nÃ o thÃ´ng qua API. Nhá»¯ng tÃ­nh nÄƒng native tá»“n táº¡i dÆ°á»›i dáº¡ng "plugin". VÃ­ dá»¥ nhÆ° app cá»§a mÃ¬nh cáº§n chá»©c nÄƒng rung Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i ngÆ°á»i dÃ¹ng, mÃ¬nh cÃ³ thá»ƒ cÃ i Ä‘áº·t plugin [Haptics](https://capacitorjs.com/docs/apis/haptics), rá»“i tá»« code JS gá»i `Haptics.vibrate()` Ä‘á»ƒ rung thiáº¿t bá»‹ cá»§a ngÆ°á»i dÃ¹ng ğŸ“³ QuÃ¡ Æ° lÃ  Ä‘Æ¡n giáº£n.

NgoÃ i Haptics thÃ¬ cÃ²n ráº¥t ráº¥t nhiá»u plugin Ä‘Æ°á»£c cáº£ team core cá»§a Capacitor láº«n cá»™ng Ä‘á»“ng dev phÃ¡t triá»ƒn Ä‘á»ƒ chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng ngay vÃ  luÃ´n. CÃ¡c báº¡n cÃ³ thá»ƒ xem danh sÃ¡ch cÃ¡c plugin nhÆ° bÃªn dÆ°á»›i:

* Plugin chÃ­nh thá»‘ng cá»§a team core: https://capacitorjs.com/docs/apis
* Plugin cá»§a cá»™ng Ä‘á»“ng: https://github.com/capacitor-community

Nhá»¯ng plugin nÃ y thá»±c cháº¥t Ä‘Æ°á»£c viáº¿t báº±ng ngÃ´n ngá»¯ Ä‘áº·c thÃ¹ cá»§a há»‡ Ä‘iá»u hÃ nh, vÃ­ dá»¥ Ä‘á»‘i vá»›i plugin Haptics, Ä‘á»ƒ xÃ¢y dá»±ng API rung thiáº¿t bá»‹ lÃ  `Haptics.vibrate()`, team Capacitor Ä‘Ã£ pháº£i viáº¿t cáº£ 2 ngÃ´n ngá»¯ cho 2 ná»n táº£ng lÃ  Android (báº±ng Java) vÃ  iOS (báº±ng Swift) nhÆ° cÃ¡c báº¡n cÃ³ thá»ƒ tháº¥y táº¡i github [repo nÃ y](https://github.com/ionic-team/capacitor-plugins/tree/main/haptics). TÆ°á»Ÿng Ä‘Æ¡n giáº£n nhÆ°ng láº¡i khÃ´ng há» giáº£n Ä‘Æ¡n, nhÆ°ng cÃ¡c báº¡n cá»© yÃªn tÃ¢m, cháº¯c 99% trÆ°á»ng há»£p cÃ¡c plugin cÃ³ sáºµn Ä‘Ã£ Ä‘á»§ Ä‘á»ƒ phá»¥c vá»¥ nhu cáº§u cá»§a chÃºng ta, 1% cÃ²n láº¡i thÃ¬ ~~khÃ³ quÃ¡ bá» qua~~ chÃºng ta cÃ³ thá»ƒ tá»± táº¡o plugin cho riÃªng mÃ¬nh ğŸ˜‚

NgoÃ i ra, trong 99% Ä‘Ã³ cÃ²n cÃ³ cáº£ cÃ¡c plugin tá»« Cordova, Capacitor Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ tÆ°Æ¡ng thÃ­ch vá»›i khÃ¡ nhiá»u plugin cá»§a Cordova/PhoneGap (tiá»n bá»‘i cá»§a Capacitor, cÃ¹ng Ã½ tÆ°á»Ÿng vÃ  cÃ¡ch thá»©c á»©ng dá»¥ng mÃ´ hÃ¬nh Hybrid apps). CÃ¡ch cÃ i Ä‘áº·t vÃ  sá»­ dá»¥ng cÅ©ng tÆ°Æ¡ng Ä‘á»‘i Ä‘Æ¡n giáº£n. Tiá»‡n hÆ¡n ná»¯a lÃ , do Ä‘a sá»‘ cÃ¡c plugin cá»§a Cordova Ä‘Æ°á»£c viáº¿t báº±ng JS nÃªn cá»™ng Ä‘á»“ng dev cÃ²n xÃ¢y dá»±ng cÃ¡c TypeScript wrapper Ä‘Æ°á»£c táº­p há»£p táº¡i [repo nÃ y](https://github.com/danielsogl/awesome-cordova-plugins), giÃºp cÃ¡c plugin nÃ y cÃ ng dá»… sá»­ dá»¥ng vÃ  tÆ°á»ng minh hÆ¡n.

# Biáº¿n web app thÃ nh mobile app

á» Ä‘Ã¢y mÃ¬nh chá»n má»™t web app [To-do list](https://github.com/ha-manel/Todo-list) ngáº«u nhiÃªn trÃªn github:

![Capacitor todo app demo](https://images.viblo.asia/ac4cb4b1-f3a3-4aa5-b81d-dbc376e43bee.png)

App nÃ y Ä‘Ã£ Ä‘Æ°á»£c code Ä‘áº§y Ä‘á»§ cÃ¡c chá»©c nÄƒng cÆ¡ báº£n, giá» mÃ¬nh thá»­ tÃ­ch há»£p Capacitor Ä‘á»ƒ biáº¿n nÃ³ thÃ nh má»™t Android app cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c tÃ­nh nÄƒng "native" nhÆ° sau:

* Khi user thÃªm, sá»­a hay xÃ³a má»™t item, sáº½ cÃ³ má»™t thÃ´ng bÃ¡o toast hiá»‡n ra - dÃ¹ng [Toast plugin](https://capacitorjs.com/docs/apis/toast)
* Khi user tick hoÃ n thÃ nh má»™t item, thiáº¿t bá»‹ cá»§a há» sáº½ rung lÃªn - dÃ¹ng [Haptics plugin](https://capacitorjs.com/docs/apis/haptics)

Chá»‰ vá»›i 3 bÆ°á»›c nhÆ° trÃªn trang chá»§, chÃºng ta cÃ¹ng báº¯t tay thá»±c hiá»‡n.

## 1. CÃ i Ä‘áº·t CLI + core package vÃ  khá»Ÿi táº¡o

```sh
npm install @capacitor/cli @capacitor/core
npx cap init
```

Terminal sau Ä‘Ã³ sáº½ yÃªu cáº§u nháº­p cÃ¡c thÃ´ng tin cáº§n thiáº¿t Ä‘á»ƒ khá»Ÿi táº¡o, nhÆ° tÃªn app, package ID cá»§a app trÃªn Play Store/App Store, vÃ  thÆ° má»¥c sau khi build cÃ³ chá»©a file `index.html` Ä‘á»ƒ Capacitor nháº­n diá»‡n. Trong vÃ­ dá»¥ nÃ y mÃ¬nh Ä‘Ã£ Ä‘iá»n nhÆ° sau:

![Capacitor todo app init](https://images.viblo.asia/95836b17-9d74-4027-aecb-fb7f44877cdd.png)

## 2. CÃ i Ä‘áº·t platform package

Do mÃ¬nh chá»‰ muá»‘n táº¡o má»™t Android app nÃªn mÃ¬nh chá»‰ cáº§n cháº¡y lá»‡nh sau Ä‘á»ƒ cÃ i Ä‘áº·t cho Android:

```sh
npm install @capacitor/android
npx cap add android
```

Äá»ƒ cÃ i Ä‘áº·t cho cáº£ 2 ná»n táº£ng, cÃ¡c báº¡n cÃ³ thá»ƒ thÃªm package `@capacitor/ios` rá»“i gá»i `npx cap add ios` tÆ°Æ¡ng tá»±.

## 3. Sá»­a code Ä‘á»ƒ dÃ¹ng tÃ­nh nÄƒng "native" vÃ  build app

NhÆ° Ä‘Ã£ ká»ƒ trÃªn, mÃ¬nh sáº½ cÃ i thÃªm 2 plugin lÃ  Toast vÃ  Haptics Ä‘á»ƒ tÃ­ch há»£p tÃ­nh nÄƒng "native":

```sh
npm install @capacitor/toast @capacitor/haptics
```

Trong [`src/tasks.js`](https://github.com/khang-nd/Todo-list-capacitor/commit/5afd736e3b36392a88d504aac4e25e296f10108a#diff-c1d699dd6ae4e4cefe908d90f96a49b3558667f84b81ec5e1d503dae12530786), mÃ¬nh import Toast plugin vÃ  gá»i hÃ m `Toast.show()` Ä‘á»ƒ hiá»‡n thÃ´ng bÃ¡o má»—i khi user add/update/remove má»™t item.

Trong [`src/status.js`](https://github.com/khang-nd/Todo-list-capacitor/commit/5afd736e3b36392a88d504aac4e25e296f10108a#diff-80a15cbd42e84124b3fcd0e2c35058874b26dc1e702f1db24387e20e999e6646), mÃ¬nh import Haptics plugin vÃ  gá»i hÃ m `Haptics.vibrate()` Ä‘á»ƒ rung thiáº¿t bá»‹ cá»§a user khi há» tick hoÃ n thÃ nh má»™t item.

Sau Ä‘Ã³, build source vÃ  Ä‘á»“ng bá»™ vá»›i thÆ° má»¥c `android` báº±ng lá»‡nh:

```sh
npm run build
npx cap sync
```


### 3.x. DÃ¹ng Android Studio Ä‘á»ƒ Ä‘Ã³ng gÃ³i source code thÃ nh app

á» bÆ°á»›c nÃ y cÃ³ thá»ƒ sáº½ cÃ³ báº¡n tháº¯c máº¯c: sao pháº£i dÃ¹ng Android Studio? tÆ°á»Ÿng Capacitor hÃ´ biáº¿n web app thÃ nh mobile app luÃ´n mÃ  khÃ´ng cáº§n IDE Ä‘áº·c thÃ¹ cá»§a ná»n táº£ng/há»‡ Ä‘iá»u hÃ nh Ä‘Ã³ chá»©? LÃ½ do lÃ  vÃ¬ Capacitor khÃ´ng hoáº¡t Ä‘á»™ng nhÆ° váº­y. NhÆ° Ä‘Ã£ nÃ³i trÃªn, Capacitor chá»‰ Ä‘Ã³ng vai trÃ² lÃ  cáº§u ná»‘i giá»¯a codebase web cá»§a báº¡n vá»›i mÃ´i trÆ°á»ng "native" cá»§a há»‡ Ä‘iá»u hÃ nh, Ä‘Æ¡n giáº£n hÃ³a cÃ¡c bÆ°á»›c trong quy trÃ¬nh phÃ¡t triá»ƒn mobile app, tuy nhiÃªn, viá»‡c Ä‘Ã³ng gÃ³i code vÃ  build thÃ nh má»™t mobile app váº«n pháº£i do cÃ¡c IDE lÃ  **Android Studio** (Ä‘á»‘i vá»›i Android) hay **Xcode** (Ä‘á»‘i vá»›i iOS) Ä‘áº£m nháº­n. NhÆ°ng bÆ°á»›c nÃ y cÅ©ng khÃ´ng quÃ¡ phá»©c táº¡p nÃªn cÃ¡c báº¡n khÃ´ng pháº£i lo láº¯ng.

Äá»ƒ cÃ i Ä‘áº·t Android Studio, cÃ¡c báº¡n cá»© lÃªn [trang chá»§](https://developer.android.com/studio) táº£i vá» rá»“i tiáº¿n hÃ nh cÃ i Ä‘áº·t bÃ¬nh thÆ°á»ng. Sau khi cÃ i Ä‘áº·t, cÃ¡c báº¡n cÃ³ thá»ƒ má»Ÿ Android Studio cÃ¹ng vá»›i project cá»§a mÃ¬nh báº±ng lá»‡nh `npx cap open android`. Äá»£i tÃ­ Ä‘á»ƒ gradle tá»± Ä‘á»™ng cÃ i Ä‘áº·t cÃ¡c package cáº§n thiáº¿t cho app. Cuá»‘i cÃ¹ng, cÃ¡c báº¡n cÃ³ thá»ƒ cháº¡y app trá»±c tiáº¿p trÃªn simulator hoáº·c Ä‘iá»‡n thoáº¡i cá»§a mÃ¬nh Ä‘á»ƒ tráº£i nghiá»‡m, hay build source thÃ nh file apk hoáº·c bundle Ä‘á»ƒ deploy lÃªn store.

![Android Studio run](https://images.viblo.asia/5f36d20d-32bc-4afe-b691-08f49ef2d008.png)

TrÆ°á»ng há»£p cá»§a mÃ¬nh, sau khi cháº¡y app trÃªn Ä‘iá»‡n thoáº¡i, mÃ¬nh nháº­p má»™t item má»›i thÃ¬ má»™t Toast hiá»‡n káº¿t quáº£ nhÆ° code mÃ¬nh Ä‘Ã£ sá»­a:

![Capacitor todo app success](https://images.viblo.asia/d9b198e2-503e-4aca-8366-3b5c420c8653.png)

Váº­y lÃ  mÃ¬nh Ä‘Ã£ cÃ³ má»™t Android app Ä‘Æ°á»£c xÃ¢y dá»±ng tá»« ngÃ´n ngá»¯ web, cá»±c ká»³ dá»… dÃ ng vÃ  nhanh chÃ³ng ğŸ¥³

# Tá»± táº¡o má»™t plugin

TrÆ°á»ng há»£p app cá»§a báº¡n náº±m trong sá»‘ 1% Ä‘en Ä‘á»§i, pháº£i sá»­ dá»¥ng má»™t tÃ­nh nÄƒng "native" nÃ o Ä‘Ã³ mÃ  chÆ°a cÃ³ plugin nÃ o cÃ³ sáºµn, thÃ¬ Capacitor cÅ©ng cÃ³ há»— trá»£ táº­n rÄƒng cÃ¡c bÆ°á»›c Ä‘á»ƒ báº¡n cÃ³ thá»ƒ tá»± tay táº¡o má»™t plugin cho app cá»§a mÃ¬nh. Váº¥n Ä‘á» cÃ²n láº¡i khÃ´ng quÃ¡ khÃ³ khÄƒn, chá»‰ viá»‡c tÃ¬m má»™t khÃ³a há»c nÃ o Ä‘Ã³ Ä‘á»ƒ há»c thÃªm vá» Java/Kotlin hay Swift/Objective-C thÃ´i ğŸ˜‚

á» Ä‘Ã¢y mÃ¬nh thá»­ táº¡o má»™t Capacitor plugin cho Android (láº¡i lÃ  Android, Æ°á»›c Ä‘Æ°á»£c viáº¿t bÃ i hÆ°á»›ng dáº«n vá» iOS... ğŸ˜¢). Giáº£ sá»­ use case lÃ  app todo cá»§a mÃ¬nh muá»‘n truy xuáº¥t Ä‘Æ°á»£c thÃ´ng tin ngÃ´n ngá»¯ cá»§a thiáº¿t bá»‹ mÃ  chÆ°a cÃ³ plugin nÃ o cung cáº¥p, mÃ¬nh sáº½ tá»± táº¡o má»™t plugin `locale` theo cÃ¡c bÆ°á»›c sau:

## 1. Khá»Ÿi táº¡o tá»« template plugin

Äáº§u tiÃªn mÃ¬nh dÃ¹ng bá»™ [generator](https://github.com/ionic-team/create-capacitor-plugin/) mÃ  team Capacitor Ä‘Ã£ phÃ¡t triá»ƒn Ä‘á»ƒ táº¡o má»™t khung sÆ°á»n plugin:

```sh
npm init @capacitor/plugin
```

Nháº­p cÃ¡c thÃ´ng tin cáº§n thiáº¿t cho plugin generator, sau khi hoÃ n táº¥t, cÃ¡c báº¡n sáº½ cÃ³ má»™t project cÃ³ cáº¥u trÃºc thÆ° má»¥c tÆ°Æ¡ng tá»± nhÆ° sau:

![Capacitor plugin structure](https://images.viblo.asia/4a9dc186-b114-422c-bc2b-a55349921dc9.png)

á» Ä‘Ã¢y mÃ¬nh sáº½ chá»‰ quan tÃ¢m 2 thÆ° má»¥c `android` vÃ  `src`:

* `android` - Chá»©a source code cá»§a plugin cho Android (trong `android/src/main/java/com/.../LocalePlugin.java`)
* `src` - Chá»©a source code cá»§a plugin cho web vÃ  má»™t bá»™ definition báº±ng TS Ä‘á»ƒ bridge vá»›i source code phÃ­a Android hoáº·c iOS.

## 2. Code xá»­ lÃ½ phÃ­a Android

Truy cáº­p theo [Ä‘Æ°á»ng dáº«n dÃ i ngoáº±ng Ä‘áº¿n source code cá»§a plugin phÃ­a Android](https://github.com/khang-nd/Todo-list-capacitor/tree/main/plugins/capacitor-plugin-locale/android/src/main/java/com/khangnd/todoapp/plugins/locale), cÃ¡c báº¡n sáº½ tháº¥y 2 file:

* `Locale.java` - chá»©a pháº§n code xá»­ lÃ½ logic cá»§a plugin
* `LocalePlugin.java` - chá»©a pháº§n code Ä‘á»ƒ giao tiáº¿p vá»›i web

Viá»‡c tá»• chá»©c file nhÆ° trÃªn giÃºp cho logic code cá»§a mÃ¬nh Ä‘Æ°á»£c tÃ¡ch ra rÃµ rÃ ng vÃ  dá»… maintain hÆ¡n náº¿u plugin cá»§a mÃ¬nh tÆ°Æ¡ng Ä‘á»‘i bá»±, nhÆ°ng do plugin mÃ¬nh dá»± Ä‘á»‹nh viáº¿t ráº¥t nhá» nÃªn mÃ¬nh sáº½ chá»‰ viáº¿t code trong file `LocalePlugin.java`. Trong file nÃ y Ä‘Ã£ cÃ³ sáºµn má»™t Ä‘oáº¡n code máº«u tuy ngáº¯n nhÆ°ng Ä‘áº§y Ä‘á»§ logic xá»­ lÃ½ cá»§a má»™t plugin API nhÆ° sau:

```java
@CapacitorPlugin(name = "Locale") // <-- tÃªn cá»§a plugin Ä‘á»ƒ bÃªn phÃ­a web nháº­n diá»‡n Ä‘Æ°á»£c khai bÃ¡o báº±ng decorator annotation
public class LocalePlugin extends Plugin {

    private Locale implementation = new Locale(); // <-- pháº§n code xá»­ lÃ½ logic náº¿u cáº§n tÃ¡ch

    @PluginMethod // <-- annotation Ä‘á»ƒ khai bÃ¡o hÃ m echo lÃ  má»™t API cá»§a plugin
    public void echo(PluginCall call) { // <-- PluginCall lÃ  cá»¥c data nháº­n tá»« phÃ­a web
        String value = call.getString("value"); // <-- PluginCall chá»©a cÃ¡c hÃ m Ä‘á»ƒ nháº­n vÃ  chuyá»ƒn Ä‘á»•i kiá»ƒu dá»¯ liá»‡u tÆ°Æ¡ng á»©ng

        JSObject ret = new JSObject(); // <-- táº¡o má»™t cá»¥c data má»›i Ä‘á»ƒ tráº£ vá» phÃ­a web
        ret.put("value", implementation.echo(value));
        call.resolve(ret); // <-- gá»i hÃ m resolve cá»§a PluginCall Ä‘á»ƒ tráº£ cá»¥c data vá» khá»• chá»§
    }
}
```

MÃ¬nh sáº½ sá»­a Ä‘oáº¡n code nÃ y Ä‘á»ƒ lÃ m nhiá»‡m láº¥y thÃ´ng tin locale cá»§a thiáº¿t bá»‹ nhÆ° sau:

```java
@CapacitorPlugin(name = "Locale")
public class LocalePlugin extends Plugin {

    @PluginMethod
    public void getLocale(PluginCall call) {
        Locale locale = Locale.getDefault();
        call.resolve(locale);
    }
}
```

QuÃ ooooo, logic xá»‹n xÃ² thÃ­a...

## 3. Äá»‹nh nghÄ©a interface

á» bÆ°á»›c nÃ y, mÃ¬nh sáº½ Ä‘á»‹nh nghÄ©a hÃ m `getLocale` Ä‘Ã£ code á»Ÿ phÃ­a Android trong [`src/definitions.ts`](https://github.com/khang-nd/Todo-list-capacitor/blob/main/plugins/capacitor-plugin-locale/src/definitions.ts):

```ts
export interface LocalePlugin {
  /**
   * Return the device's locale information.
   */
  getLocale(): Promise<string>;
}
```

Interface nÃ y sáº½ giÃºp báº¡n hoáº·c má»™t ai khÃ¡c sá»­ dá»¥ng plugin nÃ y cÃ³ thá»ƒ dá»… dÃ ng táº­n dá»¥ng type checking hay code completion cá»§a intellisense. Viá»‡c comment code lÃ  optional, nhÆ°ng cháº¯c háº³n cÃ¡c báº¡n cÅ©ng Ä‘Ã£ quÃ¡ rÃµ nhá»¯ng lá»£i Ã­ch tá»« viá»‡c comment code, huá»‘ng chi lÃ  táº§m quan trá»ng cá»§a nÃ³ khi xÃ¢y dá»±ng API. HÆ¡n ná»¯a, cÃ¡c comment táº¡i Ä‘Ã¢y Ä‘Ã³ng vai trÃ² lÃ  documentation comment vÃ  sáº½ Ä‘Æ°á»£c generate ra cÃ¹ng vá»›i file README khi cÃ¡c báº¡n cháº¡y cÃ¢u lá»‡nh `npm run docgen` Ä‘Ã£ Ä‘Æ°á»£c tÃ­ch há»£p sáºµn vá»›i template plugin.

## 4. Code xá»­ lÃ½ phÃ­a Web

á» bÆ°á»›c nÃ y, mÃ¬nh chá»‰ cáº§n táº¡o má»™t hÃ m `getLocale` tÆ°Æ¡ng á»©ng bÃªn phÃ­a web Ä‘á»ƒ káº¿t ná»‘i vá»›i phÃ­a Android lÃ  cÃ³ thá»ƒ báº¯t Ä‘áº§u sá»­ dá»¥ng plugin. Táº¡i file [`src/web.ts`](https://github.com/khang-nd/Todo-list-capacitor/blob/main/plugins/capacitor-plugin-locale/src/web.ts), cÃ¡c báº¡n cÅ©ng cÃ³ thá»ƒ tháº¥y má»™t Ä‘oáº¡n code máº«u Ä‘Ã£ cÃ³ sáºµn tÆ°Æ¡ng tá»± nhÆ° bÃªn Android. MÃ¬nh sá»­a láº¡i Ä‘á»ƒ tráº£ thÃ´ng tin ngÃ´n ngá»¯ cá»§a trÃ¬nh duyá»‡t nhÆ° sau:

```ts
export class LocaleWeb extends WebPlugin implements LocalePlugin {
  async getLocale(): Promise<string> {
      return navigator.language;
  }
}
```

> LÆ°u Ã½ lÃ  náº¿u app cá»§a báº¡n Ä‘ang nháº¯m tá»›i nhiá»u ná»n táº£ng cÃ¹ng lÃºc, cáº£ Web, cáº£ Android hoáº·c iOS, thÃ¬ viá»‡c báº¡n pháº£i viáº¿t code xá»­ lÃ½ cho nhiá»u ná»n táº£ng lÃ  cáº§n thiáº¿t, nhÆ°ng náº¿u app cá»§a báº¡n chá»‰ nháº¯m tá»›i cÃ¡c ná»n táº£ng di Ä‘á»™ng thÃ¬ táº¡i file nÃ y, cÃ¡c báº¡n cÃ³ thá»ƒ implement hÃ m rá»—ng mÃ  khÃ´ng cáº§n viáº¿t code xá»­ lÃ½ bÃªn trong.

Cuá»‘i cÃ¹ng, chá»‰ viá»‡c build source báº±ng cÃ¢u lá»‡nh `npm run build` rá»“i Ä‘áº©y lÃªn npm Ä‘á»ƒ chia sáº» vá»›i cá»™ng Ä‘á»“ng hoáº·c import package vÃ o project cá»§a mÃ¬nh Ä‘á»ƒ sá»­ dá»¥ng thÃ´i. Váº­y lÃ  mÃ¬nh Ä‘Ã£ cÃ³ má»™t Capacitor plugin Ä‘Æ¡n giáº£n.

# Káº¿t

**Capacitor** quáº£ thá»±c lÃ  má»™t vÅ© khÃ­ lá»£i háº¡i cho anh em web dev, sá»± Ä‘Æ¡n giáº£n, tiá»‡n lá»£i vÃ  nhanh chÃ³ng mÃ  nÃ³ mang láº¡i lÃ  cá»±c ká»³ giÃ¡ trá»‹. Náº¿u káº¿t há»£p vá»›i nhá»¯ng bá»™ framework chuyÃªn dá»¥ng Ä‘á»ƒ phÃ¡t triá»ƒn cÃ¡c cross-platform app nhÆ° [Ionic](https://ionicframework.com/) (cÃ¹ng cha Ä‘áº»), [Framework7](https://framework7.io/), [Quasar](https://quasar.dev/)... thÃ¬ trÃ´ng chuyÃªn nghiá»‡p bÃ¡ chÃ¡y con bÃ  báº£y, khÃ´ng khÃ¡c gÃ¬ má»™t "native" app thá»±c thá»¥. Tuy váº­y, rÃµ rÃ ng khÃ´ng cÃ³ cÃ´ng nghá»‡ nÃ o lÃ  "silver bullet" Ä‘á»ƒ giáº£i quyáº¿t má»i váº¥n Ä‘á». Má»—i loáº¡i cÃ´ng nghá»‡ Ä‘á»u cÃ³ nhá»¯ng Æ°u, khuyáº¿t Ä‘iá»ƒm trong nhá»¯ng trÆ°á»ng há»£p nháº¥t Ä‘á»‹nh (vá» yÃªu cáº§u, quy mÃ´, nhÃ¢n lá»±c, timeline, báº£o máº­t, Ã´ng lead, bÃ  PM, vÃ¢n vÃ¢n mÃ¢y mÃ¢y...). NÃªn cáº§n Ä‘áº·t cÃ¢u há»i, trao Ä‘á»•i vÃ  Ä‘Ã¡nh giÃ¡ trÆ°á»›c khi quyáº¿t Ä‘á»‹nh lá»±a chá»n.

Hi vá»ng bÃ i chia sáº» pháº§n nÃ o giÃºp Ã­ch cho cÃ¡c báº¡n, cáº£m Æ¡n cÃ¡c báº¡n Ä‘Ã£ theo dÃµi bÃ i viáº¿t ğŸ™‚

----
@khangnd<br>[![Github](https://images.viblo.asia/20x20/81dd12f0-a8c9-403f-ae51-27b92828ca22.png)](https://github.com/khang-nd) [![Linkedin](https://images.viblo.asia/20x20/4981766e-5e57-401a-8623-d3657a3148e5.png)](https://www.linkedin.com/in/khangnd/) [![Dev.to](https://images.viblo.asia/20x20/3921db2e-e4e5-45d7-acc8-e8b92e02d47d.png)](https://dev.to/khangnd) [![Fandom](https://images.viblo.asia/20x20/fad64df3-0be8-4481-b810-8995f18f71ea.png)](https://dev.fandom.com/wiki/User:KhangND)