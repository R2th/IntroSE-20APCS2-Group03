ÄÃ¢y lÃ  bÃ i 3 thuá»™c seri "Elastic lÃ  gÃ¬? TÃ´i cÃ³ nÃªn Ã¡p dá»¥ng vÃ o dá»± Ã¡n?" báº¡n cÃ³ thá»ƒ tham kháº£o chuá»—i bÃ i viáº¿t táº¡i:

https://viblo.asia/s/elastic-la-gi-toi-co-nen-ap-dung-vao-du-an-QqKLvpm4l7z

### Chá»©c nÄƒng chÃ­nh cá»§a ElasticSearch

ElasticSearch cho phÃ©p báº¡n truy cáº­p cÃ¡c chá»©c nÄƒng Ä‘Ã¡nh chá»‰ má»¥c vÃ  tÃ¬m kiáº¿m dá»¯ liá»‡u cá»§a Lucene. Vá» chá»©c nÄƒng láº­p chá»‰ má»¥c báº¡n cÃ³ nhiá»u tuá»³ chá»n vá» xá»­ lÃ½ vÄƒn báº£n vÃ  cÃ¡ch lÆ°u trá»¯ cÃ¡c vÄƒn báº£n Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½.

Khi tÃ¬m kiáº¿m, báº¡n cÃ³ nhiá»u cÃ¢u truy váº¥n vÃ  bá»™ lá»c Ä‘á»ƒ chá»n. ElasticSearch hiá»ƒn thá»‹ chá»©c nÄƒng nÃ y thÃ´ng qua REST API, cho phÃ©p báº¡n cáº¥u hÃ¬nh cÃ¢u truy váº¥n trong JSON vÃ  Ä‘iá»u chá»‰nh háº§u háº¿t cáº¥u hÃ¬nh, cho dÃ¹ chÃºng cÃ¹ng API.

NgoÃ i nhá»¯ng chá»©c nÄƒng Lucence cung cáº¥p, ElasticSearch cÃ²n bá»• xung chá»©c nÄƒng cáº¥p cao (high level), tá»« bá»™ nhá»› Ä‘á»‡m Ä‘áº¿n phÃ¢n tÃ­ch thá»i gian thá»±c.

á» má»©c Ä‘á»™ trá»«u tÆ°á»£ng khÃ¡c lÃ  cÃ¡ch báº¡n cÃ³ thá»ƒ sáº¯p xáº¿p tÃ i liá»‡u: nhiá»u chá»‰ má»¥c cÃ³ thá»ƒ tÃ¬m kiáº¿m riÃªng hoáº·c cÃ¹ng nhau, vÃ  báº¡n cÃ³ thá»ƒ Ä‘áº·t cÃ¡c loáº¡i tÃ i liá»‡u khÃ¡c nhau trong má»—i chá»‰ má»¥c.

ElasticSearch Ä‘Ãºng nhÆ° tÃªn gá»i cá»§a nÃ³ co giÃ£n (elastic). NÃ³ Ä‘Æ°á»£c phÃ¢n cá»¥m theo máº·c Ä‘á»‹nh - báº¡n cÃ³ thá»ƒ gá»i nÃ³ lÃ  má»™t cá»¥m (cluter) tháº­m chÃ­ khi báº¡n chá»‰ cÃ³ má»™t server duy nháº¥t - vÃ  báº¡n luÃ´n luÃ´n cÃ³ thá»ƒ thÃªm nhiá»u server Ä‘á»ƒ tÄƒng dá»¥ng lÆ°á»£ng hoáº·c kháº£ nÄƒng chá»‹u lá»—i.

### Má»Ÿ rá»™ng chá»©c nÄƒng Lucene

Trong nhiá»u trÆ°á»ng há»£p, ngÆ°á»i dÃ¹ng tÃ¬m kiáº¿m dá»±a trÃªn nhiá»u tiÃªu chÃ­.

VÃ­ dá»¥: ban cÃ³ tiÃªu chÃ­ tÃ¬m kiáº¿m trong nhiá»u field, má»™t vÃ i tiÃªu chÃ­ sáº½ lÃ  báº·c buá»™c vÃ  má»™t sá»‘ sáº½ lÃ  tuá»³ chá»n.

Má»™t trong nhá»¯ng tÃ­nh nÄƒng Ä‘Æ°á»£c Ä‘Ã¡nh giÃ¡ cao cá»§a ElasticSearch lÃ  REST API cÃ³ cáº¥u trÃºc tá»‘t: báº¡n cÃ³ thá»ƒ cáº¥u trÃºc (construct) cÃ¢u truy váº¥n trong JSON Ä‘á»ƒ káº¿t há»£p nhiá»u loáº¡i truy váº¥n khÃ¡c nhau báº±ng nhiá»u cÃ¡ch.

Trong cÃ¹ng má»™t REST API báº¡n cÃ³ thá»ƒ Ä‘á»c vÃ  thay Ä‘á»•i cÃ¡c cÃ i Ä‘áº·t, cÅ©ng nhÆ° lÃ  cÃ¡c tÃ i liá»‡u Ä‘Ã¡nh chá»‰ má»¥c.

**Apeche Solr thÃ¬ nhÆ° tháº¿ nÃ o?**

Náº¿u báº¡n Ä‘Ã£ tá»«ng nghe vá» Lucence, thÃ¬ cÃ³ láº½ báº¡n cÅ©ng nghe vá» Solr, má»™t cÃ´ng cá»¥ tÃ¬m kiáº¿m phÃ¢n tÃ¡n vÃ  mÃ£ nguá»“n má»Ÿ dá»±a trÃªn Lucence. 

TrÃªn thá»±c táº¿, Lucence vÃ  Solr Ä‘Ã£ há»£p nháº¥t thÃ nh má»™t dá»± Ã¡n Apache duy nháº¥t vÃ o nÄƒm 2010, vÃ¬ váº­y báº¡n cÃ³ thá»ƒ tá»± há»i lÃ m tháº¿ nÃ o Ä‘á»ƒ so sÃ¡nh ElasticSearch vá»›i Solr.

Cáº£ hai cÃ´ng cá»¥ tÃ¬m kiáº¿m nÃ y Ä‘iá»u cung cáº¥p chá»©c nÄƒng giá»‘ng nhau, vÃ  cÃ¡c tÃ­nh nÄƒng Ä‘Æ°á»£c phÃ¡t triá»ƒn nhanh chÃ³ng trong má»—i phiÃªn báº£n má»›i. 

Báº¡n cÃ³ thá»ƒ tÃ¬m kiáº¿m nhá»¯ng trang web so sÃ¡nh, nhÆ°ng tÃ´i khuyÃªn lÃ  báº¡n nÃªn cáº©n trá»ng vá»›i nhá»¯ng tin tá»©c Ä‘Ã³. BÃªn cáº¡nh viá»‡c bá»‹ rÃ ng buá»™c bá»Ÿi cÃ¡c phiÃªn báº£n, khiáº¿n cho nhá»¯ng so sÃ¡nh trá»Ÿ nÃªn lá»—i thá»i trong vÃ i thÃ¡ng, vÃ  nhiá»u lÃ­ do khÃ¡c khiáº¿n chÃºng sai lá»‡ch.

Äiá»u Ä‘Ã³ nÃ³i ráº±ng, má»™t vÃ i sá»± tháº­t lá»‹ch sá»­ giÃºp giáº£i thÃ­ch nguá»“n gá»‘c cá»§a 2 sáº£n pháº©m. Solr Ä‘Æ°á»£c táº¡o ra nÄƒm 2004 vÃ  ElasticSearch nÄƒm 2010. 

Khi ElasticSearch xuáº¥t hiá»‡n, mÃ´ hÃ¬nh phÃ¢n tÃ¡n cá»§a nÃ³ (Ä‘Æ°á»£c tháº£o luáº­n trong pháº§n dÆ°á»›i) sáº½ giÃºp cho viá»‡c má»Ÿ rá»™ng (scale out) dá»… dÃ ng hÆ¡n cÃ¡c Ä‘á»‘i thá»§ cáº¡nh tranh, Ä‘iá»u nÃ y Ä‘Æ°á»£c thá»ƒ hiá»‡n trong tÃªn cá»§a chÃºng elastic (Ä‘Ã n há»“i). Tuy nhiÃªn trong thá»i gian Ä‘Ã³, Solr cÅ©ng Ä‘Ã£ thÃªm sharding(phÃ¢n Ä‘oáº¡n) vÃ o phiÃªn báº£n 4.0, Ä‘iá»u nÃ y khiáº¿n cho Solr cáº¡nh tranh vá»›i ElasticSearch vá» mÃ´ hÃ¬nh phÃ¢n tÃ¡n vÃ  cÅ©ng nhÆ° nhá»¯ng khÃ­a cáº¡nh khÃ¡c.

Khi nÃ³i Ä‘áº¿n cÃ¡ch tÃ i liá»‡u Ä‘Æ°á»£c láº­p chá»‰ má»¥c, má»™t khÃ­a cáº¡nh quan trá»ng lÃ  phÃ¢n tÃ­ch. ThÃ´ng qua phÃ¢n tÃ­ch, nhá»¯ng tá»« trong vÄƒn báº£n mÃ  báº¡n láº­p chá»‰ má»¥c trá»Ÿ thÃ nh thuáº­t ngá»¯(term) trong ElasticSearch.

VÃ­ dá»¥: Náº¿u báº¡n láº­p chá»‰ má»¥c "bicycle race", phÃ¢n tÃ­ch cÃ³ thá»ƒ cung cáº¥p thuáº­t ngá»¯ "bicycle", "race", "cycling" vÃ  "racing", khi báº¡n tÃ¬m kiáº¿m má»™t trong nhá»¯ng thuáº­t ngá»¯ nÃ y, nhá»¯ng tÃ i liá»‡u(document) tÆ°Æ¡ng á»©ng sáº½ thÃªm vÃ o káº¿t quáº£. 

QuÃ¡ trÃ¬nh xá»­ lÃ­ phÃ¢n tÃ­ch cÅ©ng Ã¡p dá»¥ng tÆ°Æ¡ng tá»± khi báº¡n tÃ¬m kiáº¿m, (Ä‘Æ°á»£c mÃ´ táº£ nhÆ° hÃ¬nh bÃªn dÆ°á»›i). Náº¿u báº¡n tÃ¬m kiáº¿m "bicycle race" báº¡n sáº½ khÃ´ng muá»‘n tÃ¬m kiáº¿m chÃ­nh xÃ¡c. CÃ³ láº½ báº¡n cáº§n má»™t tÃ i liá»‡u chá»©a 2 tá»« riÃªng láº½.

TrÆ°á»›c tiÃªn bá»™ phÃ¢n tÃ­ch máº·c Ä‘á»‹nh chia vÄƒn báº£n thÃ nh cÃ¡c tá»« riÃªng láº½ Ä‘Æ°á»£c phÃ¢n cÃ¡ch báº±ng dáº§u pháº¥y hoáº·c space(khoáº£ng trá»‘ng).  Sau Ä‘Ã³ chuyá»ƒn thÃ nh chá»¯ thÆ°á»ng, "Bicycle Race" sáº½ thÃ nh "bicycle" vÃ  "race". CÃ³ nhiá»u bá»™ phÃ¢n tÃ­ch khÃ¡c nhau, vÃ  báº¡n cÃ³ thá»ƒ tá»± xÃ¢y dá»±ng riÃªng cho mÃ¬nh.

Táº¡i thá»i Ä‘iá»ƒm nÃ y, báº¡n cÃ³ thá»ƒ muá»‘n biáº¿t hÆ¡n vá» "chá»‰ má»¥c dá»¯ liá»‡u" Ä‘Æ°á»£c mÃ´ táº£ nhÆ° hÃ¬nh dÆ°á»›i.

![alt text](https://s3-ap-southeast-1.amazonaws.com/kipalog.com/ufzredtag2_image.png)


Dá»¯ liá»‡u Ä‘Æ°á»£c sáº¯p xáº¿p trong tÃ i liá»‡u. Theo máº·c Ä‘á»‹nh ElasticSearch lÆ°u trá»¯ dá»¯ liá»‡u hiá»‡n táº¡i cá»§a báº¡n, vÃ  nÃ³ cÅ©ng lÆ°u cÃ¡c thuáº­t ngá»¯ Ä‘Ã£ Ä‘Æ°á»£c phÃ¢n tÃ­ch vÃ o chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c(reverted index) Ä‘á»ƒ cho phÃ©p tÃ¬m kiáº¿m dá»¯ liá»‡u nhanh vÃ  cÃ³ liÃªn quan.

VÃ  bÃ¢y giá» chÃºng ta sáº½ tÃ¬m hiá»ƒu táº¡i sao Elasticsearch lÆ°u trá»¯ dá»¯ liá»‡u theo hÆ°á»›ng tÃ i liá»‡u vÃ  lÃ m cÃ¡ch nÃ o Ä‘á»ƒ nhÃ³m cÃ¡c tÃ i liá»‡u theo loáº¡i vÃ  chá»‰ má»¥c.

### Cáº¥u trÃºc dá»¯ liá»‡u trong ElasticSearch

KhÃ´ng giá»‘ng  nhÆ° cÆ¡ sá»Ÿ dá»¯ liá»‡u quan há»‡, lÆ°u trá»¯ dá»¯ liá»‡u vÃ o hÃ ng, ElasticSearch lÆ°u trá»¯ dá»¯ liá»‡u trong tÃ i liá»‡u. 

Tuy nhiÃªn, á»Ÿ má»™t má»©c Ä‘á»™ nÃ o Ä‘Ã³, 2 khÃ¡i niá»‡m nÃ y giá»‘ng nhau. Vá»›i cÃ¡c hÃ ng trong má»™t báº£ng, báº¡n cÃ³ cÃ¡c cá»™t, vá»›i má»—i cá»™t, má»—i hÃ ng thÃ¬ cÃ³ 1 giÃ¡ trá»‹. Vá»›i tÃ i liá»‡u thÃ¬ cÃ³ key vÃ  value, cÅ©ng tÆ°Æ¡ng tá»± nhÆ° váº­y.

Sá»± khÃ¡c biá»‡t lÃ  má»™t tÃ i liá»‡u thÃ¬ linh hoáº¡t hÆ¡n má»™t hÃ ng, lÃ­ do chÃ­nh lÃ  trong ElasticSearch tÃ i liá»‡u Ä‘Æ°á»£c phÃ¢n nhiá»u cáº¥p. 

VÃ­ dá»¥: Giá»‘ng nhÆ° cÃ¡ch báº¡n liÃªn káº¿t khoÃ¡ vá»›i giÃ¡ trá»‹ chuá»—i "author" : "Joe". Má»™t tÃ i liá»‡u cÃ³ thá»ƒ lÆ°u máº£ng chuá»—i "tag" : ["cycling", "bicycles"], hoáº·c tháº­m chÃ­ lÃ  cáº·p giÃ¡ trá»‹ "author" : {"first_name": "Joe", "last_name": "Smith"}.

TÃ­nh linh hoáº¡t nÃ y ráº¥t quan trá»ng bá»Ÿi vÃ¬ nÃ³ khuyáº¿n khÃ­ch báº¡n lÆ°u trá»¯ nhá»¯ng thá»±c tháº¿ cÃ³ cÃ¹ng logic trong má»™t tÃ i liá»‡u, trÃ¡i ngÆ°á»£c vá»›i viá»‡c lÆ°u trá»¯ á»Ÿ cÃ¡c hÃ ng vÃ  cÃ¡c báº£ng khÃ¡c nhau.

VÃ­ dá»¥: cÃ¡ch dá»… nháº¥t (vÃ  cÃ³ thá»ƒ lÃ  nhanh nháº¥t) lÃ  lÆ°u trá»¯ táº¥t cáº£ dá»¯ liá»‡u má»™t bÃ i viáº¿t trong cÃ¹ng má»™t tÃ i liá»‡u. Báº±ng cÃ¡ch nÃ y, viá»‡c tÃ¬m kiáº¿m sáº½ nhanh bá»Ÿi vÃ¬ báº¡n khÃ´ng cáº§n pháº£i liÃªn káº¿t vá»›i cÃ¡c báº£ng khÃ¡c.

Náº¿u báº¡n cÃ³ ná»n táº£ng vá» SQL, báº¡n pháº£i bá» qua cÃ¡c chá»©c nÄƒng join, Ã­t nháº¥t lÃ  trong phiÃªn báº£n 1.76. Khi táº¥t cáº£ má»i thá»© Ä‘Ã£ sáºµn sÃ ng, báº¡n cÃ³ thá»ƒ táº£i cÃ i Ä‘áº·t ElasticSearch vÃ  báº¯t Ä‘áº§u.

### CÃ i Ä‘áº·t Java

Náº¿u báº¡n khÃ´ng cÃ³ sáºµn JRE (Java Runtime Environment), báº¡n sáº½ pháº£i cÃ i Ä‘áº·t nÃ³ trÆ°á»›c. Báº¥t ká»³ JRE nÃ o cÅ©ng hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c, miá»…n lÃ  phiÃªn báº£n 1.7 trá»Ÿ lÃªn.

ThÃ´ng thÆ°á»ng báº¡n cÃ i Ä‘áº·t tá»« Oracle (www.java.com/en/download/index.jsp).

**Kháº¯c phá»¥c sá»± cá»‘ "KhÃ´ng tÃ¬m tháº¥y Java"**

Vá»›i ElasticSearch, cÅ©ng nhÆ° nhá»¯ng á»©ng dá»¥ng Java khÃ¡c, Ä‘iá»u nÃ y cÃ³ thá»ƒ xáº£y ra khi báº¡n táº£i vÃ  cÃ i Ä‘áº·t Java, nhÆ°ng á»©ng dá»¥ng khÃ´ng thá»ƒ khá»Ÿi Ä‘á»™ng Ä‘Æ°á»£c vÃ  thÃ´ng bÃ¡o ráº±ng "khÃ´ng tÃ¬m tháº¥y Java".

Äoáº¡n mÃ£ cá»§a ElasticSearch tÃ¬m kiáº¿m Java á»Ÿ 2 nÆ¡i: biáº¿n mÃ´i trÆ°á»ng JAVA_HOME vÃ  biáº¿n há»‡ thá»‘ng.

Äá»ƒ kiá»ƒm tra xem biáº¿n JAVA_HOME Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p hay chÆ°a báº¡n sá»­ dá»¥ng lá»‡nh `env` trong há»‡ thá»‘ng UNIX vÃ  lá»‡nh `set` trong Windows. Äá»ƒ kiá»ƒm tra phiÃªn báº£n cá»§a Java báº¡n sá»­ dá»¥ng lá»‡nh `java -version`.

Náº¿u nÃ³ hoáº¡t Ä‘á»™ng, thÃ¬ Java Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p trong Ä‘Æ°á»ng dáº«n (PATH). Náº¿u khÃ´ng hoáº¡t Ä‘á»™ng, thÃ¬ báº¡n pháº£i thÃªm JAVA_HOME vÃ o biáº¿n mÃ´i trÆ°á»ng, hoáº·c comment bÃªn dÆ°á»›i, mÃ¬nh sáº½ há»— trá»£ báº¡n.

### Táº£i xuá»‘ng vÃ  khá»Ÿi Ä‘á»™ng ElasticSearch

Vá»›i Java Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t, báº¡n cáº§n táº£i ElasticSearch vÃ  khá»Ÿi Ä‘á»™ng nÃ³.

Táº£i vá» gÃ³i phÃ¹ há»£p vá»›i mÃ´i trÆ°á»ng cá»§a báº¡n nháº¥t. Nhá»¯ng gÃ³i nÃ¡y cÃ³ thá»ƒ Ä‘Æ°á»£c táº£i tá»« www.elastic.co/downloads/elasticsearch: Tar, ZIP, RPM, and DEB.

**Cho há»‡ Ä‘iá»u hÃ nh UNIX**

Náº¿u báº¡n cháº¡y trÃªn Linux, Mac hoáº·c UNIX há»‡ Ä‘iá»u hÃ nh UNIX, báº¡n cÃ³ thá»ƒ táº£i gÃ³i tar.gz. Sau Ä‘Ã³ báº¡n giáº£i nÃ©n vÃ  khá»Ÿi cháº¡y ElasticSearch báº±ng lá»‡nh sau:

`tar zxf elasticsearch-*.tar.gz`

`cd elasticsearch-*`

`bin/elasticsearch`

**Quáº£n lÃ½ gÃ³i báº±ng HOMEBREW cho OS X**

Náº¿u báº¡n cáº§n má»™t cÃ¡ch cÃ i Ä‘áº·t Ä‘Æ¡n giáº£n hÆ¡n cho mÃ¡y Mac, báº¡n cÃ³ thá»ƒ cÃ i Ä‘áº·t Homebrew. HÆ°á»›ng dáº«n cÃ i Ä‘áº·t cÃ³ thá»ƒ tÃ¬m tháº¥y táº¡i http://brew.sh.

Vá»›i Homebrew, báº¡n cÃ³ thá»ƒ cÃ i Ä‘áº·t ElasticSearch báº±ng cÃ¢u lá»‡nh sau:

`brew install elasticsearch`

Sau Ä‘Ã³ khá»Ÿi Ä‘á»™ng ElasticSearch báº±ng cÃ¡ch:

`elasticsearch`

**GÃ³i ZIP**

Náº¿u cháº¡y trÃªn há»‡ Ä‘iá»u hÃ nh Windows, báº¡n nÃªn táº£i gÃ³i ZIP vá», giáº£n nÃ©n nÃ³ vÃ  sao Ä‘Ã³ cháº¡y file `elasticsearch.bat` trong thÆ° má»¥c `bin`.

**GÃ³i RPM hoáº·c DEB**

Náº¿u cháº¡y trÃªn Red Hat Linux, CentOS, SUSE, hoáº·c báº¥t ká»³ há»‡ Ä‘iá»u hÃ nh nÃ o lÃ m viá»‡c vá»›i RPMs, hoáº·c Debian, Ubuntu, hoáº·c báº¥t ká»³ há»‡ thá»‘ng nÃ o lÃ m viá»‡c vá»›i DEBs, thÃ¬ báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng RPM vÃ  DEB Ä‘Æ°á»£c cung cáº¥p bá»Ÿi Elastic.

Báº¡n cÃ³ xem cÃ¡ch cÃ i Ä‘áº·t táº¡i  www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html.

Má»™t khi báº¡n Ä‘Ã£ cÃ i Ä‘áº·t ElasticSearch, báº¡n cáº§n pháº£i thÃªm repository vÃ o danh sÃ¡ch vÃ  cháº¡y ElasticSearch báº±ng cÃ¢u lá»‡nh sau:

`systemctl start elasticsearch.service`

Náº¿u há»‡ thá»‘ng báº¡n khÃ´ng cÃ³ `systemctl` thÃ¬ cÃ³ thá»ƒ cháº¡y lá»‡nh sau:

`% /etc/init.d/elasticsearch start`

Náº¿u báº¡n muá»‘n nhÃ¬n tháº¥y ElasticSearch Ä‘ang lÃ m gÃ¬, thÃ¬ hÃ£y quan sÃ¡t log táº¡i thÆ° má»¥c `/var/log/elastic- search/`. Náº¿u báº¡n cÃ i Ä‘áº·t báº±ng TAR hoáº·c ZIP, báº¡n cÃ³ thá»ƒ tÃ¬m tháº¥y chÃºng táº¡i thÆ° má»¥c `logs/`.

### Kiá»ƒm tra hoáº¡t Ä‘á»™ng cá»§a ElasticSearch

BÃ¢y giá» ElasticSearch Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t vÃ  khá»Ÿi cháº¡y. ChÃºng ta sáº½ kiá»ƒm tra log Ä‘Æ°á»£c táº¡o ra trong suá»‘t quÃ¡ trÃ¬nh khá»Ÿi Ä‘á»™ng vÃ  káº¿t ná»‘i REST API.

**Kiá»ƒm tra file log**

Khi láº§n Ä‘Ã¢u tiÃªn báº¡n cháº¡y ElasticSearch, sáº½ tháº¥y hÃ ng loáº¡t log hiá»‡n ra, cho biáº¿t nhá»¯ng gÃ¬ Ä‘ang xáº£y ra. ChÃºng ta sáº½ xem xÃ©t nhá»¯ng dÃ²ng nÃ y cÃ³ Ã½ nghÄ©a lÃ  gÃ¬.

Nhá»¯ng dÃ²ng Ä‘áº§u cung cáº¥p thÃ´ng tin vá» node: TÃªn máº·c Ä‘á»‹nh cá»§a node lÃ  `kJhkPLX`, báº¡n cÃ³ thá»ƒ cáº¥u hÃ¬nh láº¡i theo tÃªn báº¡n muá»‘n. 

NgoÃ i ra cÃ²n cÃ³ cÃ¡c thÃ´ng tin vá»:  dung lÆ°á»£ng cÃ³ thá»ƒ sá»­ dá»¥ng, dung lÆ°á»£ng hiá»‡n cÃ³, kÃ­ch thÆ°á»›c cá»§a heap, id cá»§a node, PID, phiÃªn báº£n, há»‡ Ä‘iá»u hÃ nh, vÃ  biáº¿n mÃ´i trÆ°á»ng.

`
[2020-01-17T15:49:46,058][INFO ][o.e.e.NodeEnvironment    ] [kJhkPLX] using [1] data paths, mounts [[/ (/dev/disk1s1)]], net usable_space [24.7gb], net total_space [233.5gb], types [apfs]
[2020-01-17T15:49:46,061][INFO ][o.e.e.NodeEnvironment    ] [kJhkPLX] heap size [989.8mb], compressed ordinary object pointers [true]
[2020-01-17T15:49:46,063][INFO ][o.e.n.Node               ] [kJhkPLX] node name derived from node ID [kJhkPLXXQBq8pnV3lhX28w]; set [node.name] to override
[2020-01-17T15:49:46,063][INFO ][o.e.n.Node               ] [kJhkPLX] version[6.8.5], pid[83413], build[oss/tar/78990e9/2019-11-13T20:04:24.100411Z], OS[Mac OS X/10.14.5/x86_64], JVM[Oracle Corporation/Java HotSpot(TM) 64-Bit Server VM/1.8.0_202/25.202-b08]
[2020-01-17T15:49:46,064][INFO ][o.e.n.Node               ] [kJhkPLX] JVM arguments [-Xms1g, -Xmx1g, -XX:+UseConcMarkSweepGC, -XX:CMSInitiatingOccupancyFraction=75, -XX:+UseCMSInitiatingOccupancyOnly, -Des.networkaddress.cache.ttl=60, -Des.networkaddress.cache.negative.ttl=10, -XX:+AlwaysPreTouch, -Xss1m, -Djava.awt.headless=true, -Dfile.encoding=UTF-8, -Djna.nosys=true, -XX:-OmitStackTraceInFastThrow, -Dio.netty.noUnsafe=true, -Dio.netty.noKeySetOptimization=true, -Dio.netty.recycler.maxCapacityPerThread=0, -Dlog4j.shutdownHookEnabled=false, -Dlog4j2.disable.jmx=true, -Djava.io.tmpdir=/var/folders/c8/8nmz64pn7fs0x8yp50xldv300000gn/T/elasticsearch-7046467428247345908, -XX:+HeapDumpOnOutOfMemoryError, -XX:HeapDumpPath=data, -XX:ErrorFile=logs/hs_err_pid%p.log, -XX:+PrintGCDetails, -XX:+PrintGCDateStamps, -XX:+PrintTenuringDistribution, -XX:+PrintGCApplicationStoppedTime, -Xloggc:logs/gc.log, -XX:+UseGCLogFileRotation, -XX:NumberOfGCLogFiles=32, -XX:GCLogFileSize=64m, -Des.path.home=/usr/local/Cellar/elasticsearch/6.8.5/libexec, -Des.path.conf=/usr/local/etc/elasticsearch, -Des.distribution.flavor=oss, -Des.distribution.type=tar]`

CÃ¡c Plugin Ä‘Æ°á»£c táº£i lÃªn khi khá»Ÿi cháº¡y:

`[2020-01-17T15:49:46,968][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [aggs-matrix-stats]
[2020-01-17T15:49:46,968][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [analysis-common]
[2020-01-17T15:49:46,968][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [ingest-common]
[2020-01-17T15:49:46,968][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [ingest-geoip]
[2020-01-17T15:49:46,968][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [ingest-user-agent]
[2020-01-17T15:49:46,969][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [lang-expression]
[2020-01-17T15:49:46,969][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [lang-mustache]
[2020-01-17T15:49:46,969][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [lang-painless]
[2020-01-17T15:49:46,969][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [mapper-extras]
[2020-01-17T15:49:46,969][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [parent-join]
[2020-01-17T15:49:46,969][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [percolator]
[2020-01-17T15:49:46,969][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [rank-eval]
[2020-01-17T15:49:46,970][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [reindex]
[2020-01-17T15:49:46,970][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [repository-url]
[2020-01-17T15:49:46,970][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [transport-netty4]
[2020-01-17T15:49:46,970][INFO ][o.e.p.PluginsService     ] [kJhkPLX] loaded module [tribe]`

Cá»•ng 9300 Ä‘Æ°á»£c sá»­ dá»¥ng máº·c Ä‘á»‹nh. Náº¿u báº¡n sá»­ dá»¥ng Java API thay vÃ¬ REST API thÃ¬ Ä‘Ã¢y lÃ  nÆ¡i báº¡n cáº§n káº¿t ná»‘i.

`[2020-01-17T15:49:50,473][INFO ][o.e.t.TransportService   ] [kJhkPLX] publish_address {127.0.0.1:9300}, bound_addresses {[::1]:9300}, {127.0.0.1:9300}`

DÃ²ng tiáº¿p theo: Master node Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p vÃ  tÃªn cá»§a nÃ³ lÃ  `kJhkPLX`. Má»—i cá»¥m sáº½ cÃ³ má»™t master node, chá»‹u trÃ¡ch nhiá»‡m cho biáº¿t nÃºt nÃ o trong cá»¥m vÃ  nÆ¡i Ä‘áº·t táº¥t cáº£ phÃ¢n Ä‘oáº¡n (shards). Khi master node khÃ´ng cÃ³ sáºµn thÃ¬ nÃºt má»›i sáº½ Ä‘Æ°á»£c chá»n. Trong trÆ°á»ng há»£p báº¡n khá»Ÿi táº¡o nÃºt Ä‘áº§u tiÃªn thÃ¬ nÃºt Ä‘Ã³ lÃ  master node cá»§a báº¡n.

`[2020-01-17T15:49:53,578][INFO ][o.e.c.s.MasterService    ] [kJhkPLX] zen-disco-elected-as-master ([0] nodes joined), reason: new_master {kJhkPLX}{kJhkPLXXQBq8pnV3lhX28w}{auKqCeD6Q5OKnODTFkpgKw}{127.0.0.1}{127.0.0.1:9300}`

Cá»•ng 9200 Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ giao tiáº¿p vá»›i HTTP. ÄÃ¢y lÃ  nÆ¡i báº¡n káº¿t ná»‘i vá»›i REST API

`[2020-01-17T15:49:53,627][INFO ][o.e.h.n.Netty4HttpServerTransport] [kJhkPLX] publish_address {127.0.0.1:9200}, bound_addresses {[::1]:9200}, {127.0.0.1:9200}`

DÃ²ng tiáº¿p theo thÃ´ng bÃ¡o ráº±ng node cá»§a báº¡n Ä‘Ã£ cháº¡y. VÃ o thá»i Ä‘iá»ƒm nÃ y báº¡n cÃ³ thá»ƒ káº¿t ná»‘i vÃ  gá»­i cÃ¡c yÃªu cáº§u.

`[2020-01-17T15:49:53,627][INFO ][o.e.n.Node               ] [kJhkPLX] started`

GatewayService lÃ  thÃ nh pháº§n cá»§a ElasticSearch chá»‹u chá»©c nÄƒng duy trÃ¬ dá»¯ liá»‡u á»• Ä‘Ä©a, Ä‘á»ƒ báº¡n khÃ´ng bá»‹ máº¥t dá»¯ liá»‡u náº¿u node bá»‹ hÆ°:

`[2020-01-17T15:49:53,633][INFO ][o.e.g.GatewayService     ] [kJhkPLX] recovered [0] indices into cluster_state`

Khi báº¡n khá»Ÿi táº¡o node, Gateway tÃ¬m trÃªn á»• Ä‘Ä©a xem náº¿u cÃ³ dá»¯ liá»‡u nÃ o Ä‘Æ°á»£c lÆ°u Ä‘á»ƒ Gateway cÃ³ thá»ƒ khÃ´i phá»¥c. Trong trÆ°á»ng há»£p nÃ y, khÃ´ng cÃ³ chá»‰ má»¥c nÃ o Ä‘Æ°á»£c khÃ´i phá»¥c.

Pháº§n lá»›n thÃ´ng tin chÃºng ta xem xÃ©t trong log - tá»« tÃªn node cho Ä‘áº¿n cÃ i Ä‘áº·t gateway - Ä‘iá»u cÃ³ thá»ƒ cáº¥u hÃ¬nh Ä‘Æ°á»£c. ChÃºng ta sáº½ xem xÃ©t cÃ¡ch cáº¥u hÃ¬nh,vÃ  Ã½ nghÄ©a trong má»™t bÃ i khÃ¡c. BÃ¢y giá» báº¡n khÃ´ng cáº§n pháº£i chá»‰nh sá»­a gÃ¬ thÃªm bá»Ÿi vÃ¬ cÃ¡c giÃ¡ trá»‹ máº·c Ä‘á»‹nh lÃ  cáº¥u hÃ¬nh chuáº©n cho cÃ¡c nhÃ  phÃ¡t triá»ƒn.

**ChÃº Ã½:** Náº¿u báº¡n muá»‘n khá»Ÿi táº¡o ElasticSearch trÃªn má»™t mÃ¡y tÃ­nh khÃ¡c nhÆ°ng cÃ¹ng máº¡ng, thÃ¬ nÃ³ káº¿t ná»‘i cÃ¹ng 1 cá»¥m (cluster), Ä‘iá»u nÃ y dáº«n Ä‘áº¿n nhá»¯ng káº¿t quáº£ khÃ´ng mong Ä‘á»£i, nhÆ° lÃ  nhá»¯ng máº£nh (shards) sáº½ káº¿t ná»‘i vá»›i nhau. Äá»ƒ ngÄƒn cháº·n Ä‘iá»u nÃ y báº¡n nÃªn thay Ä‘á»•i tÃªn cá»§a cá»¥m (cluster) trong file cáº¥u hÃ¬nh `elasticsearch.yml`.

### Sá»­ dá»¥ng REST API

CÃ¡ch káº¿t ná»‘i vá»›i REST API Ä‘Æ¡n giáº£n nháº¥t lÃ  trá» trÃ¬nh duyá»‡t Ä‘áº¿n Ä‘á»‹a chá»‰ http://localhost:9200/.

Náº¿u báº¡n khÃ´ng cÃ i Ä‘áº·t ElasticSearch trÃªn mÃ¡y local, báº¡n cÃ³ thá»ƒ thay Ä‘á»•i `localhost` báº±ng Ä‘á»‹a chá»‰ cá»§a mÃ¡y káº¿t ná»‘i. 

Theo máº·c Ä‘á»‹nh ElasticSearch láº¯ng nghe cÃ¡c yÃªu cáº§u cá»§a HTTP tá»« cá»•ng 9200.

Náº¿u yÃªu cáº§u cá»§a báº¡n Ä‘Æ°á»£c tiáº¿p nháº­n thÃ¬ chuá»—i JSON sáº½ Ä‘Æ°á»£c tráº£ vá» nhÆ° sau:

![alt text](https://s3-ap-southeast-1.amazonaws.com/kipalog.com/m0gbth1rpw_image.png)

### Tá»•ng káº¿t

1. ElasticSearch lÃ  mÃ£ nguá»“n má»Ÿ,  bá»™ mÃ¡y tÃ¬m kiáº¿m phÃ¢n tÃ¡n Ä‘Æ°á»£c xÃ¢y dá»±ng trÃªn Apache Lucene.
2. TrÆ°á»ng há»£p sá»­ dá»¥ng cho ElasticSearch lÃ  Ä‘Ã¡nh chá»‰ má»¥c vá»›i sá»‘ lÆ°á»£ng dá»¯ liá»‡u cá»±c lá»›n, Ä‘á»ƒ báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng chá»©c nÄƒng tÃ¬m kiáº¿m full-text vÃ  thá»‘ng kÃª trong thá»i gian thá»±c.
3. NgoÃ i tÃ­nh nÄƒng tÃ¬m kiáº¿m full-text, báº¡n cÃ³ thá»ƒ Ä‘iá»u chá»‰nh tÃ¬m kiáº¿m liÃªn quan Ä‘á»ƒ Ä‘Æ°a ra Ä‘á» xuáº¥t tÃ¬m kiáº¿m.
4. Äá»ƒ báº¯t Ä‘áº§u, báº¡n táº£i gÃ³i tÆ°Æ¡ng á»©ng vá», giáº£i nÃ©n ra, vÃ  cháº¡y ElasticSearch.
5. Äá»ƒ chá»‰ má»¥c vÃ  tÃ¬m kiáº¿m dá»¯ liá»‡u, cÅ©ng nhÆ° lÃ  cÃ i Ä‘áº·t cá»¥m (cluster), sá»­ dá»¥ng JSON thÃ´ng qua HTTP API Ä‘á»ƒ láº¥y dá»¯ liá»‡u tráº£ vá» báº±ng JSON.
6. Báº¡n cÃ³ thá»ƒ xem ElasticSearch nhÆ° lÃ  NoSQL vá»›i chá»©c nÄƒng tÃ¬m kiáº¿m trong thá»i gian thá»±c vÃ  kháº£ nÄƒng phÃ¢n tÃ­ch. ElasticSearch theo hÆ°á»›ng tÃ i liá»‡u vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c má»Ÿ rá»™ng theo máº·c Ä‘á»‹nh.
7. ElasticSearch tá»± Ä‘á»™ng chia dá»¯ liá»‡u ra cÃ¡c máº£nh (shards), giÃºp cÃ¢n báº±ng nhá»¯ng server trong cá»¥m (cluster). Äiá»u nÃ y giÃºp dá»… dÃ ng thÃªm vÃ  xoÃ¡ server. Máº£nh(shards) cÃ³ thá»ƒ nhÃ¢n báº£n Ä‘á»ƒ giÃºp báº¡n giáº£i quyáº¿t váº¥n Ä‘á» server bá»‹ lá»—i.

### Tham kháº£o
Elasticsearch In Action (Matthew Lee Hinman and Radu Gheorghe)

### GÃ³p Ã½
CÃ¡c báº¡n bá» ra 1 phÃºt giÃºp mÃ¬nh nhÃ©. Vui lÃ²ng Ä‘á»ƒ láº¡i Ã½ kiáº¿n cá»§a báº¡n Ä‘á»ƒ giÃºp ngÆ°á»i sau dá»… Ä‘á»c vÃ  dá»… hiá»ƒu hÆ¡n.

Cáº£m Æ¡n cÃ¡c báº¡n Ä‘Ã£ quan tÃ¢m bÃ i viáº¿t nÃ y. ChÃºc cÃ¡c báº¡n 1 ngÃ y tá»‘t lÃ nh! ğŸ˜ƒ

PhÃºc VÆ°u.