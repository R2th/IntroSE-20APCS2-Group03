# DNS là gì? cách thức hoạt động của DNS (Domain Name System)
Hệ thống tên miền DNS (Domain Name System) là danh bạ của Internet. Con người truy cập thông tin trực tuyến thông qua các tên miền, như nytimes.com hoặc espn.com. Các trình duyệt web tương tác thông qua địa chỉ Giao thức Internet (IP). DNS dịch tên miền thành địa chỉ IP để trình duyệt có thể tải tài nguyên Internet. Khi bạn vào một trình duyêt web và gõ tên trang web ví dụ như https://85network-share.blogspot.com thì máy tính của bạn sẽ bắt đầu phân giải thành các dãy số 32-bit vì thật chất máy tính không thể hiểu ngôn ngữ con người đâu các bạn, nên nó sẽ chuyển đổi thành hệ số nhị phân, các bit 0 và 1 tức là dãy địa chỉ IP cho các bạn. Vậy địa chỉ IP là gì? và cách hoạt động của máy chủ phân giải tên miền như thế nào cùng đọc tiếp nhé.
![](https://images.viblo.asia/3b1fd727-c9e9-46f3-9088-25175e9b6f47.jpg)

## 1. Địa chỉ IP là gì? tại sao lại cần một địa chỉ IP.
Địa chỉ IP là một địa chỉ đơn nhất mà những thiết bị điện tử hiện nay đang sử dụng để nhận diện và liên lạc với nhau trên mạng máy tính bằng cách sử dụng giao thức Internet. Địa chỉ IP cung cấp nhận dạng cho một thiết bị mạng, tương tự như địa chỉ nhà riêng hoặc doanh nghiệp. Các thiết bị trên mạng có các địa chỉ IP khác nhau.   
**Địa chỉ IPv4**: Địa chỉ IP gồm 32 bit nhị phân, chia thành 4 cụm 8 bit (gọi là các octet). Các octet được biểu diễn dưới dạng thập phân và được ngăn cách nhau bằng các dấu chấm,  được chia thành hai phần: phần mạng (network) và phần host. tìm hiểu thêm tại đây!
![](https://images.viblo.asia/88a13e0e-5cb5-4119-8017-30ba2862b2bd.jpg)

**Địa chỉ IPv6**: Địa chỉ IPv6 dài 128 bit, được chia làm 8 nhóm, mỗi nhóm gồm 16 bit, được ngăn cách với nhau bằng dấu hai chấm “:”. Mỗi nhóm được biểu diễn bằng 4 số hexa.
Mỗi thiết bị được kết nối với Internet có một địa chỉ IP duy nhất mà các máy khác sử dụng để tìm thiết bị. Máy chủ DNS loại bỏ nhu cầu con người phải ghi nhớ các địa chỉ IP như 192.168.1.1 (trong IPv4) hoặc các địa chỉ IP gồm chữ và số phức tạp hơn như 2400: cb00: 2048: 1 :: c629: d7a2 (trong IPv6).  

# 2. DNS (Domain Name System) hoạt động như thế nào?
vì ngôn ngữ máy tính chỉ hiểu được các số nhị phân 0 và 1 nên nhất định cần quá trình phân giải một tên miền dưới dạng chữ thành các mã nhị phân.
Quá trình phân giải DNS bao gồm việc chuyển đổi tên máy chủ (chẳng hạn như www.85network-share.blogspot.com) thành địa chỉ IP thân thiện với máy tính (chẳng hạn như 192.168.1.1). Địa chỉ IP được cấp cho mỗi thiết bị trên Internet và địa chỉ đó là cần thiết để tìm thiết bị Internet thích hợp - giống như địa chỉ đường phố được sử dụng để tìm một ngôi nhà cụ thể. Khi người dùng muốn tải một trang web, bản dịch phải xảy ra giữa những gì người dùng nhập vào trình duyệt web của họ (www.85network-share.blogspot.com) và địa chỉ thân thiện với máy cần thiết để định vị trang web www.85network-share.blogspot.com.
Để hiểu quy trình đằng sau quá trình phân giải DNS, điều quan trọng là phải tìm hiểu về các thành phần phần cứng khác nhau mà truy vấn DNS phải chuyển giữa. Đối với trình duyệt web, việc tra cứu DNS diễn ra ở chế độ “ẩn” và không yêu cầu tương tác từ máy tính của người dùng ngoài yêu cầu ban đầu. 
# 3. 4 máy chủ DNS liên quan đến việc tải một trang web:
4. ![](https://images.viblo.asia/c127a4ea-5183-4257-a6ef-7734491385ef.jpg)

Trình đệ quy DNS - Đệ quy: có thể được coi như một thủ thư được yêu cầu đi tìm một cuốn sách cụ thể ở đâu đó trong thư viện. Đệ quy DNS là một máy chủ được thiết kế để nhận các truy vấn từ các máy khách thông qua các ứng dụng như trình duyệt web. Thông thường, trình đệ quy sau đó chịu trách nhiệm thực hiện các yêu cầu bổ sung để đáp ứng truy vấn DNS của máy khách.
Máy chủ định danh gốc - Máy chủ gốc là bước đầu tiên trong việc dịch (phân giải) các tên máy chủ có thể đọc được của con người thành địa chỉ IP. Nó có thể được coi như một chỉ mục trong thư viện trỏ đến các giá sách khác nhau - thường nó dùng như một tham chiếu đến các vị trí cụ thể hơn khác. 
Máy chủ định danh TLD - Máy chủ miền cấp cao nhất (TLD) có thể được coi như một giá sách cụ thể trong thư viện. Máy chủ định danh này là bước tiếp theo trong quá trình tìm kiếm địa chỉ IP cụ thể và nó lưu trữ phần cuối cùng của tên máy chủ (Trong example.com, máy chủ TLD là “com”). 
Máy chủ định danh có thẩm quyền - Máy chủ định danh này có thể được coi như một cuốn từ điển trên giá sách, trong đó một tên cụ thể có thể được dịch theo định nghĩa của nó. Máy chủ định danh có thẩm quyền là điểm dừng cuối cùng trong truy vấn máy chủ định danh. Nếu máy chủ định danh có thẩm quyền có quyền truy cập vào bản ghi được yêu cầu, nó sẽ trả lại địa chỉ IP cho tên máy chủ được yêu cầu trở lại DNS Recursor (thủ thư) đã thực hiện yêu cầu ban đầu. 

# 4. Sự khác biệt giữa máy chủ DNS có thẩm quyền và trình phân giải DNS đệ quy là gì?
Cả hai khái niệm đều đề cập đến các máy chủ (nhóm máy chủ) không thể tách rời với cơ sở hạ tầng DNS, nhưng mỗi máy thực hiện một vai trò khác nhau và sống ở các vị trí khác nhau bên trong đường dẫn truy vấn DNS. Một cách để suy nghĩ về sự khác biệt là trình phân giải đệ quy ở đầu truy vấn DNS và máy chủ định danh có thẩm quyền ở cuối.
## Trình phân giải DNS đệ quy: 
Trình phân giải đệ quy là máy tính phản hồi yêu cầu đệ quy từ máy khách và dành thời gian để theo dõi bản ghi DNS. Nó thực hiện điều này bằng cách thực hiện một loạt yêu cầu cho đến khi nó đến máy chủ định danh DNS có thẩm quyền cho bản ghi được yêu cầu (hoặc hết thời gian chờ hoặc trả về lỗi nếu không tìm thấy bản ghi). May mắn thay, các trình phân giải DNS đệ quy không phải lúc nào cũng cần thực hiện nhiều yêu cầu để theo dõi các bản ghi cần thiết để phản hồi cho một máy khách; bộ nhớ đệm là một quá trình liên tục dữ liệu giúp rút ngắn các yêu cầu cần thiết bằng cách cung cấp bản ghi tài nguyên được yêu cầu trước đó trong tra cứu DNS. 
## Máy chủ DNS ủy quyền:
Nói một cách đơn giản, một máy chủ DNS có thẩm quyền là một máy chủ thực sự lưu giữ và chịu trách nhiệm về các bản ghi tài nguyên DNS. Đây là máy chủ ở cuối chuỗi tra cứu DNS sẽ phản hồi với bản ghi tài nguyên được truy vấn, cuối cùng cho phép trình duyệt web thực hiện yêu cầu đạt được địa chỉ IP cần thiết để truy cập trang web hoặc các tài nguyên web khác. Máy chủ định danh có thẩm quyền có thể đáp ứng các truy vấn từ dữ liệu của chính nó mà không cần truy vấn nguồn khác, vì nó là nguồn trung thực cuối cùng cho các bản ghi DNS nhất định.
Điều đáng nói là trong các trường hợp truy vấn dành cho miền phụ như foo.example.com hoặc blog.cloudflare.com, một máy chủ định danh bổ sung sẽ được thêm vào trình tự sau máy chủ định danh có thẩm quyền, chịu trách nhiệm lưu trữ bản ghi CNAME của miền phụ.

Có một sự khác biệt chính giữa nhiều dịch vụ DNS và dịch vụ mà Cloudflare cung cấp. Các trình phân giải đệ quy DNS khác nhau như Google DNS, OpenDNS và các nhà cung cấp như Comcast đều duy trì cài đặt trung tâm dữ liệu của trình phân giải đệ quy DNS. Các trình phân giải này cho phép thực hiện các truy vấn nhanh chóng và dễ dàng thông qua các cụm hệ thống máy tính được tối ưu hóa bằng DNS được tối ưu hóa, nhưng về cơ bản chúng khác với các máy chủ định danh do Cloudflare lưu trữ. 
Cloudflare duy trì máy chủ định danh cấp cơ sở hạ tầng không thể thiếu đối với hoạt động của Internet. Một ví dụ chính là mạng máy chủ f-root mà Cloudflare chịu trách nhiệm một phần trong việc lưu trữ. F-root là một trong những thành phần cơ sở hạ tầng máy chủ định danh DNS cấp gốc chịu trách nhiệm cho hàng tỷ yêu cầu Internet mỗi ngày. Mạng Anycast của chúng tôi đặt chúng tôi vào một vị trí duy nhất để xử lý khối lượng lớn lưu lượng DNS mà không bị gián đoạn dịch vụ. 
## 5. Các bước tra cứu DNS là gì?
Đối với hầu hết các tình huống, DNS liên quan đến việc một tên miền được dịch sang địa chỉ IP thích hợp. Để tìm hiểu cách thức hoạt động của quá trình này, hãy theo dõi đường dẫn của tra cứu DNS khi nó di chuyển từ trình duyệt web, thông qua quy trình tra cứu DNS và quay lại lần nữa. Chúng ta hãy xem xét các bước. 
Lưu ý: Thường thì thông tin tra cứu DNS sẽ được lưu trữ cục bộ bên trong máy tính truy vấn hoặc từ xa trong cơ sở hạ tầng DNS. Thường có 8 bước trong tra cứu DNS. Khi thông tin DNS được lưu vào bộ nhớ cache, các bước sẽ được bỏ qua khỏi quy trình tra cứu DNS, giúp quá trình này nhanh hơn. Ví dụ dưới đây phác thảo tất cả 8 bước khi không có gì được lưu vào bộ nhớ cache.
## 8 bước khi tra cứu DNS:
Người dùng nhập ‘example.com’ vào trình duyệt web và truy vấn sẽ truyền vào Internet và được nhận bởi trình phân giải đệ quy DNS. 
1) Sau đó, trình phân giải sẽ truy vấn một máy chủ định danh gốc DNS (.).
2) Sau đó, máy chủ gốc sẽ phản hồi trình phân giải bằng địa chỉ của máy chủ DNS của Miền cấp cao nhất (TLD) (chẳng hạn như .com hoặc .net), nơi lưu trữ thông tin cho các miền của nó. Khi tìm kiếm example.com, yêu cầu của chúng tôi được hướng tới TLD .com. 
3) Sau đó, trình phân giải thực hiện một yêu cầu tới .com TLD. 
4) Sau đó, máy chủ TLD sẽ phản hồi bằng địa chỉ IP của máy chủ định danh của miền, example.com.
5) Cuối cùng, trình phân giải đệ quy gửi một truy vấn đến máy chủ định danh của miền. 
6) Địa chỉ IP cho example.com sau đó được trả về trình phân giải từ máy chủ định danh. 
7) Sau đó, trình phân giải DNS sẽ phản hồi lại trình duyệt web bằng địa chỉ IP của miền được yêu cầu ban đầu. 
8) Sau khi 8 bước tra cứu DNS đã trả lại địa chỉ IP cho example.com, trình duyệt có thể thực hiện yêu cầu cho trang web: 
Trình duyệt thực hiện một yêu cầu HTTP đến địa chỉ IP. Máy chủ tại IP đó trả về trang web sẽ được hiển thị trong trình duyệt  
## 6. Trình phân giải DNS là gì? 
Trình phân giải DNS là điểm dừng đầu tiên trong quá trình tra cứu DNS và nó chịu trách nhiệm xử lý ứng dụng khách đã đưa ra yêu cầu ban đầu. Trình phân giải bắt đầu chuỗi truy vấn cuối cùng dẫn đến một URL được dịch thành địa chỉ IP cần thiết. 
Lưu ý: Tra cứu DNS chưa được lưu trữ điển hình sẽ liên quan đến cả truy vấn đệ quy và lặp lại. Điều quan trọng là phải phân biệt giữa truy vấn DNS đệ quy và trình phân giải DNS đệ quy. Truy vấn đề cập đến yêu cầu được thực hiện tới trình phân giải DNS yêu cầu giải quyết truy vấn. Máy phân giải đệ quy DNS là máy tính chấp nhận truy vấn đệ quy và xử lý phản hồi bằng cách đưa ra các yêu cầu cần thiết.
## 7. Các loại truy vấn DNS là gì?  
Trong một tra cứu DNS điển hình, ba loại truy vấn xảy ra. Bằng cách sử dụng kết hợp các truy vấn này, một quy trình được tối ưu hóa để phân giải DNS có thể dẫn đến việc giảm khoảng cách di chuyển. Trong một tình huống lý tưởng, dữ liệu bản ghi đã lưu trong bộ nhớ cache sẽ có sẵn, cho phép máy chủ định danh DNS trả về một truy vấn không đệ quy. 
## 8. 3 loại truy vấn DNS: 
**Truy vấn đệ quy** - Trong truy vấn đệ quy, máy khách DNS yêu cầu máy chủ DNS (thường là trình phân giải đệ quy DNS) sẽ trả lời máy khách bằng bản ghi tài nguyên được yêu cầu hoặc thông báo lỗi nếu trình phân giải không thể tìm thấy bản ghi. 
**Truy vấn lặp lại** - trong trường hợp này, máy khách DNS sẽ cho phép máy chủ DNS trả lại câu trả lời tốt nhất có thể. Nếu máy chủ DNS được truy vấn không khớp với tên truy vấn, nó sẽ trả về giới thiệu đến máy chủ DNS có thẩm quyền cho cấp thấp hơn của không gian tên miền. Máy khách DNS sau đó sẽ thực hiện một truy vấn đến địa chỉ giới thiệu. Quá trình này tiếp tục với các máy chủ DNS bổ sung trong chuỗi truy vấn cho đến khi xảy ra lỗi hoặc hết thời gian.
**Truy vấn không đệ quy** - thường điều này sẽ xảy ra khi máy khách trình phân giải DNS truy vấn máy chủ DNS về bản ghi mà nó có quyền truy cập vì nó có thẩm quyền đối với bản ghi hoặc bản ghi tồn tại bên trong bộ nhớ cache của nó. Thông thường, một máy chủ DNS sẽ lưu trữ các bản ghi DNS để ngăn chặn việc tiêu thụ thêm băng thông và tải trên các máy chủ ngược dòng. 
## 9. Bộ nhớ đệm DNS là gì? Bộ nhớ đệm DNS xảy ra ở đâu? 
Mục đích của bộ nhớ đệm là để dữ liệu được lưu trữ tạm thời ở một vị trí dẫn đến cải thiện hiệu suất và độ tin cậy cho các yêu cầu dữ liệu. Bộ nhớ đệm DNS liên quan đến việc lưu trữ dữ liệu gần máy khách yêu cầu hơn để truy vấn DNS có thể được giải quyết sớm hơn và có thể tránh được các truy vấn bổ sung trong chuỗi tra cứu DNS, do đó cải thiện thời gian tải và giảm tiêu thụ băng thông / CPU. Dữ liệu DNS có thể được lưu vào bộ nhớ cache ở nhiều vị trí khác nhau, mỗi vị trí sẽ lưu trữ các bản ghi DNS trong một khoảng thời gian nhất định được xác định theo thời gian tồn tại (TTL). 
## 10. Bộ nhớ đệm DNS của trình duyệt 
Các trình duyệt web hiện đại được thiết kế theo mặc định để lưu các bản ghi DNS vào bộ nhớ cache trong một khoảng thời gian nhất định. mục đích ở đây là rõ ràng; Bộ nhớ đệm DNS xảy ra càng gần với trình duyệt web, thì càng phải thực hiện ít bước xử lý hơn để kiểm tra bộ nhớ cache và thực hiện các yêu cầu chính xác đối với địa chỉ IP. Khi yêu cầu bản ghi DNS được thực hiện, bộ nhớ cache của trình duyệt là vị trí đầu tiên được kiểm tra cho bản ghi được yêu cầu. Trong chrome, bạn có thể xem trạng thái của bộ đệm DNS của mình bằng cách truy cập chrome: // net-internals / # dns. 
## 11. Bộ nhớ đệm DNS cấp hệ điều hành (OS) 
Trình phân giải DNS cấp hệ điều hành là trạm dừng cục bộ thứ hai và cuối cùng trước khi truy vấn DNS rời khỏi máy của bạn. Quá trình bên trong hệ điều hành của bạn được thiết kế để xử lý truy vấn này thường được gọi là "trình phân giải sơ khai" hoặc máy khách DNS. Khi trình giải quyết sơ khai nhận được yêu cầu từ một ứng dụng, trước tiên nó sẽ kiểm tra bộ nhớ cache của chính nó để xem liệu nó có bản ghi hay không. Nếu không, nó sẽ gửi một truy vấn DNS (với cờ đệ quy được đặt), bên ngoài mạng cục bộ tới trình phân giải đệ quy DNS bên trong nhà cung cấp dịch vụ Internet (ISP).
Khi trình phân giải đệ quy bên trong ISP nhận được truy vấn DNS, giống như tất cả các bước trước đó, nó cũng sẽ kiểm tra xem bản dịch địa chỉ máy chủ sang IP được yêu cầu đã được lưu trữ bên trong lớp bền cục bộ của nó hay chưa.
Trình phân giải đệ quy cũng có chức năng bổ sung tùy thuộc vào loại bản ghi mà nó có trong bộ nhớ cache: 
Nếu trình phân giải không có bản ghi A, nhưng có bản ghi NS cho máy chủ định danh có thẩm quyền, nó sẽ truy vấn trực tiếp các máy chủ định danh đó, bỏ qua một số bước trong truy vấn DNS. Lối tắt này ngăn chặn việc tra cứu từ máy chủ tên gốc và .com (trong tìm kiếm của chúng tôi là example.com) và giúp việc giải quyết truy vấn DNS diễn ra nhanh hơn. 
Nếu trình phân giải không có bản ghi NS, nó sẽ gửi một truy vấn đến máy chủ TLD (trong trường hợp của chúng tôi là .com), bỏ qua máy chủ gốc. 
Trong trường hợp không chắc chắn rằng trình phân giải không có bản ghi trỏ đến máy chủ TLD, sau đó nó sẽ truy vấn máy chủ gốc. Sự kiện này thường xảy ra sau khi bộ nhớ cache DNS đã được xóa.