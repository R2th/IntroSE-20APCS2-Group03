![](https://images.viblo.asia/d9fe961d-369f-4952-a9d8-0bd3cb41bc50.jpg)

HÃ´m nay trá»i thanh giÃ³ mÃ¡t, [**Láº­p trÃ¬nh khÃ´ng khÃ³**](https://nguyenvanhieu.vn/) sáº½ cÃ¹ng cÃ¡c báº¡n Ä‘i xÃ¢y dá»±ng má»™t chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ **dá»± Ä‘oÃ¡n ngÃ´n ngá»¯ láº­p trÃ¬nh** khi cung cáº¥p cho nÃ³ code. Ã tÆ°á»Ÿng cÃ³ váº» khÃ¡ to, nhÆ°ng Ä‘Æ¡n giáº£n láº¯m. CÃ¹ng mÃ¬nh báº¯t tay vÃ o triá»ƒn khai nhÃ©.

## Dá»± Ä‘oÃ¡n ngÃ´n ngá»¯ láº­p trÃ¬nh

Ã tÆ°á»Ÿng bÃ i toÃ¡n dá»± Ä‘oÃ¡n ngÃ´n ngá»¯ láº­p trÃ¬nh ráº¥t Ä‘Æ¡n giáº£n: hÃ£y Ä‘Æ°a cho tÃ´i má»™t Ä‘oáº¡n code. TÃ´i sáº½ cho báº¡n biáº¿t code nÃ y Ä‘Æ°á»£c viáº¿t bá»Ÿi ngÃ´n ngá»¯ láº­p trÃ¬nh nÃ o!

TrÃªn thá»±c táº¿, khi báº¡n nhÃ¬n vÃ o má»™t source code báº¡n cÃ³ thá»ƒ Ä‘oÃ¡n Ä‘Æ°á»£c ngÃ´n ngá»¯ láº­p trÃ¬nh nÃ o Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ táº¡o ra Ä‘oáº¡n code Ä‘Ã³ khÃ´ng? CÃ¢u tráº£ lá»i lÃ  khÃ´ng, náº¿u báº¡n chÆ°a biáº¿t tá»›i ngÃ´n ngá»¯ Ä‘Ã³. NhÆ°ng náº¿u báº¡n Ä‘Ã£ sá»­ dá»¥ng qua, báº¡n cÃ³ thá»ƒ dá»… dÃ ng biáº¿t Ä‘Ã³ lÃ  ngÃ´n ngá»¯ nÃ o. Táº¡i sao báº¡n láº¡i cÃ³ thá»ƒ Ä‘oÃ¡n Ä‘Æ°á»£c: Táº¥t nhiÃªn lÃ  nhÃ¬n vÃ o cÃº phÃ¡p cá»§a Ä‘oáº¡n code Ä‘á»ƒ tÃ¬m ra cÃ¡c Ä‘áº·c trÆ°ng cá»§a má»—i ngÃ´n ngá»¯ pháº£i khÃ´ng nÃ o? Cháº³ng háº¡n nhÆ°: 

- NgÃ´n ngá»¯ Python: Ä‘á»‹nh nghÄ©a hÃ m báº±ng tá»« khÃ³a def, khÃ´ng cÃ³ cáº·p ngoáº·c {}, sá»­ dá»¥ng cÃ¢u lá»‡nh `import`, cÃ³ dÃ²ng `if __name__ == __main__`,â€¦
- NgÃ´n ngá»¯ C++: khai bÃ¡o thÆ° viá»‡n dÃ¹ng `#include`, cÃ³ `cout`, `cin` huyá»n thoáº¡i,â€¦

Má»—i ngÃ´n ngá»¯ Ä‘á»u cÃ³ nhá»¯ng Ä‘áº·c Ä‘iá»ƒm riÃªng. VÃ  viá»‡c cá»§a chÃºng ta lÃ  tÃ¬m cÃ¡ch xÃ¢y dá»±ng má»™t chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ lÃ m Ä‘iá»u Ä‘Ã³.

á» gÃ³c nhÃ¬n cá»§a machine learning, Ä‘Ã¢y thá»±c cháº¥t lÃ  bÃ i toÃ¡n **phÃ¢n loáº¡i vÄƒn báº£n**(document classification) nhiá»u lá»›p. VÃ  **má»—i má»™t lá»›p sáº½ lÃ  má»™t ngÃ´n ngá»¯ láº­p trÃ¬nh**. Trong bÃ i viáº¿t nÃ y, mÃ¬nh sáº½ cÃ¹ng cÃ¡c báº¡n tá»«ng bÆ°á»›c xÃ¢y dá»±ng má»™t **chÆ°Æ¡ng trÃ¬nh dá»± Ä‘oÃ¡n ngÃ´n ngá»¯ láº­p trÃ¬nh hoÃ n chá»‰nh**. ChÃºng ta sáº½ Ä‘i qua cÃ¡c pháº§n:

1. Chuáº©n bá»‹ dá»¯ liá»‡u
2. Tiá»n xá»­ lÃ½
3. Train mÃ´ hÃ¬nh sá»­ dá»¥ng Fasttext
4. XÃ¢y dá»±ng giao diá»‡n vá»›i Flask

CÃ¡c báº¡n Ä‘á»«ng quÃ¡ lo láº¯ng náº¿u khÃ´ng biáº¿t nhiá»u vá» machine learning. BÃ i viáº¿t nÃ y Ä‘Æ°á»£c viáº¿t lÃ  dÃ nh cho nhá»¯ng ngÆ°á»i khÃ´ng chuyÃªn. BÃ¢y giá» chÃºng ta sáº½ Ä‘i vÃ o tá»«ng pháº§n chi tiáº¿t nhÃ©.

### 1. Chuáº©n bá»‹ dá»¯ liá»‡u

Dá»¯ liá»‡u lÃ  thá»© khÃ´ng thá»ƒ thiáº¿u Ä‘á»‘i vá»›i mÃ¡y há»c. BÃ¢y giá» chÃºng ta cáº§n Ä‘i kiáº¿m cho má»—i ngÃ´n ngá»¯ má»™t kho code. MÃ¬nh giáº£ sá»­ **má»—i ngÃ´n ngá»¯ láº­p trÃ¬nh cÃ³ táº§m 1000 Ä‘oáº¡n code** lÃ  ok. ChÃºng ta sáº½ cá»‘ gáº¯ng phÃ¢n loáº¡i cÃ ng nhiá»u ngÃ´n ngá»¯ láº­p trÃ¬nh cÃ ng tá»‘t. NhÆ°ng Ä‘iá»u Ä‘Ã³ cÃ²n phá»¥ thuá»™c vÃ o dá»¯ liá»‡u ^^.

#### TÃ¬m kiáº¿m Ã½ tÆ°á»Ÿng

NghÄ© Ä‘áº¿n code lÃ  mÃ¬nh nghÄ© ngay tá»›i **StackOverFlow**, lÃªn Ä‘Ã³ lÆ°á»£n 1 há»“i cÅ©ng nghÄ© ra cÃ¡ch Ä‘á»ƒ kiáº¿m dá»¯ liá»‡u cá»±c ká»³ ez. Ã tÆ°á»Ÿng nhÆ° sau:

Äáº§u tiÃªn, vÃ o trang Tags cá»§a há» Ä‘á»ƒ láº¥y cÃ¡c tags vá», cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh cÃ³ tags náº±m trong top Ä‘áº§u luÃ´n, nÃªn chÃºng ta chá»‰ cáº§n láº¥y khoáº£ng 5 trang Ä‘áº§u lÃ  láº¥y Ä‘Æ°á»£c háº§u háº¿t ngÃ´n ngá»¯ láº­p trÃ¬nh rá»“i.

![](https://images.viblo.asia/a72aaf87-80a5-47ee-a7e4-4b8bd9f4f6b7.png)

#### Triá»ƒn khai Ã½ tÆ°á»Ÿng

Äá»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u nÃ y thÃ¬ mÃ¬nh sá»­ dá»¥ng **thÆ° viá»‡n requests trong Python** Ä‘á»ƒ crawl data. Sau Ä‘Ã³ extract láº¥y tags vÃ  url tá»›i cÃ¡c tags Ä‘Ã³. Má»¥c Ä‘Ã­ch lÃ  Ä‘á»ƒ lá»c cÃ¡c bÃ i viáº¿t theo tháº» tags. Táº¥t nhiÃªn, sáº½ cÃ³ láº«n má»™t sá»‘ tags khÃ´ng pháº£i ngÃ´n ngá»¯ láº­p trÃ¬nh, lá»c tay qua 1 lÆ°á»£t chÆ°a máº¥t tá»›i 5 phÃºt ğŸ™‚

Má»™t phÃ¡t hiá»‡n thÃº vá»‹ ná»¯a, má»—i Ä‘oáº¡n code trong trang nÃ y Ä‘á»u cÃ³ class Ä‘i kÃ¨m, cháº³ng háº¡n Ä‘oáº¡n **code php cÃ³ css-class lÃ  lang-php, hay Python thÃ¬ lÃ  lang-py**,â€¦ BÆ°á»›c nÃ y láº¡i pháº£i lÃ m báº±ng tay, pháº£i mÃ² thÃ´i. Sau cÃ¹ng cÅ©ng thu Ä‘Æ°á»£c má»™t bá»™ sÆ°u táº­p gá»“m **khoáº£ng 20 class khÃ¡c nhau(20 ngÃ´n ngá»¯ láº­p trÃ¬nh)**. Viá»‡c cÃ²n láº¡i pháº£i lÃ m lÃ  Ä‘i lÃ´i dá»¯ liá»‡u vá» mÃ¡y thÃ´i. Vá»›i má»—i tags chÃºng ta Ä‘Ã£ cÃ³ url Ä‘á»ƒ lá»c bÃ i viáº¿t rá»“i, lá»c tiáº¿p theo css-class Ä‘á»ƒ thu Ä‘Æ°á»£c dá»¯ liá»‡u chuáº©n nháº¥t.

Vá»›i má»—i ngÃ´n ngá»¯ láº­p trÃ¬nh, thá»±c hiá»‡n requests theo tá»«ng link tá»›i tags Ä‘Ã³ Ä‘á»ƒ kiáº¿m cÃ¡c bÃ i viáº¿t cá»§a tags Ä‘Ã³. NhÆ°ng váº¥n Ä‘á» phÃ¡t sinh ná»¯a lÃ : CÃ¡c cá»¥c code nÃ y load báº±ng Javascript. LÃºc nÃ y requests chá»‹u thua rá»“i. MÃ¬nh pháº£i tÃ¬m giáº£i phÃ¡p má»›i Ä‘Ã³ lÃ  **Selenium**. Æ¯u Ä‘iá»ƒm cá»§a tháº±ng nÃ y lÃ  **chÆ¡i luÃ´n Ä‘Æ°á»£c vá»›i Javascript**. Tháº¿ lÃ  ngon rá»“i, kÃ©o dá»¯ liá»‡u vá» thÃ´i. NÃ³i dá»… chá»© quÃ¡ trÃ¬nh lÃ´i data vá» cÅ©ng ráº¥t tá»‘n thá»i gian(máº¥t máº¥y ngÃ y láº­n), láº¡i cÃ²n bá»‹ StackOverFlow cháº·n do â€œ**Spam Request**â€. Ai biáº¿t cÃ¡ch trÃ¡nh lá»—i nÃ y mÃ¡ch mÃ¬nh vá»›i nha.

Sau bÆ°á»›c nÃ y, chÃºng ta thu Ä‘Æ°á»£c kha khÃ¡ dá»¯ liá»‡u, má»—i ngÃ´n ngá»¯ lÆ°u vÃ o 1 file riÃªng biá»‡t. LÆ°á»£ng code nÃ y cÅ©ng Ä‘á»§ Ä‘á»ƒ dÃ¹ng cho huáº¥n luyá»‡n rá»“i.

### 2. Tiá»n xá»­ lÃ½ dá»¯ liá»‡u

Viá»‡c tiá»n xá»­ lÃ½ dá»¯ liá»‡u sáº½ giÃºp chÆ°Æ¡ng trÃ¬nh dá»± Ä‘oÃ¡n ngÃ´n ngá»¯ láº­p trÃ¬nh chÃ­nh xÃ¡c hÆ¡n. Tuy nhiÃªn, Dá»¯ liá»‡u Ä‘áº·c thÃ¹, cÅ©ng lÃ  láº§n Ä‘áº§u mÃ¬nh lÃ m nÃªn cháº³ng biáº¿t giá»¯ gÃ¬, bá» gÃ¬. Suy nghÄ© má»™t há»“i thÃ¬ cÅ©ng nháº­n ra 2 cÃ¡i cáº§n lÃ m:

- **XÃ³a bá» cÃ¡c dÃ²ng comment** trong Code, cÃ¡i nÃ y cÃ³ Ä‘á»c cÅ©ng cháº³ng biáº¿t lÃ  ngÃ´n ngá»¯ gÃ¬ nÃ y
- **Loáº¡i khoáº£ng tráº¯ng thá»«a**, Ä‘Æ°a vá» 1 dÃ²ng thÃ´i. CÃ³ váº» nÃ³ cÅ©ng vÃ´ dá»¥ng Ã½ nhá»ƒ
- CÃ²n cÃ¡i gÃ¬ cÃ³ thá»ƒ lÃ m thÃ¬ cÃ¡c báº¡n gá»£i Ã½ thÃªm mÃ¬nh vá»›i, cháº£ biáº¿t lÃ m gÃ¬ ná»¯aâ€¦

Tháº¿ lÃ  tá»« má»™t Ä‘oáº¡n code nhÆ° nÃ y:
```
def check():
    # Comment
    return render_template('index.html')
    /*
        Comemnt
    */
```
Sau khi xá»­ lÃ½ thÃ¬ chÃºng ta thu Ä‘Æ°á»£c:
```
def check(): return render_template(
```

á» Ä‘Ã¢y, viá»‡c xÃ³a comment trong code sá»­ dá»¥ng cÃ¡c **regex** sau Ä‘Ã¢y:

```
// Remove comment
(\/\/.+)|(#.+)|('.+)|(\/\*[^(\*\/)]+?\*\/)|(\"{3}[^(\"{3})]+?\"{3}) -> ' '
 
// Remove extra space
\s+ -> ' '
```

NÃ³ xÃ³a máº¥t cáº£ cÃ¡i â€˜index.htmlâ€™ rá»“i, nhÆ°ng ká»‡ nÃ³, vÃ¬ dáº¥u â€˜ cÅ©ng lÃ  báº¯t Ä‘áº§u comment cá»§a má»™t ngÃ´n ngá»¯ nÃ o Ä‘Ã³ mÃ  mÃ¬nh cÅ©ng cháº³ng nhá»› ná»¯a. Báº¡n cÃ³ thá»ƒ xem cÃ¡ch cÃ¡i **regex nÃ y nÃ³ hoáº¡t Ä‘á»™ng ra sao** [**táº¡i Ä‘Ã¢y**](https://regex101.com/r/T95bOm/2).

Theo quan sÃ¡t thÃ¬ cÃ³ váº» pháº§n tiá»n xá»­ lÃ½ nÃ y chÆ°a Ä‘Æ°á»£c tá»‘i Æ°u cho láº¯m. Pháº§n nÃ y mÃ¬nh nhá» cÃ¡c báº¡n tiáº¿p tá»¥c tá»‘i Æ°u thÃªm giÃºp mÃ¬nh. Xong khÃ¢u tiá»n xá»­ lÃ½, bÃ¢y giá» Ä‘i vÃ o huáº¥n luyá»‡n thÃ´i nÃ o.

### 3. Huáº¥n luyá»‡n mÃ´ hÃ¬nh vá»›i Fasttext

Náº¿u báº¡n nÃ o chÆ°a biáº¿t **Fasttext** lÃ  gÃ¬ thÃ¬ xem nÃ³ [**á»Ÿ Ä‘Ã¢y nhÃ©**](https://github.com/facebookresearch/fastText). á» Ä‘Ã³ cÅ©ng cÃ³ hÆ°á»›ng dáº«n cÃ i Ä‘áº·t, mÃ¬nh thÃ¬ **cÃ i Ä‘áº·t trÃªn Python**.

TrÆ°á»›c khi huáº¥n luyá»‡n, chÃºng ta cáº§n chuáº©n bá»‹ **dá»¯ liá»‡u huáº¥n luyá»‡n(training) vÃ  kiá»ƒm thá»­(testing)**. á» Ä‘Ã¢y mÃ¬nh sáº½ chia theo tá»‰ lá»‡ train/test = 80/20. 80% dá»¯ liá»‡u sáº½ dÃ¹ng Ä‘á»ƒ há»c vÃ  20% cÃ²n láº¡i sáº½ test xem thuáº­t toÃ¡n nÃ³ há»c â€œgiá»iâ€ hay â€œdá»‘tâ€. Vá»›i Fasttext, má»—i máº«u dá»¯ liá»‡u(á»Ÿ Ä‘Ã¢y lÃ  má»—i Ä‘oáº¡n code Ä‘Ã³ áº¡) sáº½ cÃ³ format nhÆ° sau: `__lb__label data`. VÃ­ dá»¥ vÃ i máº«u nhÃ©:
```
__lb__lang-java public class Customer implements Parcelable { private String firstName, lastName, address; int age; public Customer(Parcel in ) { readFromParcel( in ); } public static final Parcelable.Creator CREATOR = new Parcelable.Creator() { public LeadData createFromParcel(Parcel in ) { return new Customer( in ); } public Customer[] newArray(int size) { return new Customer[size]; } }; @Override public void writeToParcel(Parcel dest, int flags) { dest.writeString(firstName); dest.writeString(lastName); dest.writeString(address); dest.writeInt(age); } private void readFromParcel(Parcel in ) { firstName = in .readString(); lastName = in .readString(); address = in .readString(); age = in .readInt(); }
__lb__lang-cs string title = "ASTRINGTOTEST"; title.Contains("string");
__lb__lang-sh find ./fs*/* -type d -print0 | xargs -0 -n 1 cp test
```

Sau khi chuáº©n bá»‹ xong thÃ¬ huáº¥n luyá»‡n thÃ´i. QuÃ¡ trÃ¬nh train chá»‰ máº¥t vÃ i dÃ²ng code lÃ  xong.

```
train_data = "data/train.txt"
valid_data = "data/test.txt"
 
# train_supervised uses the same arguments and defaults as the fastText cli
model = train_supervised(
    # input=train_data, epoch=25, lr=0.1, wordNgrams=2
    input=train_data, epoch=5, lr=0.1, wordNgrams=1, verbose=2, loss="softmax", label='__lb__'
)
 
model.save_model("model/ft.li.1701.bin")
```

Káº¿t quáº£ train demo vá»›i 1 vÃ i nhÃ£n cÅ©ng khÃ¡ áº¥n tÆ°á»£ng. á» Ä‘Ã¢y, mÃ¬nh sá»­ dá»¥ng **Ä‘á»™ chÃ­nh xÃ¡c(Accuracy) = (sá»‘ máº«u dá»± Ä‘oÃ¡n Ä‘Ãºng)/ (Tá»•ng sá»‘ máº«u Ä‘em ra dá»± Ä‘oÃ¡n)** cho tá»«ng nhÃ£n.

```
{
  "__lb__lang-css": 0.99,
  "__lb__lang-perl": 0.66,
  "__lb__lang-cs": 0.86,
  "__lb__lang-php": 0.84,
  "__lb__lang-java": 0.9,
  "__lb__lang-hs": 0.9,
  "__lb__lang-cpp": 0.69,
  "__lb__lang-sh": 0.9,
  "__lb__lang-html": 0.86,
  "__lb__lang-golang": 0.79,
  "__lb__lang-c": 0.59
}
```

Náº¿u báº¡n Ä‘á»ƒ Ã½ thÃ¬ Ä‘á»™ chÃ­nh xÃ¡c cá»§a C vá»›i C++ Ä‘á»u khÃ¡ tháº¥p. Táº¡i sao váº­y nhá»‰? ğŸ˜€

### 4. XÃ¢y dá»±ng chÆ°Æ¡ng trÃ¬nh Demo

á» Ä‘Ã¢y mÃ¬nh váº«n sáº½ dÃ¹ng Python Ä‘á»ƒ lÃ m má»™t cÃ¡i api demo. [**Flask framework**](https://nguyenvanhieu.vn/thu-vien-flask-python-la-gi/) cÃ³ thá»ƒ giÃºp ta lÃ m viá»‡c Ä‘Ã³ má»™t cÃ¡ch Ä‘Æ¡n giáº£n. Viáº¿t má»™t cÃ¡i API nhá» load sáºµn model vÃ  dÃ¹ng chá»©c nÄƒng **render_template** Ä‘á»ƒ show lÃªn 1 file html lÃªn trÃ¬nh duyá»‡t. NhÆ° váº­y lÃ  Ä‘á»§ dÃ¹ng rá»“i nhá»‰.

```
app = Flask(__name__)
 
class CodeIdentify:
    def __init__(self, model_file='../classifier/model/ft.li.1701.bin',
                 code2namefile='../data_crawler/data/lang_code.json'):
        self.model = ft.load_model(model_file)
        self.code2name = rev_dict(json.load(open(code2namefile, encoding='utf8')))
        self.tp = CodePreprocess()
 
    def pred(self, txt):
        txt = self.tp.preprocess(txt)
        res = self.model.predict(txt)
        label = res[0][0]
        score = round(res[1][0], 2)
        language_name = self.code2name[label[6:]].upper()
        return language_name, score
 
 
ci = CodeIdentify()
 
 
@app.route('/')
def ping():
    return 'ok'
 
 
@app.route('/check', methods=['GET', 'POST'])
def check():
    if request.method == 'GET':
        return render_template('index.html')
    else:
        try:
            code = request.form['code']
            if not code or len(code) <= 20:
                return render_template('index.html', error='Please type more than 20 characters!')
            language, score = ci.pred(code)
            return render_template('index.html', language=language, score=score, code=code)
        except:
            traceback.print_exc()
            return render_template('index.html', error='Unknown error has occurred, please try again!')
 
 
if __name__ == '__main__':
    app.run(debug=True)

```

VÃ  Ä‘Ã¢y lÃ  giao diá»‡n chÆ°Æ¡ng trÃ¬nh sau khi cháº¡y:

![](https://images.viblo.asia/0a0b631e-4e78-4492-a12f-02a1d8c14022.png)

### 5. Káº¿t luáº­n

Váº­y lÃ  xong má»™t chÆ°Æ¡ng trÃ¬nh dá»± Ä‘oÃ¡n ngÃ´n ngá»¯ láº­p trÃ¬nh phá»©c táº¡p mÃ  láº¡i cá»±c ká»³ Ä‘Æ¡n giáº£n. Source code cá»§a bÃ i nÃ y mÃ¬nh Ä‘á»ƒ táº¡i [**link github nÃ y**](https://github.com/NguyenVanHieuBlog/programing-language-identify). Náº¿u tháº¥y hay Ä‘á»«ng quÃªn **cho mÃ¬nh 1 star** nhÃ©.

**Bugs nÃ¨:** Náº¿u bÃ¢y giá» tháº±ng ngÆ°á»i dÃ¹ng nÃ³ vá»©t má»™t bÃ i bÃ¡o vÃ o thÃ¬ sao nhá»‰? Báº¡n cÃ³ thá»ƒ thÃªm má»™t nhÃ£n â€œUnknownâ€ vá»›i data khÃ´ng pháº£i code vÃ o Ä‘á»ƒ train cÃ¹ng. Hoáº·c lÃ  xÃ¢y thÃªm 1 mÃ´ hÃ¬nh sÃ ng lá»c vá»›i 2 nhÃ£n: Code vÃ  NotCode, náº¿u nÃ³ lÃ  Code thÃ¬ má»›i cho vÃ o mÃ´ hÃ¬nh nÃ y.

Xin chÃ o vÃ  háº¹n gáº·p láº¡i cÃ¡c báº¡n á»Ÿ cÃ¡c bÃ i tiáº¿p theo. Má»i tháº¯c máº¯c hÃ£y Ä‘á»ƒ láº¡i táº¡i box comment cá»§a bÃ i viáº¿t, mÃ¬nh sáº½ giáº£i Ä‘Ã¡p cho cÃ¡c báº¡n!

BÃ i viáº¿t gá»‘c Ä‘Æ°á»£c Ä‘Äƒng táº¡i Blog cÃ¡ nhÃ¢n cá»§a mÃ¬nh: https://nguyenvanhieu.vn/du-doan-ngon-ngu-lap-trinh-voi-machine-learning/