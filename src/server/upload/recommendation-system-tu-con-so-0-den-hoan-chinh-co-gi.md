# I. Introduction
Xin chÃ o má»i ngÆ°á»i, cÅ©ng khÃ¡ lÃ¢u rá»“i mÃ¬nh khÃ´ng chia sáº» Ä‘Æ°á»£c gÃ¬ cho anh em viblo, pháº§n vÃ¬ mÃ¬nh lÆ°á»i viáº¿t, pháº§n cÅ©ng vÃ¬ cáº£m tháº¥y kiáº¿n thá»©c cá»§a báº£n thÃ¢n cÃ²n háº¡n háº¹p quÃ¡ :D :D. Nay cÅ©ng lÃ  ngÃ y gáº§n cuá»‘i mÃ¬nh á»Ÿ Nháº­t, thá»i gian báº¯t Ä‘áº§u dÆ° giáº£ hÆ¡n nÃªn quyáº¿t Ä‘á»‹nh viáº¿t bÃ i nÃ y chia sáº» tá»›i ae nhá»¯ng gÃ¬ mÃ¬nh há»c Ä‘Æ°á»£c trong khoáº£ng thá»i gian á»Ÿ Ä‘Ã¢y, cÅ©ng lÃ  má»™t cÃ¡ch Ä‘á»ƒ mÃ¬nh refresh láº¡i sau má»™t khoáº£ng thá»i gian láº·p Ä‘i láº·p láº¡i 1 viá»‡c. NhÆ° má»i ngÆ°á»i cÅ©ng biáº¿t lÃ  háº§u nhÆ° má»i trang web bÃ¡n hÃ ng hiá»‡n nay tá»« nhá» cho Ä‘áº¿n lá»›n Ä‘á»u cÃ³ chá»©c nÄƒng recommend, tá»©c gá»£i Ã½ ra cÃ¡c sáº£n pháº©m Ä‘i kÃ¨m cho ngÆ°á»i dÃ¹ng. Cháº¯c khÃ´ng cáº§n pháº£i bÃ n Ä‘áº¿n cÃ´ng dá»¥ng cá»§a nÃ³ rá»“i, lÃ½ do lÃ  nÃ³ boost Ä‘Æ°á»£c purchasing consumption tá»« phÃ­a ngÆ°á»i dÃ¹ng vÃ  ngÆ°á»i Ä‘Æ°á»£c lá»£i ráº¥t lá»›n tá»« viá»‡c Ä‘Ã³ lÃ  nhá»¯ng nhÃ  kinh doanh. NhÆ°ng thá»±c sá»± Ä‘áº±ng sau nhá»¯ng thuáº­t toÃ¡n Ä‘Ã³ nÃ³ hoáº¡t Ä‘á»™ng ra sao, chÃºng ta cÅ©ng nÃªn tÃ² mÃ² chá»© nhá»‰, vÃ¬ váº­y á»Ÿ bÃ i viáº¿t nÃ y tá»› sáº½ táº¡o ra má»™t sample vÃ  cá»‘ gáº¯ng chia sáº» chi tiáº¿t nháº¥t cÃ³ thá»ƒ vá» má»™t há»‡ thá»‘ng recommendation tá»« lÃºc báº¯t Ä‘áº§u Ä‘áº¿n lÃºc ra sáº£n pháº©m Ä‘áº¿n vá»›i ngÆ°á»i dÃ¹ng thÃ¬ sáº½ cáº§n nhá»¯ng gÃ¬ nhÃ©. Hihi, láº¹t gÃ¢u!

![](https://images.viblo.asia/7629b437-b4ea-4156-af26-84430c42381d.jpeg)

# II. What is Recommendation System

   TrÆ°á»›c khi báº¯t Ä‘áº§u Ä‘i sÃ¢u hÆ¡n, mÃ¬nh sáº½ nÃ³i sÆ¡ qua cho ae nÃ o chÆ°a rÃµ bÃ i toÃ¡n nÃ y lÃ  gÃ¬ nhÃ©. ThÃ¬ nÃ´m na hiá»ƒu Ä‘Æ¡n giáº£n tháº¿ nÃ y thÃ´i, há»‡ thá»‘ng khuyáº¿n nghá»‹ lÃ  há»‡ thá»‘ng cÃ³ kháº£ nÄƒng Ä‘Æ°a ra nhá»¯ng gá»£i Ã½ cho ngÆ°á»i dÃ¹ng nhá»¯ng sáº£n pháº©m tÆ°Æ¡ng tá»± cho má»™t sáº£n pháº©m mÃ  há» Ä‘ang xem. VÃ­ dá»¥ na: Quáº§n Ã¡o, giÃ y dÃ©p, Ä‘á»“ dÃ¹ng gia Ä‘Ã¬nh, Ä‘á»“ Äƒn, Ä‘á»“ uá»‘ng, ... vÃ¢n vÃ¢n mÃ  mÃ¢y mÃ¢y, miá»…n lÃ  nÃ³ cÃ³ xu hÆ°á»›ng giá»‘ng hoáº·c Ä‘i kÃ¨m vá»›i nhau thui. 
   
   Má»™t há»‡ thá»‘ng khuyáº¿n nghá»‹ truyá»n thá»‘ng sáº½ gá»“m cÃ³ cÃ¡c cÃ¡ch chÃ­nh sau Ä‘á»ƒ Ä‘Æ°a ra gá»£i Ã½ cho ngÆ°á»i dÃ¹ng:
>    CÃ¡ch 1: NgÆ°á»i ta gá»i lÃ  ***Content-Based Recommendation System***. CÃ¡ch nÃ y dá»±a vÃ o thuá»™c tÃ­nh cá»§a cÃ¡c sáº£n pháº©m, vÃ­ dá»¥ nhÆ° tÃªn, nhÃ  sáº£n xuáº¥t, giÃ¡ cáº£, chá»‰ sá»‘, mÃ´ táº£... Ä‘á»ƒ Ä‘Æ°a ra cÃ¡c sáº£n pháº©m tÆ°Æ¡ng tá»± nhau 
>    
>    CÃ¡ch 2: Gá»i lÃ  ***Collaborative Filtering Recommendation System*** cÃ¡i nÃ y thÃ¬ dá»±a vÃ o behaviours cá»§a nhá»¯ng users cÃ³ xu hÆ°á»›ng tÆ°Æ¡ng tá»± Ä‘á»ƒ gá»£i Ã½ ra cÃ¡c sáº£n pháº©m cho ngá»«oi dÃ¹ng. CÃ³ thá»ƒ tÆ°á»Ÿng tÆ°á»£ng dÆ° nÃ y: Anh A mua sáº£n pháº©m X, Y, Z, anh B mua sáº£n pháº©m X, Y thÃ¬ kháº£ nÄƒng cao anh B cÅ©ng sáº½ mua Z nÃªn gá»£i Ã½ Z cho anh B lÃ  há»£p nÃ­.
>    
>    CÃ¡ch 3: LÃ  sá»± káº¿t há»£p cá»§a 2 cÃ¡ch trÃªn láº¡i gá»i lÃ  ***Hybrid Recommendation System***

   Má»i ngá»«oi xem áº£nh dÆ°á»›i Ä‘Ã¢y Ä‘á»ƒ hiá»ƒu thÃªm nhÃ©:
   
   ![](https://images.viblo.asia/84c9f61d-f26e-4dbc-bfa2-984bf408f8da.png)

   ![](https://images.viblo.asia/82a97b68-4b4d-4bb3-ab42-72e83349b8c0.gif)

CÃ¡c papers Ä‘Ã£ chá»‰ ra ráº±ng, káº¿t quáº£ tá»« CF vÃ  hybrid lÃ  tá»‘t hÆ¡n so vá»›i CB tuy nhiÃªn nhÆ°á»£c Ä‘iá»ƒm cá»§a CF lÃ  cáº§n pháº£i cÃ³ lá»‹ch sá»­ behaviours cá»§a ngÆ°á»i dÃ¹ng thÃ¬ má»›i cÃ³ thá»ƒ xÃ¢y dá»±ng Ä‘Æ°á»£c. VÃ¬ váº­y á»Ÿ thá»i Ä‘iá»ƒm báº¯t Ä‘áº§u, CB lÃ  má»™t sá»± lá»±a chá»n tá»‘t, chÃºng ta cÃ³ thá»ƒ lÃ m thÃªm chá»©c nÄƒng lÆ°u log hÃ nh vi ngÆ°á»i dÃ¹ng Ä‘á»ƒ sau nÃ y cÃ³ thá»ƒ tuá»³ chá»‰nh sang CF nÃ  Ä‘Æ°á»£c.

# III. Problem Summary

  BÃ i toÃ¡n chÃºng ta cáº§n giáº£i quyáº¿t lÃ  gá»£i Ã½ ra cÃ¡c sáº£n pháº§m rÆ°á»£u cÃ³ sá»± tÆ°Æ¡ng Ä‘á»“ng vá» mÃ¹i vá»‹, giÃ¡ cáº£...
  
  ![](https://images.viblo.asia/2a6a2040-18c5-4f5c-afac-4a78fe3bc260.png)

  VÃ­ dá»¥ nhÆ° nÃ y, cÃ¡i nÃ y mÃ¬nh láº¥y trÃªn trang https://sakenowa.com/en/flavor-search Ä‘Ã¢y, nhiá»‡m vá»¥ lÃ  tÃ¬m ra cÃ¡c sáº£n pháº©m cÃ³ cÃ¡c chá»‰ sá»‘ (fruity, mellow, rich, mild, dry, light) giá»‘ng nhau nháº¥t cÃ³ thá»ƒ, Ä‘á»ƒ hiá»ƒu hÆ¡n chÃºng ta Ä‘áº¿n pháº§n dataset luÃ´n cho nÃ³ nÃ³ng nhÃ©.
 
##  3.1 Dataset Crash
    
   Thuáº­n toÃ¡n mÃ¬nh sáº¯p Ä‘á» cáº­p tá»›i Ä‘Ã¢y cÃ³ thá»ƒ Ã¡p dá»¥ng cho nhiá»u bÃ i toÃ¡n khÃ¡c nhau, nhiá»u loáº¡i rÆ°á»£u khÃ¡c nhau, quan trá»ng lÃ  chÃºng ta hiá»ƒu Ä‘Æ°á»£c tÆ° tÆ°á»Ÿng thuáº­t toÃ¡n thÃ¬ sau Ä‘Ã³ cÃ³ thá»ƒ tuá»³ biáº¿n Ä‘Æ°á»£c thui, hehe. 
   
   Dá»¯ liá»‡u tá»› chuáº©n bá»‹ Ä‘Æ°á»£c crawl á»Ÿ trang https://sakenowa.com/ nÃ y vá», lÃ  dá»¯ liá»‡u vá» rÆ°á»£u Sake, trang nÃ y mÃ¬nh tháº¥y khÃ¡ á»•n vÃ  Ä‘Ã£ Ä‘i vÃ o hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c 1 thá»i gian rá»“i nÃªn cÃ³ thá»ƒ coi lÃ  má»™t nguá»“n dá»¯ liá»‡u tá»‘t. Tuy nhiÃªn lÃ m tháº¿ nÃ o Ä‘á»ƒ crawl Ä‘Æ°á»£c Ä‘á»‘ng dá»¯ liá»‡u nÃ y vá», ban Ä‘áº§u tá»› Ä‘á»‹nh dÃ¹ng scrapy vs splash Ä‘á»ƒ crawl, nhÆ°ng sau khi mÃ² máº«m tá»› tháº¥y trang nÃ y cÃ³ cung cáº¥p API nÃªn chÃºng ta chá»‰ cáº§n lÃ m Ä‘Æ¡n gá»‰an nháº¥t cÃ³ thá»ƒ thÃ´i, miá»…n sao cÃ³ data dÃ¹ng lÃ  Ä‘Æ°á»£c rá»“i, quan trá»ng gÃ¬. Code crawl nhÆ° nÃ¨ nha:
   
   ```python
   import urllib
import json
from pprint import pprint

import ssl
ssl._create_default_https_context = ssl._create_unverified_context

from tqdm import tqdm

import csv

area = 1 
count = 50

with open('liquor_data.csv', mode='w', encoding='utf-8') as csv_file:
    fieldnames = ['name', 'intl_name', 'brand_name', 'brand_intl_name', 'year_month', 'rank', 
                  'score', 'f1', 'f2', 'f3', 'f4', 'f5', 'f6',
                  'flavour_tags', 'checkin_count', 'pictures', 'similar_brands', 'id']
    writer = csv.DictWriter(csv_file, fieldnames=fieldnames, delimiter=',', 
                            quotechar='"', quoting=csv.QUOTE_MINIMAL)
    writer.writeheader()
    
    while area <= 47:
        url = 'https://sakenowa.com/api/v2/brands/ranking?areaId={}&count={}'.format(area, count)
        print(url)
        response = urllib.request.urlopen(url)
        text = response.read()
        data = json.loads(text)['ranking']

        for i in tqdm(range(len(data))):
            item = data[i]
            year_month = str(item['yearMonth'])
            score = float(item['score'])
            ranking = int(item['rank'])
            brand_summary = item['brandSummary']
            id_ = int(brand_summary['brand']['id'])
            name = str(brand_summary['brand']['name'])
            pictures = [str(i['url']) for i in brand_summary['pictures']]            
            checkin_count = int(brand_summary['statistics']['checkinCount'])
            similar_brands = [str(item['brand']['name']) for item in brand_summary['similarBrands']]
            
            intl_name = None
            if 'intlName' in brand_summary['brand'].keys():
                intl_name = str(brand_summary['brand']['intlName'])
            
            brand_area_name = None
            brand_area_intl_name = None
            if 'area' in brand_summary['brand']['brewery'].keys():
                brand_area = brand_summary['brand']['brewery']['area']
                brand_area_name = str(brand_area['name'])
                brand_area_intl_name = str(brand_area['intlName'])
                
            f1 = None
            f2 = None
            f3 = None
            f4 = None
            f5 = None
            f6 = None
            if 'simpleFlavorFeature' in brand_summary.keys():
                flavour_feature = brand_summary['simpleFlavorFeature']
                f1 = flavour_feature['f1']
                f2 = flavour_feature['f2']
                f3 = flavour_feature['f3']
                f4 = flavour_feature['f4']
                f5 = flavour_feature['f5']
                f6 = flavour_feature['f6']

            tags = ''
            flavour_tags = brand_summary['flavorTags']
            for tag_item in flavour_tags:
                tags += '|{}'.format(tag_item['tag'])

            writer.writerow({'name': name, 'intl_name': intl_name,
                             'brand_name': brand_area_name, 
                             'brand_intl_name': brand_area_intl_name,
                             'year_month': year_month, 'rank': ranking,
                             'score': score, 'f1': f1, 'f2':f2, 'f3': f3,
                             'f4':f4, 'f5': f5, 'f6': f6, 
                             'flavour_tags': tags, 'checkin_count': checkin_count,
                             'pictures': '|'.join(pictures),
                             'similar_brands': '|'.join(similar_brands),
                             'id': id_})

        area += 1
   ```
   
   á» Ä‘Ã¢y tá»› chá»‰ láº¥y nhá»¯ng fields mÃ  tá»› nghÄ© lÃ  cÃ³ Ã­ch cho bÃ i toÃ¡n cá»§a mÃ¬nh thui, báº¡n nÃ o muá»‘n dÃ¹ng thÃªm pháº§n nÃ o thÃ¬ thÃªm vÃ o code nha. CÃ¹ng xem qua xem dá»¯ liá»‡u cÃ³ gÃ¬ nÃ o.
   
![](https://images.viblo.asia/0ad1d7a7-1e8e-43a7-a71a-f78a67483049.png)

   Má»¥c tiÃªu cá»§a bÃ i toÃ¡n váº«n lÃ  gá»£i Ã½ ra nhá»¯ng sáº£n pháº©m giá»‘ng nhau nháº¥t cÃ³ thá»ƒ vá» mÃ¹i vá»‹, tá»› nháº­n tháº¥y tháº» tags cÃ³ liÃªn quan Ä‘áº¿n cÃ¡c chá»‰ sá»‘ mÃ¹i vá»‹ nÃªn pháº§n thuáº­t toÃ¡n cá»§a tá»› sáº½ xoay quanh 2 field chÃ­nh lÃ  f1-f6 vÃ  flavour_tags.
   
##  3.2 Dataset Exploration

Äá»‘i vá»›i nhá»¯ng bÃ i content-based kiá»ƒu nhÆ° tháº¿ nÃ y, viá»‡c hiá»ƒu dá»¯ liá»‡u lÃ  vÃ´ cÃ¹ng quan trá»ng, váº­y nÃªn chÃºng ta cáº§n cÃ³ 1 cÃ¡i nhÃ¬n tá»•ng quÃ¡t trÆ°á»›c Ä‘Ã£. HÃ£y xem áº£nh bÃªn dÆ°á»›i nhÃ©:

![](https://images.viblo.asia/2cb533dd-1fb6-4923-92f5-c1b566906ac7.png)

![](https://images.viblo.asia/9f3b0b6d-1a75-4d77-93c7-3f6908574bce.png)

ChÃºng ta cÃ³ khoáº£ng hÆ¡n 1k báº£n ghi, nhÆ°ng f1-f6 vÃ  flavour_tags láº¡i Ä‘ang bá»‹ null Ä‘áº¿n hÆ¡n 30%, cÃ¡ch giáº£i quyáº¿t sáº½ lÃ  nhÆ° tháº¿ nÃ o, náº¿u bá» qua táº¥t cáº£ nhá»¯ng báº£n ghi nÃ y thÃ¬ tháº­t sá»± sáº½ ráº¥t lÃ£ng phÃ­. Qua quÃ¡ trÃ¬nh quan sÃ¡t, tá»› nháº­n tháº¥y nhá»¯ng field nÃ o cÃ³ flavour_tags cÃ³ pháº§n giá»‘ng nhau sáº½ cÃ³ xu hÆ°á»›ng f1-f6 tÆ°Æ¡ng tá»± nhau, vÃ¬ váº­y cháº¯c cháº¯n chÃºng cÃ³ má»‘i quan há»‡ gÃ¬ rá»“i. ChÃºng ta sáº½ nÃ³i Ä‘áº¿n viá»‡c xá»­ lÃ½ vá»›i chá»— dá»¯ liá»‡u null nÃ y nhÆ° tháº¿ nÃ o á»Ÿ pháº§n tiáº¿p theo nhÃ©.

## 3.3 Data Cleaning

  TrÆ°á»›c khi apply thuáº­t toÃ¡n vÃ o, viá»‡c cáº§n lÃ m Ä‘Ã³ lÃ  pháº£i Ä‘i clean láº¡i Ä‘á»‘ng data nÃ y Ä‘Ã£. CÃ³ khÃ¡ nhiá»u viá»‡c cáº§n lÃ m Ä‘á»‘i vá»›i má»™t Ä‘á»‘ng dá»¯ liá»‡u text, tá»« viá»‡c tokenization, stemming, find synonyms, xá»­ lÃ½ duplicate, remove stopwords, filling missing data... Qua quÃ¡ trÃ¬nh tÃ¬m hiá»ƒu, tá»› tÃ¬m Ä‘Æ°á»£c má»™t sá»‘ tools khÃ¡ tá»‘t support cho viá»‡c xá»­ lÃ½ tiáº¿ng Nháº­t, cÃ³ thá»ƒ ká»ƒ Ä‘áº¿n nhÆ° ***Mecab, Ginza, Janome, JapaneseTokenizer hay PorterStemmer cá»§a NLTK***, vÃ  ***Scattertext*** Ä‘á»ƒ plot ra má»©c Ä‘á»™ frequency cá»§a cÃ¡c tá»«.
  
  VÃ¬ ná»™i dung bÃ i viáº¿t khÃ¡ dÃ i nÃªn tá»› sáº½ bá» qua 2 bÆ°á»›c lÃ  remove stopwords vÃ  xá»­ lÃ½ duplicate nha. Vá»›i bÆ°á»›c remove stopwords thÃ¬ trÃªn kaggle vÃ  github cÅ©ng Ä‘Ã£ public source nÃªn chÃºng ta cÃ³ thá»ƒ down vá» rá»“i thá»±c hiá»‡n vÃ²ng láº·p loáº¡i bá» Ä‘i thui, cÃ²n bÆ°á»›c xá»­ lÃ½ duplicate thÃ¬ tá»› sáº½ chá»n cÃ¡ch remove Ä‘i nhá»¯ng sáº£n pháº§m trÃ¹ng tÃªn vÃ¬ theo tá»› nghÄ© tÃªn brand cÃ³ thá»ƒ trÃ¹ng nhÆ°ng tÃªn sáº£n pháº§m thÃ¬ pháº£i khÃ¡c, cÃ¡i nÃ y thÃ¬ tuá»³ suy nghÄ© cá»§a tá»«ng cÃ¡ nhÃ¢n nha.
  
  Tiáº¿p Ä‘áº¿n, pháº§n viá»‡c tokenization lÃ  khÃ¡ quan trá»ng vÃ¬ nÃ³ lÃ  bÆ°á»›c Ä‘áº§u tiÃªn áº£nh hÆ°á»Ÿng khÃ¡ lá»›n Ä‘áº¿n cÃ¡c bÆ°á»›c sau, nhÆ°ng tá»› láº¡i cÅ©ng khÃ´ng cÃ³ kháº£ nÄƒng verify vÃ¬ k biáº¿t tiáº¿ng nháº­t, may máº¯n thay cÃ¡c tháº» tags nÃ y Ä‘Ã£ Ä‘Æ°á»£c extract sáºµn rá»“i nÃªn chÃºng ta cÅ©ng k cáº§n lÃ m gÃ¬ ná»¯a :D, trÆ°á»›c khi Ä‘áº¿n cÃ¡c bÆ°á»›c tiáº¿p theo tá»› sáº½ viáº¿t 1 hÃ m Ä‘á»ƒ láº¥y táº¥t cáº£ cÃ¡c tháº» tags, vÃ  Ä‘áº¿m sá»‘ lÆ°á»£ng xuáº¥t hiá»‡n cá»§a tá»«ng tháº» tags nÃ y trong toÃ n bá»™ dataset. CÃ¹ng xem áº£nh bÃªn dÆ°á»›i nhÃ©:
  
  ![](https://images.viblo.asia/201047a2-10fd-4f94-b3f3-6f968ed5e81d.png)
  
 Tá»« Ä‘Ã¢y tá»› sáº½ thá»±c hiá»‡n viá»‡c stemming (stemming lÃ  cÃ´ng viá»‡c Ä‘Æ°a 1 tá»« á»Ÿ cÃ¡c tráº¡ng thÃ¡i khÃ¡c nhau vá» tráº¡ng thÃ¡i ban Ä‘áº§u, vÃ­ dá»¥ nhÆ°: *caresses* => *caress*, *died* => *die* ...), cÃ¹ng xem phÆ°Æ¡ng trÃ¬nh sau:
 
 ![](https://images.viblo.asia/392bb19a-bd75-47ce-851d-5461799d78ab.png)

![](https://images.viblo.asia/8a92dd75-818a-4dbf-8ab9-4b2451d6c833.png)

Giáº£i thÃ­ch má»™t chÃºt, trÆ°á»›c khi thá»±c hiá»‡n viá»‡c thay tháº¿, t táº¡o ra 1 dict cÃ¡c tá»« Ä‘Æ°á»£c stemming vá» dáº¡ng chuáº©n, cÃ¡c tá»« nÃ y sáº½ Ä‘Ã³ng vai trÃ² lÃ  keys trong 1 dict vÃ  cÃ³ cÃ¡c values lÃ  danh sÃ¡ch cÃ¡c tá»« nÃ y trÆ°á»›c khi Ä‘Æ°á»£c chuyá»ƒn vá» dáº¡ng chuáº©n lÃ  tá»« Ä‘Ã³. Dá»… hiá»ƒu Ä‘Ãºng k nhá»‰, cÃ³ gÃ¬ cÃ¡c báº¡n cá»© comment bÃªn dÆ°á»›i cho tá»› nhÃ©. 

Pháº§n tiáº¿p theo chÃºng ta sáº½ lÃ m Ä‘Ã³ lÃ  tÃ¬m synonyms, á»Ÿ pháº§n nÃ y chÃºng ta cáº§n tÃ¬m hiá»ƒu Ä‘áº¿n khÃ¡i niá»‡m lemmatization vÃ  pos, chÃºng ta sáº½ cá»‘ gáº¯ng hiá»ƒu Ä‘Æ¡n giáº£n, Ä‘á»‘i vá»›i pos lÃ  viáº¿t táº¯t cá»§a part of speech cá»§a tá»«, má»—i tá»« sáº½ Ä‘Æ°á»£c categorized thÃ nh danh tá»«, tÃ­nh tá»«, Ä‘á»™ng tá»«, hay lÃ  phÃ³ tá»«, cÃ¡i nÃ y tuá»³ thuá»™c vÃ o cáº¥u trÃºc ngÃ´n ngá»¯ cá»§a má»—i quá»‘c gia, cÃ²n lemmatization lÃ  phÃ¢n tÃ­ch hÃ¬nh thÃ¡i tá»«, cá»¥ thá»ƒ hÆ¡n lÃ  trong tá»« Ä‘iá»ƒn cÃ¡c tá»« thÃ¬ cháº¯c cháº¯n sáº½ cÃ³ nhá»¯ng tá»« trong tuá»³ bá»‘i cáº£nh sáº½ cÃ³ cÃ¹ng nghÄ©a vá»›i nhau. Pháº§n viá»‡c nÃ y Ä‘á»‘i vá»›i cÃ¡c Ä‘oáº¡n vÄƒn báº£n mÃ´ táº£ sáº£n pháº©m lÃ  má»™t bÆ°á»›c ráº¥t quan trá»ng Ä‘á»ƒ tÃ¬m ra Ä‘Æ°á»£c nhá»¯ng sáº£n pháº©m sÃ¡t nghÄ©a nháº¥t. Äá»ƒ hiá»ƒu hÆ¡n, cÃ¹ng xem báº£ng dÆ°á»›i nÃ y nhÃ©:

![](https://images.viblo.asia/765900da-5351-4519-88b3-cae0433b8834.png)

Pháº§n code cho pháº§n thay tháº¿ lemma nÃ y t xin phÃ©p bá» qua nhÃ©, á»Ÿ pháº§n nÃ y cÃ¡c báº¡n cÃ³ thá»ƒ dÃ¹ng ***Ginza*** , má»i ngÆ°á»i Ä‘á»c thÃªm á»Ÿ [Ä‘Ã¢y](https://github.com/megagonlabs/ginza) nha.

Pháº§n cuá»‘i cÃ¹ng cá»§a pháº§n data preprocessing nÃ y, tá»› muá»‘n Ä‘á» cáº­p lÃ  missing data filling. NhÆ° Ä‘Ã£ Ä‘á» cáº­p pháº§n nÃ y tá»« trÆ°á»›c,  cÃ³ Ä‘áº¿n hÆ¡n 30% lÃ  giÃ¡ trá»‹ null cá»§a f1-f6 hoáº·c flavour_tags hoáº·c lÃ  cáº£ 2, náº¿u khÃ´ng táº­n dá»¥ng thÃ¬ sáº½ ráº¥t phÃ­. Qua quan sÃ¡t tá»› nháº­n ra nhá»¯ng sáº£n pháº©m cÃ³ pháº§n giá»‘ng nhau vá» tags sáº½ cÃ³ cÃ¡c dáº£i giÃ¡ trá»‹ f1-f6 khÃ¡ tÆ°Æ¡ng tá»± nhau, nÃªn t quyáº¿t Ä‘á»‹nh query ra nhá»¯ng sáº£n pháº©m cÃ³ flavour_tags nhÆ°ng bá»‹ null f1-f6, láº·p tá»«ng sáº£n pháº©m nÃ y vÃ  láº¥y ra nhá»¯ng sáº£n pháº©m cÃ³ flavour_tags giá»‘ng > 50% vá»›i flavour_tags cá»§a sáº£n pháº©m nÃ y, gom nhÃ³m láº¡i rá»“i láº¥y mean tá»«ng giÃ¡ trá»‹ f1-f6. HÃ£y xem Ä‘oáº¡n code sau nhÃ©:

![](https://images.viblo.asia/57ce6d79-1110-4881-b720-ef21b6e512d1.png)

CÃ³ má»™t cÃ¡i hay ho á»Ÿ Ä‘Ã¢y lÃ  tá»› dÃ¹ng fuzz wuzzy Ä‘á»ƒ check Ä‘á»™ tÆ°Æ¡ng Ä‘á»“ng cÃ¡c chuá»—i string. ÄÃ¢y lÃ  1 package ráº¥t hay má»i ngá»«oi cÃ³ thá»ƒ tÃ¬m hiá»ƒu vá» nÃ³ nhÃ©. 

Tiáº¿p Ä‘áº¿n cÃ³ 2 case cáº§n quan tÃ¢m lÃ  nhá»¯ng báº£n ghi null cáº£ flavour_tags vÃ  f1-f6, case nÃ y tá»› bá» luÃ´n vÃ¬ khÃ´ng cÃ³ má»™t má»‘i liÃªn há»‡ nÃ o cáº£. TrÆ°á»ng há»£p f1-f6 cÃ³ data nhÆ°ng flavour_tags null thÃ¬ sao, chÃºng ta pháº£i check thá»­ má»›i biáº¿t Ä‘Æ°á»£c

![](https://images.viblo.asia/fe132b9c-18e5-451d-92b4-fa77e235d115.png)

á» Ä‘Ã¢y chá»‰ cÃ³ 3 items, nÃªn tá»› cÅ©ng quyáº¿t Ä‘á»‹nh bá» qua luÃ´n. BÃ¢y giá» chÃºng ta sáº½ Ä‘áº¿n pháº§n thuáº­t toÃ¡n nhÃ©. 

# IV. Implement Algorithm
TrÆ°á»›c khi Ä‘i vÃ o chi tiáº¿t, tá»› muá»‘n nÃ³i tÃ³m táº¯t qua má»™t chÃºt vá» cÃ¡ch tá»› sáº½ thá»±c hiá»‡n. Thuáº­t toÃ¡n mÃ  t thá»±c hiá»‡n sáº½ Ä‘Æ°á»£c chia lÃ m 2 bÆ°á»›c:

> BÆ°á»›c 1: Similarity based on tags: TÃ¬m ra TOP N nhá»¯ng sáº£n pháº©m giá»‘ng nhau nháº¥t vá» tags báº±ng viá»‡c build 1 matrix cÃ³ dáº¡ng nhÆ° sau:

| Liquor | Tag_1 | Tag_2 | Tag_3 | Tag_k |Tag_k+1 | Tag_m |
| -------- | -------- | -------- |-------- | -------- | -------- |-------- | -------- |
|  liquor_1     | a11     | a12     |     |      |     | a1m     |
| ...     |      |      |     |      |     |      |
| liquor_j     | aj1     | aj2    |     | ajk     |     |ajm     |
| ...     |      |      |     |      |     |      |
| liquor_n     | an1     | an2     |    |      |     | anm     |

á» matrix nÃ y, há»‡ sá»‘ ajk sáº½ cÃ³ giÃ¡ trá»‹ 0 hoáº·c 1 phá»¥ thuá»™c vÃ o giÃ¡ trá»‹ á»Ÿ column k vÃ  content flavour_tags á»Ÿ cá»™t j. VÃ­ dá»¥: náº¿u tag_k trong flavour_tags cá»§a liquor_j thÃ¬ ajk = 1, ngÆ°á»£c láº¡i = 0. Khi xÃ¢y dá»±ng xong matrix ta tÃ­nh khoáº£ng cÃ¡ch giá»¯a cÃ¡c vector theo cÃ´ng thá»©c:

![](https://images.viblo.asia/d7bb92fa-2a05-405c-a181-2f5ce287cdcd.png)

Sá»­ dá»¥ng cÃ´ng thá»©c nÃ y chÃºng ta cÃ³ thá»ƒ chá»n ra Top N cÃ¡c liquor cÃ³ Ä‘á»™ similarity lá»›n nháº¥t vá» tags. CÃ¡ch lÃ m nÃ y cÃ²n cÃ³ 1 tÃªn gá»i khÃ¡c lÃ  bag_of_word. Giá» cÃ¹ng xem code nhÃ©:

![](https://images.viblo.asia/4318d692-7743-43dd-a83b-a61f3d76a526.png)

![](https://images.viblo.asia/05d3d810-53a6-4465-9b1b-bceec9a77c9a.png)

á» Ä‘oáº¡n code trÃªn Ä‘Ã¢y, t append thÃªm vÃ o Dataframe input má»™t matrix chá»‰ bao gá»“m 1 trong 2 giÃ¡ trá»‹ lÃ  0 hoáº·c 1, sau Ä‘Ã³ tá»› Ä‘Æ°a matrix nÃ y nhÆ° lÃ  1 táº­p data Ä‘Æ°a vÃ o KNN Ä‘á»ƒ train, má»¥c Ä‘Ã­ch dÃ¹ng KNN lÃ  Ä‘á»ƒ tÃ¬m ra top N cÃ¡c vector giá»‘ng nháº¥t vá»›i vector Ä‘áº§u vÃ o.

> BÆ°á»›c 2: Similarity based on f1-f6 and other criteria: Láº¥y ra TOP 5 sáº£n pháº§m cuá»‘i cÃ¹ng dá»±a vÃ o f1-f6 vÃ  1 sá»‘ chá»‰ sá»‘ khÃ¡c.

Sau khi cÃ³ Ä‘Æ°á»£c Top N cÃ¡c pháº§n tá»­ giá»‘ng nhau, nhiá»‡m vá»¥ tiáº¿p theo cá»§a chÃºng ta cáº§n lÃ m lÃ  chá»n ra 5 pháº§n tá»­ cÃ³ chá»‰ sá»‘ f1-f6 gáº§n giá»‘ng vá»›i liquor entry nháº¥t. NÃ³i Ä‘áº¿n Ä‘Ã¢y cÃ¡ch Ä‘Æ¡n giáº£n nháº¥t mÃ  má»i ngÆ°á»i thÆ°á»ng nghÄ© ngay Ä‘áº¿n lÃ  so sÃ¡nh khoáº£ng cÃ¡ch vector giá»¯a cÃ¡c pháº§n tá»­ nÃ y, tuy nhiÃªn Ä‘Ã³ khÃ´ng pháº£i lÃ  1 Ã½ tÆ°á»Ÿng hay, táº¡i vÃ¬ sao. CÃ³ nhá»¯ng káº¿t quáº£ Ä‘Æ°á»£c tráº£ vá» báº±ng nhau giá»¯a tá»•ng bÃ¬nh phÆ°Æ¡ng hiá»‡u cÃ¡c pháº§n tá»­ cá»§a 2 vecto nhÆ°ng vÃ¬ nÃ³ cÃ³ sá»± bÃ¹ trá»« giá»¯a cÃ¡c chá»‰ sá»‘ => cÃ³ nhá»¯ng pháº§n tá»­ bá»‹ sai lá»‡ch quÃ¡ nhiá»u vá» 1 hoáº·c 2 chá»‰ sá»‘ trong f1- f6 => cÃ¡ch há»£p lÃ½ hÆ¡n cáº£ lÃ  dÃ¹ng 1 cÃ´ng thá»©c tÃ­nh weight Ä‘á»ƒ so sÃ¡nh vá» má»©c Ä‘á»™ tÆ°Æ¡ng Ä‘á»“ng giá»¯a cÃ¡c chá»‰ sá»‘ f1 - f6.

ChÃºng ta cÃ³ cÃ´ng thá»©c sau:

          score = ğœ™ğœ1,ğ‘1 + ğœ™ğœ2,ğ‘2 + (ğœ™ğœ1,ğ‘3 + ğœ™ğœ2,ğ‘4 + ... + ğœ™ğœn,ğ‘n) x alpha
                        
   Trong Ä‘Ã³ ğœ™ğœi,ğ‘i lÃ  cÃ´ng thá»©c guassian filter cho tá»«ng chá»‰ sá»‘ f1-f6 vÃ  cÃ¡c thuá»™c tÃ­nh khÃ¡c, alpha lÃ  má»™t hyper params
                        
   CÃ´ng thá»©c tÃ­nh gaussian filter:
                        
![](https://images.viblo.asia/9e5969bb-bc62-4699-b6d5-b5c3e09dcecf.png)

Vá»›i cÃ´ng thá»©c nÃ y thÃ¬ má»i ngÆ°á»i cÃ³ thá»ƒ tuá»³ biáº¿n vÃ  khÃ´ng nháº¥t thiáº¿t pháº£i giá»‘ng há»‡t nhÆ° cá»§a mÃ¬nh, miá»…n sao cÃ¡c chá»‰ sá»‘ pháº£n Ã¡nh Ä‘Æ°á»£c Ä‘á»™ quan trá»ng cá»§a tá»«ng thuá»™c tÃ­nh vÃ  cÃ´ng thá»©c pháº£n Ã¡nh Ä‘Æ°á»£c má»©c Ä‘á»™ liÃªn káº¿t giá»¯a cÃ¡c thuá»™c tÃ­nh vá»›i nhau. BÃ¢y giá» cÃ¹ng Ä‘i chi tiáº¿t hÆ¡n vÃ o code:

![](https://images.viblo.asia/0a4f4982-9915-49f0-969b-20e0b3703e3d.png)

Function nÃ y cÃ³ nhiá»‡m vá»¥ Ä‘Ã¡nh mark cho 1 liquor

![](https://images.viblo.asia/2b262777-097b-48b8-88bc-fa10be1c03be.png)

Function tráº£ vá» danh sÃ¡ch Ä‘Ã£ Ä‘Æ°á»£c sort cá»§a cÃ¡c similarities

![](https://images.viblo.asia/da4cc643-fa53-4cbb-b6e6-0e42bab58555.png)

Function láº¥y ra top 5 sáº£n pháº©m giá»‘ng nháº¥t

![](https://images.viblo.asia/844f7bff-218a-4d81-86eb-401e7663c9be.png)

![](https://images.viblo.asia/a02abd31-ca1b-4195-a589-8173f318ab2a.png)

Äoáº¡n code bÃªn trÃªn mÃ´ táº£ khÃ¡ rÃµ cÃ¡c bÆ°á»›c Ä‘á»ƒ tÃ¬m ra similarities cá»§a entry truyá»n vÃ o sau khi cÃ³ Ä‘Æ°á»£c TOP N similarities tá»« bÆ°á»›c 1, á»Ÿ Ä‘Ã¢y ngoÃ i cÃ¡c chá»‰ sá»‘ f1-f6 tá»› cÃ³ dÃ¹ng thÃªm cÃ¡c thuá»™c tÃ­nh nhÆ° lÃ  sá»‘ lÆ°á»£ng checkin, nÄƒm sáº£n xuáº¥t...Náº¿u cÃ³ tháº¯c máº¯c gÃ¬ cÃ¡c báº¡n cá»© comment cho mÃ¬nh bÃªn dÆ°á»›i hoáº·c mail cho mÃ¬nh nguyen.van.dat@sun-asterisk.com nhÃ©.

BÃ¢y giá» chÃºng ta cáº§n visualize káº¿t quáº£ má»™t chÃºt:

![](https://images.viblo.asia/bc352b93-a5b7-469b-bae6-58b22ecd0755.png)

CÃ³ thá»ƒ tháº¥y káº¿t quáº£ khÃ¡ á»•n, tuy nhiÃªn tá»› chÆ°a thá»±c sá»± hÃ i lÃ²ng vá» káº¿t quáº£ nÃ y vÃ  tá»› muá»‘n nÃ³ tá»‘t hÆ¡n ná»¯a, thÃ¬ cÃ¡ch lÃ m tháº¿ nÃ o Ä‘á»ƒ tá»‘t hÆ¡n, tá»› sáº½ nÃ³i á»Ÿ pháº§n tiáº¿p theo Ä‘Ã¢y.

# V. Improvement and Future work

Thuáº­t toÃ¡n bÃªn trÃªn Ä‘á»ƒ thu Ä‘Æ°á»£c káº¿t quáº£ tá»‘t hÆ¡n, chÃºng ta cáº§n thá»­ vÃ  thay Ä‘á»•i nhiá»u cÃ¡c thuá»™c tÃ­nh hÆ¡n ná»¯a + tÃ¬m ra cÃ¡c hyperparams Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c káº¿t quáº£ tá»‘i Æ°u nháº¥t. Tuy nhiÃªn nhÆ°á»£c Ä‘iá»ƒm tá»› tháº¥y cÃ²n á»Ÿ Ä‘Ã¢y lÃ  thá»i gian tÃ­nh toÃ¡n chÆ°a thá»±c sá»± nhanh, vÃ  cÃ³ sá»± phá»¥ thuá»™c giá»¯a cÃ¡c bÆ°á»›c nÃªn káº¿t quáº£ á»Ÿ bÆ°á»›c sau áº£nh hÆ°á»Ÿng ráº¥t nhiá»u tá»« bÆ°á»›c trÆ°á»›c. Náº¿u dá»¯ liá»‡u tags tá»« ngÆ°á»i dÃ¹ng lÃ  sai thÃ¬ káº¿t quáº£ phÃ­a sau cÅ©ng sáº½ khÃ´ng thá»ƒ Ä‘Ãºng Ä‘Æ°á»£c.

ChÃºng ta cÃ³ thá»ƒ thá»­ má»™t cÃ¡ch khÃ¡c lÃ  tÃ¬m similarities dá»±a trÃªn 1 cÃ´ng thá»©c cÃ³ trá»ng sá»‘ cho tags vÃ  f1-f6 vÃ  cÃ¡c chá»‰ sá»‘ khÃ¡c, trá»ng sá»‘ nÃ o quan trá»ng hÆ¡n sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh cao hÆ¡n vÃ  ngÆ°á»£c láº¡i. Hiá»‡n táº¡i tá»› Ä‘Ã£ thá»­ vá»›i cÃ¡ch nÃ y vÃ  thu Ä‘Æ°á»£c káº¿t quáº£ khÃ¡ hÃ i lÃ²ng, tuy nhiÃªn tá»› cáº§n cáº£i thiá»‡n thÃªm nÃªn náº¿u cÃ³ time tá»› sáº½ chia sáº» vá»›i má»i ngÆ°á»i sau.

# VI. Model Management and Deploy to Production

CÃ³ láº½ pháº§n nÃ y má»©c Ä‘á»™ quan trá»ng cÅ©ng khÃ´ng kÃ©m gÃ¬ bÆ°á»›c xÃ¢y dá»±ng thuáº­t toÃ¡n nÃªn mÃ¬nh sáº½ dÃ nh 1 bÃ i Ä‘á»ƒ nÃ³i vá» viá»‡c quáº£n lÃ½ model vÃ  lÃ m sao Ä‘á»ƒ deploy lÃªn production nhÃ©. CÃ³ thuáº­t toÃ¡n mÃ  khÃ´ng cÃ³ server vÃ  cÃ¡ch quáº£n lÃ½ server deployment sao cho hiá»‡u quáº£ thÃ¬ khi Ä‘áº¿n vá»›i ngÆ°á»i dÃ¹ng há»‡ thá»‘ng cÅ©ng khÃ´ng thá»ƒ cháº¡y á»•n Ä‘á»‹nh Ä‘Æ°á»£c.  Cáº£m Æ¡n má»i ngÆ°á»i Ä‘Ã£ Ä‘á»c Ä‘áº¿n Ä‘Ã¢y, cÃ³ váº¥n Ä‘á» gÃ¬ thÃ¬ cá»© comment bÃªn dÆ°á»›i cho tá»› biáº¿t nhÃ©.

# VII. References

https://sakenowa.com/flavor-search

https://machinelearningcoban.com/2017/05/17/contentbasedrecommendersys/

https://scikit-learn.org/stable/modules/neighbors.html

https://pandas.pydata.org/

https://github.com/megagonlabs/ginza

https://www.researchgate.net/publication/335337209_Preprocessing_Methods_and_Tools_in_Modelling_Japanese_for_Text_Classification

http://nlp.ist.i.kyoto-u.ac.jp/EN/index.php?NLPresources

https://www.jaist.ac.jp/project/NLP_Portal/doc/LR/lr-cat-e.html

https://pypi.org/project/mecab-python3/

https://www.researchgate.net/publication/226098747_Content-based_Recommender_Systems_State_of_the_Art_and_Trends

https://github.com/mocobeta/janome

http://www.phontron.com/nlptools.php