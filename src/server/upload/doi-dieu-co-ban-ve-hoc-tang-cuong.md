# 1. Giá»›i thiá»‡u

áº®t háº³n cÃ¡c báº¡n Ä‘ang Ä‘á»c Ä‘Ã£ tá»«ng biáº¿t Ä‘áº¿n Ã­t nháº¥t má»™t mÃ´n cá» (cá» caro, cá» vua, cá» tÆ°á»›ng, cá» vÃ¢y, ...). Má»—i má»™t mÃ´n cá» cÃ³ nhá»¯ng luáº­t chÆ¡i, chiáº¿n thuáº­t vÃ  khÃ´ng gian cÃ¡c nÆ°á»›c Ä‘i khÃ¡c nhau, nhÆ° sá»‘ nÆ°á»›c Ä‘i há»£p lá»‡ trong cá» vua lÃ  $10^{120}$ vá»›i trung bÃ¬nh 30 Ä‘áº¿n 40 nÆ°á»›c Ä‘i má»—i vÃ¡n cá» ([CLAUDE E. SHANNON - Programming a Computer for Playing Chess](https://vision.unipv.it/IA1/ProgrammingaComputerforPlayingChess.pdf)), sá»‘ lÆ°á»£ng vá»‹ trÃ­ nÆ°á»›c Ä‘i há»£p lá»‡ trÃªn bÃ n cá» trong cá» vÃ¢y Ä‘Æ°á»£c Æ°á»›c tÃ­nh lÃ  $2.10^{170}$ ([Wikipedia](https://vi.wikipedia.org/wiki/C%E1%BB%9D_v%C3%A2y)). Náº¿u báº¡n tháº¥y nÃ³ váº«n cÃ²n Ã­t thÃ¬ hÃ£y nhá»› ráº±ng sá»‘ lÆ°á»£ng nguyÃªn tá»­ trong vÅ© trá»¥ chá»‰ khoáº£ng $10^{78}$ Ä‘áº¿n $10^{82}$ nguyÃªn tá»­ ([Universe today](https://www.universetoday.com/36302/atoms-in-the-universe/)). Náº¿u báº¡n váº«n chÆ°a hÃ¬nh dung ra nÃ³ nhiá»u nhÆ° tháº¿ nÃ o ğŸ˜‘ thÃ¬ hÃ£y cá»© xem ráº±ng nÃ³ ráº¥t ráº¥t lá»›n Ä‘áº¿n má»©c cÃ¡c siÃªu mÃ¡y tÃ­nh máº¡nh nháº¥t hiá»‡n nay cÅ©ng khÃ´ng thá»ƒ tÃ­nh toÃ¡n háº¿t sá»‘ lÆ°á»£ng cÃ¡c nÆ°á»›c cá» cÃ³ thá»ƒ xáº£y ra Ä‘á»ƒ tÃ¬m ra má»™t nÆ°á»›c Ä‘i tá»‘i Æ°u trong thá»i gian má»™t Ä‘á»i ngÆ°á»i.

Vá»›i sá»‘ lÆ°á»£ng nÆ°á»›c Ä‘i lá»›n nhÆ° váº­y, cÃ¡c thuáº­t toÃ¡n trong cÃ¡c chÆ°Æ¡ng trÃ¬nh mÃ¡y tÃ­nh chÆ¡i cá» hiá»‡n nay má»›i chá»‰ xÃ©t Ä‘Æ°á»£c má»™t sá»‘ lÆ°á»£ng ráº¥t nhá» khÃ´ng gian cÃ¡c bÆ°á»›c Ä‘i. Do Ä‘Ã³ cÃ¡c pháº§n má»m nÃ y chÆ°a tháº¯ng Ä‘Æ°á»£c cÃ¡c Ä‘áº¡i kiá»‡n tÆ°á»›ng,  nhá»¯ng cá» thá»§ chuyÃªn nghiá»‡p, cho Ä‘áº¿n khi AlphaGo ra Ä‘á»i. Theo mÃ´ táº£ trÃªn [trang chá»§](https://www.deepmind.com/research/highlighted-research/alphago), Ä‘Ã¢y lÃ  pháº§n má»m mÃ¡y tÃ­nh Ä‘áº§u tiÃªn Ä‘Ã¡nh báº¡i má»™t ngÆ°á»i chÆ¡i cá» vÃ¢y chuyÃªn nghiá»‡p. Äiá»u Ä‘áº·c biá»‡t lÃ m cho AlphaGo trá»Ÿ nÃªn máº¡nh máº½ nhÆ° váº­y má»™t pháº§n lÃ  do sá»± phÃ¡t triá»ƒn cá»§a trÃ­ tuá»‡ nhÃ¢n táº¡o, vÃ  má»™t nhÃ¡nh trong Ä‘Ã³ lÃ  **Há»c tÄƒng cÆ°á»ng (Reinforcement learning)**. AlphaGo Ä‘Ã£ tá»± chÆ¡i vá»›i chÃ­nh nÃ³ vÃ  cáº£i thiá»‡n dáº§n dáº§n cÃ¡c **máº¡ng neural** Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘Ã¡nh giÃ¡ bÃ n cá», Ä‘Æ°a ra chiáº¿n lÆ°á»£c vÃ  quyáº¿t Ä‘á»‹nh cÃ¡c nÆ°á»›c Ä‘i.

Trong bÃ i viáº¿t nÃ y mÃ¬nh sáº½ trÃ¬nh bÃ y má»™t sá»‘ **khÃ¡i niá»‡m cÆ¡ báº£n** cá»§a **há»c tÄƒng cÆ°á»ng**.  BÃ i viáº¿t nÃ y náº±m trong series mÃ  mÃ¬nh Ä‘Ã£ lÃªn káº¿ hoáº¡ch viáº¿t trong quÃ¡ trÃ¬nh tÃ¬m hiá»ƒu vá» há»c tÄƒng cÆ°á»ng, nháº±m má»¥c Ä‘Ã­ch tá»•ng há»£p láº¡i nhá»¯ng Ä‘iá»u mÃ¬nh há»c vÃ  chia sáº» kiáº¿n thá»©c. Do Ä‘Ã³, mÃ¬nh sáº½ khÃ´ng thá»ƒ trÃ¡nh khá»i nhá»¯ng thiáº¿u sÃ³t, ráº¥t mong nháº­n Ä‘Æ°á»£c sá»± gÃ³p Ã½ cá»§a cÃ¡c báº¡n. 

# 2. Tá»•ng quan

### 2.1 Má»™t sá»‘ Ä‘á»‹nh nghÄ©a

**Há»c tÄƒng cÆ°á»ng (Reinforcement learning - RL)** lÃ  má»™t nhÃ¡nh cá»§a **há»c mÃ¡y (Machine learning - ML)**, nghiÃªn cá»©u cÃ¡ch thá»©c má»™t ***tÃ¡c nhÃ¢n (Agent)*** trong má»™t ***mÃ´i trÆ°á»ng (Environment)*** Ä‘ang á»Ÿ má»™t ***tráº¡ng thÃ¡i (State)*** thá»±c hiá»‡n má»™t ***hÃ nh Ä‘á»™ng (Action)***  Ä‘á»ƒ tá»‘i Æ°u hÃ³a má»™t ***pháº§n thÆ°á»Ÿng (Reward)*** chung.

Má»™t bÃ i toÃ¡n há»c tÄƒng cÆ°á»ng thÆ°á»ng Ä‘Æ°á»£c mÃ´ hÃ¬nh dÆ°á»›i dáº¡ng má»™t *qui trÃ¬nh Ä‘Æ°a ra quyáº¿t Ä‘á»‹nh Markov* (cÃ¡i nÃ y mÃ¬nh khÃ´ng biáº¿t dÃ¹ng tá»« gÃ¬, tiáº¿ng anh cá»§a nÃ³ lÃ  **Markov decision process - MDP**). **MDP** váº«n Ä‘Æ°á»£c coi lÃ  tiÃªu chuáº©n Ä‘á»ƒ mÃ´ hÃ¬nh hÃ³a cÃ¡c bÃ i toÃ¡n há»c tÄƒng cÆ°á»ng. NgoÃ i ra cÃ¡c thuáº­t toÃ¡n cá»§a há»c tÄƒng cÆ°á»ng cÅ©ng liÃªn quan nhiá»u Ä‘áº¿n ká»¹ thuáº­t *quy hoáº¡ch Ä‘á»™ng*.

Äá»ƒ Ä‘Æ¡n giáº£n hÆ¡n, ta xÃ©t Ä‘áº¿n bÃ i toÃ¡n nhÆ° sau: á» táº¡i thá»i Ä‘iá»ƒm $t$, tÃ¡c nhÃ¢n $\mathcal{A}$ cÃ³ tráº¡ng thÃ¡i lÃ  $s_{t} \in \mathcal{S}$ (táº­p cÃ¡c tráº¡ng thÃ¡i cÃ³ thá»ƒ cÃ³ cá»§a tÃ¡c nhÃ¢n trong mÃ´i trÆ°á»ng),  thá»±c hiá»‡n hÃ nh Ä‘á»™ng $a \in \mathcal{A}$ (táº­p cÃ¡c hÃ nh Ä‘á»™ng cá»§a tÃ¡c nhÃ¢n) vÃ  cÃ³ má»™t xÃ¡c suáº¥t $P_{sa}(s_{t+1})$ chuyá»ƒn Ä‘áº¿n tráº¡ng thÃ¡i tiáº¿p theo $s_{t+1}$ vÃ  nháº­n Ä‘Æ°á»£c má»™t pháº§n thÆ°á»Ÿng tá»©c thá»i $r_{t}$. $P_{sa}$ lÃ  má»™t phÃ¢n phá»‘i biá»ƒu diá»…n tráº¡ng thÃ¡i tiáº¿p theo cá»§a tÃ¡c nhÃ¢n khi thá»±c hiá»‡n hÃ nh Ä‘á»™ng $a \in \mathcal{A}$ táº¡i tráº¡ng thÃ¡i $s \in \mathcal{S}$. Má»¥c tiÃªu cá»§a bÃ i toÃ¡n lÃ  tá»‘i Ä‘a pháº§n thÆ°á»Ÿng (lá»£i tá»©c) chung $\mathcal{R}$.

XÃ©t má»™t vÃ­ dá»¥ Ä‘Æ¡n giáº£n, game ráº¯n sÄƒn má»“i nhÆ° hÃ¬nh bÃªn dÆ°á»›i:
![image.png](https://images.viblo.asia/cfd450b3-25da-4e3e-80bd-edf5868be409.png)

TÃ¡c nhÃ¢n á»Ÿ Ä‘Ã¢y chÃ­nh lÃ  con ráº¯n. Tráº¡ng thÃ¡i hiá»‡n táº¡i $s$ bao gá»“m: *tá»a Ä‘á»™ cá»§a Ä‘áº§u vÃ  cÃ¡c pháº§n thÃ¢n ráº¯n, hÆ°á»›ng di chuyá»ƒn ráº¯n, tá»a Ä‘á»™ cá»§a má»“i*. CÃ¡c hÃ nh Ä‘á»™ng cÃ³ thá»ƒ thá»±c hiá»‡n $\mathcal{A} =\{ left, forward, right \}$ tÆ°Æ¡ng á»©ng vá»›i sang trÃ¡i, Ä‘i tháº³ng, sang pháº£i. Vá»›i má»—i hÃ nh Ä‘á»™ng Ä‘Ã³, khi thá»±c hiá»‡n sáº½ Ä‘Æ°a con ráº¯n vÃ o tráº¡ng thÃ¡i má»›i vÃ  tráº£ vá» cÃ¡c pháº§n thÆ°á»Ÿng tá»©c thá»i: 

* Náº¿u sang trÃ¡i, Äƒn Ä‘Æ°á»£c má»“i, nháº­n Ä‘Æ°á»£c 1 Ä‘iá»ƒm, $r = 1$.
* Náº¿u Ä‘i tháº³ng, cáº¯n vÃ o thÃ¢n, trÃ² chÆ¡i káº¿t thÃºc, $r = -1$.
* Náº¿u sang pháº£i, khÃ´ng Äƒn Ä‘Æ°á»£c má»“i nhÆ°ng cÅ©ng khÃ´ng cáº¯n vÃ o Ä‘uÃ´i, $r = 0$.

### 2.2 HÃ m giÃ¡ trá»‹

Pháº§n thÆ°á»Ÿng chung $\mathcal{R}$ lÃ  sá»‘ má»“i Äƒn Ä‘Æ°á»£c, nhÃ¬n sÆ¡ qua 3 trÆ°á»ng há»£p trÃªn, náº¿u chá»‰ xÃ©t Ä‘áº¿n pháº§n thÆ°á»Ÿng tá»©c thá»i lá»›n nháº¥t lÃ  1 vÃ  thá»±c hiá»‡n sang trÃ¡i, con ráº¯n sáº½ bá»‹ rÆ¡i vÃ o tráº¡ng thÃ¡i khÃ´ng thá»ƒ thoÃ¡t ra Ä‘Æ°á»£c vÃ  báº¥t ká»³ hÃ nh Ä‘á»™ng nÃ o cÅ©ng sáº½ dáº«n Ä‘áº¿n háº¿t game, cÃ¡ch tá»‘t nháº¥t lÃ  Ä‘i sang pháº£i vÃ  quay láº¡i Äƒn sau. NhÆ° váº­y xÃ©t Ä‘áº¿n pháº§n thÆ°á»Ÿng tá»©c thá»i lÃ  chÆ°a Ä‘á»§, ta cáº§n xÃ©t Ä‘áº¿n cÃ¡c tráº¡ng thÃ¡i tiáº¿p theo vÃ  cÃ¡c pháº§n thÆ°á»Ÿng cÃ³ thá»ƒ Ä‘áº¡t Ä‘Æ°á»£c cá»§a cÃ¡c tráº¡ng thÃ¡i Ä‘Ã³ ná»¯a. Ta cÃ³ hÃ m lá»£i tá»©c:
$$
G _ { t } = \sum _ { i = 0 } ^ { \infty }R _ { t + i } = R _ { t } + R _ { t + 1 } + R _ { t +2 } + \cdots
$$

VÃ¬ khÃ´ng thá»ƒ biáº¿t trÆ°á»›c sá»‘ bÆ°á»›c thá»±c hiá»‡n trong tÆ°Æ¡ng lai, cÃ³ thá»ƒ cÃ³ vÃ´ sá»‘ bÆ°á»›c, nÃªn chuá»—i $G_{t}$ khÃ´ng há»™i tá»¥ (convergence) Ä‘Æ°á»£c, do Ä‘Ã³ má»™t há»‡ sá»‘ chiáº¿t kháº¥u Ä‘Æ°á»£c thÃªm vÃ o Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh há»™i tá»¥, vÃ  lÃºc nÃ y gá»i $G_{t}$ lÃ   **lá»£i tá»©c chiáº¿t kháº¥u**:
$$
G _ { t } = \sum _ { i = 0 } ^ { \infty } \gamma ^ { i } R _ { t + i } = R _ { t } + \gamma R _ { t + 1 } + \gamma^2 R_{t+2} \ldots + \gamma ^ { n } R _ { t + n } + \ldots
$$
ChÃºng ta Ä‘ang xÃ©t Ä‘áº¿n tÃ¡c nhÃ¢n vÃ  tráº¡ng thÃ¡i cá»§a nÃ³, nÃªn Ä‘á»ƒ dá»… hÃ¬nh dung hÆ¡n, ta chuyá»ƒn cÃ¡c má»‘c thá»i gian thÃ nh cÃ¡c tráº¡ng thÃ¡i táº¡i thá»i Ä‘iá»ƒm tÆ°Æ¡ng á»©ng (giáº£ sá»­ táº¡i thá»i Ä‘iá»ƒm $t$ tÃ¡c nhÃ¢n Ä‘ang á»Ÿ tráº¡ng thÃ¡i $s_0$, cÃ¡c tráº¡ng thÃ¡i tiáº¿p theo lÃ  $s_1, s_2, s_3, \ldots$:
$$
G _ { t } = \sum _ { i = 0 } ^ { \infty } \gamma ^ { i } R \left (s_i \right ) = R \left (s_0 \right ) + \gamma R \left (s_1 \right ) + \gamma^2 R \left (s_2 \right ) \ldots + \gamma ^ { n } R \left (s_n \right ) + \ldots
$$


Vá»›i $\gamma$ lÃ  *há»‡ sá»‘ chiáº¿t kháº¥u* vÃ  $0 \leq \gamma \leq 1$. Vá»›i $\gamma = 0$ lÃ  trÆ°á»ng há»£p chá»‰ xÃ©t Ä‘áº¿n pháº§n thÆ°á»Ÿng tá»©c thá»i, cÃ²n $\gamma = 1$ lÃ  xÃ©t Ä‘áº¿n lá»£i tá»©c trong táº¥t cáº£ cÃ¡c tráº¡ng thÃ¡i tiáº¿p theo. Tuy nhiÃªn viá»‡c tÃ­nh toÃ¡n $R_{t}$ khÃ´ng há» Ä‘Æ¡n giáº£n, vÃ¬ cÃ¡c bÆ°á»›c Ä‘i tiáº¿p theo vÃ  cÃ¡c tráº¡ng thÃ¡i tÆ°Æ¡ng á»©ng lÃ  chÆ°a biáº¿t trÆ°á»›c, do Ä‘Ã³ má»™t hÃ m **giÃ¡ trá»‹ tráº¡ng thÃ¡i (V-funtion)** Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Æ°á»›c tÃ­nh giÃ¡ trá»‹ cá»§a má»™t tráº¡ng thÃ¡i hay Æ°á»›c lÆ°á»£ng *lá»£i tá»©c mong Ä‘á»£i khi á»Ÿ tráº¡ng thÃ¡i Ä‘Ã³*. NÃ³i cÃ¡ch khÃ¡c *hÃ m V* lÃ¡y trung bÃ¬nh lá»£i tá»©c chiáº¿t kháº¥u $G_{t}$ Ä‘á»ƒ Ä‘o má»©c Ä‘á»™ tá»‘t xáº¥u cá»§a má»™t tráº¡ng thÃ¡i $s$ khi tÃ¡c nhÃ¢n thá»±c hiá»‡n hÃ nh Ä‘á»™ng tuÃ¢n theo má»™t **chiáº¿n lÆ°á»£c** $\pi$ :
$$
V ^ { \pi } \left ( s \right ) = E \left [ R \left ( s _ { 0 } \right ) + \gamma R \left ( s _ { 1 } \right ) + \gamma ^ { 2 } R \left ( s _ { 2 } \right ) + \cdots | s _ { 0 } = s, \pi \right ].
$$

$s_0$ = $s$ nÃªn $V^\pi$ cÃ³ thá»ƒ viáº¿t láº¡i tuÃ¢n theo phÆ°Æ¡ng trÃ¬nh **Bellman**:
$$
V ^ { \pi } \left ( s \right ) = R \left ( s \right ) + \gamma \sum _ { s ^ { \prime } \in S } P _ { s \pi \left ( s \right ) } \left ( s ^ { \prime } \right ) V ^ { \pi } \left ( s ^ { \prime } \right ).
$$

Trong Ä‘Ã³ $P_{s \pi (s)}(s')$ lÃ  xÃ¡c suáº¥t Ä‘áº¿n Ä‘Æ°á»£c tráº¡ng thÃ¡i $s'$ khi thá»±c hiá»‡n hÃ nh Ä‘á»™ng theo chiáº¿n lÆ°á»£c $\pi(s)$ khi á»Ÿ tráº¡ng thÃ¡i $s$. $V^\pi$ cÅ©ng cÃ³ thá»ƒ viáº¿t theo hÃ nh Ä‘á»™ng-tráº¡ng thÃ¡i nhÆ° sau vá»›i xÃ¡c suáº¥t thá»±c hiá»‡n hÃ nh Ä‘á»™ng $a$ táº¡i tráº¡ng thÃ¡i $s$ tuÃ¢n theo chiáº¿n lÆ°á»£c $\pi$ lÃ  $\pi ( s | a)$ vÃ  trong má»™t sá»‘ trÆ°á»ng há»£p chÆ°a biáº¿t trÆ°á»›c hÃ nh Ä‘á»™ng sáº½ dáº«n Ä‘áº¿n tráº¡ng thÃ¡i nÃ o, xÃ¡c xuáº¥t chuyá»ƒn Ä‘áº¿n tráº¡ng thÃ¡i $s'$ khi thá»±c hiá»‡n hÃ nh Ä‘á»™ng $a$ táº¡i tráº¡ng thÃ¡i $s$ lÃ   $P _ { s a } \left ( s ^ { \prime } \right )$:
$$
\tag{1}
V ^ { \pi } \left ( s \right ) = R \left ( s \right ) + \gamma \sum_{ a \in \mathcal{A}} \pi ( s | a) \sum _ { s ^ { \prime } \in S } P _ { s a } \left ( s ^ { \prime } \right ) V ^ { \pi } \left ( s ^ { \prime } \right ).
$$

Tá»« Ä‘Ã³, Ä‘á»‹nh nghÄ©a má»™t hÃ m **giÃ¡ trá»‹ tráº¡ng thÃ¡i tá»‘i Æ°u**:
$$
V ^ { * } \left ( s \right ) = \max _ { \pi } V ^ { \pi } \left ( s \right ).
$$

CÃ³ thá»ƒ hiá»ƒu Ä‘Ã¢y lÃ  giÃ¡ trá»‹ lá»›n nháº¥t cÃ³ thá»ƒ Ä‘áº¡t Ä‘Æ°á»£c cá»§a tá»•ng cÃ¡c lá»£i tá»©c chiáº¿t kháº¥u. Theo (1) ta cÃ³:
$$
\tag{2}
V ^ { * } \left ( s \right ) = R \left ( s \right ) + \max _ { a \in \mathcal{A} } \gamma \sum _ { s ^ { \prime } \in S } P _ { s a } \left ( s ^ { \prime } \right ) V ^ { * } \left ( s ^ { \prime } \right ).
$$

VÃ  má»™t chiáº¿n lÆ°á»£c Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c giÃ¡ trá»‹ táº¡i cÃ¡c tráº¡ng thÃ¡i lÃ  tá»‘i Æ°u:
$$
\tag{3}
\pi ^ { * } \left ( s \right ) = \arg \max _ { a \in \mathcal{A} } \sum _ { s ^ { \prime } \in S } P _ { s a } \left ( s ^ { \prime } \right ) V ^ { * } \left ( s ^ { \prime } \right ).
$$

### 2.3 HÃ m Q (Q-function)
Trong cÃ¡c cÃ´ng thá»©c cá»§a hÃ m giÃ¡ trá»‹, ta tháº¥y Ä‘á»u cÃ³ má»™t Ä‘áº¡i lÆ°á»£ng $P _ { s a } \left ( s ^ { \prime } \right )$ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi thÆ°Æ¡ng cá»§a *sá»‘ láº§n thá»±c hiá»‡n hÃ nh Ä‘á»™ng $a$ á»Ÿ tráº¡ng thÃ¡i $s$ chuyá»ƒn sang tráº¡ng thÃ¡*i $s'$ chia cho *sá»‘ láº§n thá»±c hiá»‡n hÃ nh Ä‘á»™ng $a$ á»Ÿ tráº¡ng thÃ¡i* $s$. Trong nhiá»u trÆ°á»ng há»£p viá»‡c xÃ¡c Ä‘á»‹nh chuá»—i tráº¡ng thÃ¡i - hÃ nh Ä‘á»™ng lÃ  khÃ´ng há» dá»… dÃ ng, nÃªn hÃ m **giÃ¡ trá»‹-hÃ nh Ä‘á»™ng ($Q$)** thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng. $Q$ lÃ  pháº§n thÆ°á»Ÿng mong Ä‘á»£i nháº­n Ä‘Æ°á»£c khi thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng .

 Tá»« cÃ´ng thá»©c (1), thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng cá»¥ thá»ƒ $a$, Ä‘á»‹nh nghÄ©a:
 $$
 Q(s,a)  = R \left ( s \right ) +\gamma \sum _ { s ^ { \prime } \in S } P _ { s a } \left ( s ^ { \prime } \right ) V ^ { \pi } \left ( s ^ { \prime } \right )
 $$
 Do $\sum _ { s ^ { \prime } \in S } P _ { s a } \left ( s ^ { \prime } \right ) = 1$, ta cÃ³:
 
 $$
 \tag{4}
 \begin{aligned}
 Q(s,a) &= \sum _ { s ^ { \prime } \in S } P _ { s a } \left ( s ^ { \prime } \right ) \left ( R(s) + \gamma V ^ { \pi } \left ( s ^ { \prime } \right ) \right ) \\ &= E_{s \sim P(s' | s , a)} \left (R(s) + \gamma V ^ { \pi } \left ( s ^ { \prime } \right ) \right )
 \end{aligned}
  $$

 Khi Ä‘Ã³ (1) vÃ  (2) trá»Ÿ thÃ nh:
 $$
 \tag{5}
V ^ { \pi } \left ( s \right ) =E_{a \sim \pi}Q(s,a).
$$

Tá»« (4) vÃ  (5), gá»i $R(s,a)$ lÃ  pháº§n thÆ°á»Ÿng nháº­n Ä‘Æ°á»£c khi thá»±c hiá»‡n hÃ nh Ä‘á»™ng $a$ á»Ÿ tráº¡ng thÃ¡i $s$, ta cÃ³:
$$
\tag{6}
Q(s,a) = E_{s \sim P(s' | s , a)} \left ( R(s,a) + \gamma E_{a \sim \pi}Q(s,a) \right )
$$

Khi tuÃ¢n theo chiáº¿n lÆ°á»£c tá»‘i Æ°u $\pi^*$, $Q$ trá»Ÿ thÃ nh $Q^*$:
$$
\tag{7}
Q^*(s,a) = \max _ {a \sim \pi^*}Q(s,a)
$$
vÃ :
$$
V^*(s) = \max _ {a \in \mathcal{A}}Q^*(s,a)
$$
$$
\tag{8}
\pi ^ * = \argmax _{a \in \mathcal{A}} Q^{*} (s,a)
$$

Do Ä‘Ã³ phÆ°Æ¡ng trÃ¬nh *Bellman* vá»›i Q lÃ  :
$$
\tag{9}
\begin{aligned}
Q^*(s,a) &= E_{s \sim P(s' | s , a)} \left (R(s, a) + \gamma V ^ { * } \left ( s ^ { \prime } \right ) \right ) \\ &=  E_{s \sim P(s' | s , a)} \left (R(s, a) + \gamma\max _ {a \in \mathcal{A}}Q^*(s,a) \right )
\end{aligned}
$$
# 3.Má»™t sá»‘ thuáº­t toÃ¡n há»c tÄƒng cÆ°á»ng
### 3.1 Dá»±a trÃªn MDP
Má»¥c tiÃªu cá»§a bÃ i toÃ¡n há»c tÄƒng cÆ°á»ng lÃ  tÃ¬m Ä‘Æ°á»£c chuá»—i hÃ nh Ä‘á»™ng tá»‘i Æ°u Ä‘á»ƒ tá»‘i Ä‘a pháº§n thÆ°á»Ÿng. Do Ä‘Ã³ chÃºng ta cÃ³ thá»ƒ giáº£i bÃ i toÃ¡n báº±ng cÃ¡ch tÃ¬m Ä‘Æ°á»£c chiáº¿n lÆ°á»£c $\pi^*$ hoáº·c tÃ­nh Ä‘Æ°á»£c giÃ¡ trá»‹ $V^*$,$Q^$ rá»“i chá»n cÃ¡c hÃ nh Ä‘á»™ng má»™t cÃ¡ch "*tham lam*" dá»±a vÃ o (3) vÃ  (8). Cá»¥ thá»ƒ cÃ³ 3 thuáº­t toÃ¡n cÆ¡ báº£n giá»±a trÃªn cÃ¡c hÃ m trÃªn:
* Dá»±a trÃªn hÃ m giÃ¡ trá»‹:
![value_iter](https://images.viblo.asia/0738e4d0-1b67-4214-9936-0a1e9ba03fe5.png)

* Dá»±a trÃªn chiáº¿n lÆ°á»£c:
![policy_iter](https://images.viblo.asia/c5079600-11e1-4b23-9c96-ac0609d853e5.png)

* Káº¿t há»£p giÃ¡ trá»‹ vÃ  chiáº¿n lÆ°á»£c:
![value_policy](https://images.viblo.asia/d5f4c3d5-ead1-438a-bea9-fab55319d2ca.png)

### 3.2 Q-Learning

Viá»‡c tÃ¬m ra chuá»—i hÃ nh Ä‘á»™ng tá»‘i Æ°u dá»±a vÃ o hÃ m **giÃ¡ trá»‹ - hÃ nh Ä‘á»™ng $Q$** hay tÃ¬m ra giÃ¡ trá»‹ $Q^*$ cÅ©ng cÃ³ thá»ƒ thá»±c hiá»‡n tÆ°á»£ng tá»± nhÆ° thuáº­t toÃ¡n 3. Tuy nhiÃªn, náº¿u cáº­p nháº­t $Q$ theo (9), táº¡i má»—i tráº¡ng thÃ¡i, cÃ¡c hÃ nh Ä‘á»™ng khi Ä‘Æ°á»£c thá»±c hiá»‡n cÃ³ pháº§n thÆ°á»Ÿng khÃ¡c nhau sáº½ lÃ m giÃ¡ trá»‹ cá»§a $Q$ thay Ä‘á»•i liÃªn tá»¥c vÃ  khÃ³ há»™i tá»¥. Do Ä‘Ã³, má»™t há»‡ sá»‘ há»c $\alpha$ quen thuá»™c Ä‘Æ°á»£c Ä‘Æ°a vÃ o Ä‘á»ƒ $Q$ cáº­p nháº­t cháº­m hÆ¡n, dá»… há»™i tá»¥ hÆ¡n:
$$
\begin{aligned}
Q(s,a) &= Q(s, a) + \alpha ( Q^*(s,a) - Q(s,a)) \\ &= (1-\alpha) Q(s,a) + \alpha E_{s \sim P(s' | s , a)} \left (R(s, a) + \gamma\max _ {a \in \mathcal{A}}Q^*(s,a) \right )
\end{aligned}
$$

# 4. Tá»•ng káº¿t
Trong bÃ i viáº¿t nÃ y mÃ¬nh Ä‘Ã£ giá»›i thiá»‡u vá»›i cÃ¡c báº¡n má»™t sá»‘ tá»•ng quan vá» há»c tÄƒng cÆ°á»ng, ná»™i dung bÃ i viáº¿t lÃ  káº¿t quáº£ quÃ¡ trÃ¬nh tÃ¬m hiá»ƒu cá»§a mÃ¬nh á»Ÿ nhiá»u nguá»“n khÃ¡nhieeufu nÃªn khÃ´ng thá»ƒ trÃ¡nh khá»i cÃ³ nhá»¯ng sai sÃ³t, mong cÃ¡c báº¡n bá» qua. Náº¿u tháº¥y hay thÃ¬ ngáº§n ngáº¡i gÃ¬ mÃ  khÃ´ng cho mÃ¬nh 1 upvote Ä‘á»ƒ mÃ¬nh cÃ³ Ä‘á»™ng lá»±c viáº¿t tiáº¿p ğŸ˜„

## reference:
1. [Reinforcement Learning and Control - cs.229, fall 2020, Standford](https://cs229.stanford.edu/notes2020fall/notes2020fall/cs229-notes12.pdf)
2. [Q-Function Learning Methods, UC Berkeley Robot Learning Lab](https://rll.berkeley.edu/deeprlcoursesp17/docs/lec3.pdf)