LÃ m gÃ¬ khi website truy cáº­p cháº­m? CÃ¢u tráº£ lá»i tÆ°á»Ÿng dá»…, nhÆ°ng tháº­t ra khÃ´ng há» dá»….

ÄÃ¢y lÃ  cÃ¢u há»i mÃ¬nh Ä‘Æ°á»£c há»i khi Ä‘i phá»ng váº¥n cÃ¡ch Ä‘Ã¢y má»™t nÄƒm, lÃºc Ä‘Ã³ mÃ¬nh cÅ©ng ngu ngÆ¡ tráº£ lá»i lÃ  kiá»ƒm tra log, resize imageâ€¦ vÃ  mÃ¬nh Ä‘Ã£ Ä‘áº­u phá»ng váº¥n. HÃ´m nay mÃ¬nh tÃ¬nh cá» Ä‘á»c má»™t bÃ i trÃªn medium vá» liÃªn quan tá»›i chá»§ Ä‘á» Ä‘Ã³. Sau khi má»™t há»“i ngáº«m nghÄ©, mÃ¬nh phÃ¡t hiá»‡n ra cÃ¢u há»i nÃ y ráº¥t hay, cÃ³ ráº¥t nhiá»u cÃ¡ch tráº£ lá»i khÃ¡c nhau. CÃ³ thá»ƒ báº¡n lÃ  backend developer, frontend developer hay full-stack developer, nhÆ°ng ráº¥t cÃ³ thá»ƒ báº¡n sáº½ gáº·p cÃ¢u há»i nÃ y khi Ä‘i phá»ng váº¥n. TÃ¹y theo gÃ³c nhÃ¬n cá»§a báº¡n sáº½ cÃ³ cÃ¢u tráº£ lá»i khÃ¡c nhau. Vá»›i má»—i cÃ¡ch tráº£ lá»i cá»§a báº¡n mÃ  nhÃ  tuyá»ƒn dá»¥ng cÃ³ thá»ƒ Ä‘Ã¡nh giÃ¡ Ä‘Æ°á»£c sá»± hiá»ƒu biáº¿t cá»§a báº¡n vá» cÃ¡ch váº­n hÃ nh cá»§a website, kinh nghiá»‡m lÃ m viá»‡c cá»§a báº¡n.
HÃ£y tÆ°á»Ÿng tÆ°á»£ng, chÃºng ta lÃ  tháº§y thuá»‘c, trang web lÃ  bá»‡nh nhÃ¢n vÃ  bá»‡nh nhÃ¢n nÃ y cÃ³ triá»‡u chá»©ng truy cáº­p cháº­m. Sáº½ cÃ³ ráº¥t nhiá»u nguyÃªn nhÃ¢n dáº«n tá»›i triá»‡u chá»©ng truy cáº­p cháº­m, vÃ  cÅ©ng cÃ³ ráº¥t nhiá»u loáº¡i thuá»‘c Ä‘á»ƒ chá»¯a trá»‹ cÃ¡c nguyÃªn nhÃ¢n. Táº¥t nhiÃªn, náº¿u báº¡n chÆ°a biáº¿t nguyÃªn nhÃ¢n cá»¥ thá»ƒ mÃ  bá»‘c thuá»‘c cho bá»‡nh nhÃ¢n lÃ  trang web. Thuá»‘c nÃ o cÅ©ng Ä‘á»u tá»‘t, bá»‡nh nhÃ¢n khÃ´ng bá»• ngang thÃ¬ bá»• dá»c. ğŸ˜…ğŸ˜…ğŸ˜… Ã mÃ¬nh lÃ  trÆ°á»›c tiÃªn muá»‘n trá»‹ dá»©t Ä‘iá»ƒm váº¥n Ä‘á», chÃºng ta cáº§n pháº£i chuáº©n Ä‘oÃ¡n Ä‘Ãºng bá»‡nh. LÃ m cÃ¡ch nÃ o Ä‘á»ƒ chuáº©n Ä‘oÃ¡n Ä‘Ãºng bá»‡nh? ChÃºng ta cáº§n pháº£i biáº¿t cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a trang web, sau Ä‘Ã³ tÃ¬m xem cÃ´ng Ä‘oáº¡n nÃ o lÃ m cho trong web bá»‹ cháº­m, cuá»‘i cÃ¹ng lÃ  Ä‘Æ°a ra phÆ°Æ¡ng phÃ¡p giáº£i quyáº¿t. 

Táº¡i sao cÃ¢u há»i nÃ y láº¡i cÃ³ thá»ƒ Ä‘Ã¡nh giÃ¡ Ä‘Æ°á»£c vá»‘n hiá»ƒu biáº¿t cá»§a báº¡n vá» cÃ¡ch váº­n hÃ nh cá»§a website? 

TrÆ°á»›c tiÃªn mÃ¬nh sáº½ Ä‘i nÃ³i vá» Ä‘iá»u gÃ¬ sáº½ xáº£y ra khi ngÆ°á»i dÃ¹ng nháº­p URL vÃ o thanh Ä‘á»‹a chá»‰ cá»§a browser. 

Má»—i domain name trÃªn internet sáº½ cÃ³ má»™t Ä‘á»‹a chá»‰ IP duy nháº¥t. IP Ä‘Ã³ lÃ  Ä‘á»‹a chá»‰ cá»§a server chá»©a website mÃ  ngÆ°á»i dÃ¹ng muá»‘n truy cáº­p. Vd: www.genzLearntechs.com Ä‘Æ°á»£c map vá»›i ip: 192.168.32.11
Má»—i mapping giá»¯ domain name vá»›i IP Ä‘Æ°á»£c gá»i lÃ  DNS record

Khi báº¡n gÃµ vÃ o thanh Ä‘á»‹a chá»‰ cá»§a browser:

1. Äáº§u tiÃªn, browser sáº½ Ä‘i kiá»ƒm tra caches Ä‘á»ƒ tÃ¬m DNS record. Browser sáº½ kiá»ƒm tra bá»‘n lá»›p caches theo thá»© tá»± gáº§n tá»›i xa browser nháº¥t.
    1. Äáº§u tiá»n, Browser sáº½ cháº¡y DNS query á»Ÿ browser cache
    2. Náº¿u DNS query khÃ´ng tráº£ vá» káº¿t quáº£, browser sáº½ kiá»ƒm tráº£ OS cache báº±ng cÃ¡ch gá»i cÃ¡c cÃ¢u lá»‡nh system nhÆ° gethostnameâ€¦
    3. Náº¿u váº«n khÃ´ng tÃ¬m Ä‘Æ°á»£c DNS record nÃ o, browser sáº½ giao tiáº¿p vá»›i router cache Ä‘á»ƒ tÃ¬m DNS record.
    4. Náº¿u váº«n khÃ´ng cÃ³ káº¿t quáº£, browser sáº½ chuyá»ƒn qua tÃ¬m kiáº¿m trÃªn ISP cache.
2. Náº¿u URL khÃ´ng tÃ¬m tháº¥y trong bá»‘n lá»›p cache phÃ­a trÃªn, DNS server cá»§a ISP sáº½ khá»Ÿi táº¡o DNS query Ä‘á»ƒ tÃ¬m Ä‘á»‹a chá»‰ IP tÆ°Æ¡ng á»©ng vá»›i domain name. DNS server sáº½ phÃ¢n giáº£i domain name ra tá»«ng level vÃ  tÃ¬m kiáº¿m tÆ°Æ¡ng á»©ng. VÃ­ dá»¥ vá»›i tÃªn miá»n abc.genzlearntechs.com, DNS server sáº½ redirect tá»›i server xá»­ lÃ­ domain cÃ³ Ä‘uÃ´i lÃ  .com á»Ÿ level thá»© nháº¥t.

á» Ä‘Ã¢y, .com domain name server sáº½ redirect tá»›i genzlearntechs.com á»Ÿ level thá»© hai. genzlearntechs.com  domain name server láº¡i tiáº¿p tá»¥c redirect tá»›i abc.genzlearntechs.com á»Ÿ level thá»© ba.
LÃºc nÃ y server sáº½ tÃ¬m Ä‘Æ°á»£c DNS record vÃ  tráº£ vá» cho browser

1. Sau khi nháº­n Ä‘Æ°á»£c Ä‘á»‹a chá»‰ IP tÆ°Æ¡ng á»©ng vá»›i domain, browser sáº½ thiáº¿t láº­p connection vá»›i server theo giao thá»©c TCP
2. Khi TCP connection Ä‘Æ°á»£c thiáº¿t láº­p, browser sáº½ gá»­i request lÃªn server
3. Server nháº­n request, sau Ä‘Ã³ xá»­ lÃ­ vÃ  tráº£ response vá» cho browser. 
4. Browser nháº­n response tráº£ vá», xá»­ lÃ½, hiá»ƒn thá»‹ cho ngÆ°á»i dÃ¹ng.



ÄÃ¢y lÃ  hÃ¬nh mÃ¬nh kiáº¿m Ä‘Æ°á»£c trÃªn máº¡ng: https://twitter.com/manekinekko/status/1281704000572858375?s=20
![image.png](https://images.viblo.asia/5104e5fb-696d-4aa9-afe9-28cb4c9ad84b.png)

ÄÃ¢y lÃ  6 cÃ´ng Ä‘oáº¡n cÆ¡ báº£n khi truy cáº­p website, tuy nhiÃªn trong Ä‘Ã³, bÆ°á»›c 4, 5, 6 thÃ´ng thÆ°á»ng sáº½ lÃ m website truy cáº­p cháº­m vÃ  chÃºng ta cÅ©ng chá»‰ cÃ³ thá»ƒ can thiá»‡p vÃ o cÃ¡c bÆ°á»›c Ä‘Ã³.

Khi tráº£ lá»i phá»ng váº¥n, báº¡n cÃ³ thá»ƒ khÃ´ng cáº§n nÃªu 6 cÃ´ng Ä‘oáº¡n trÃªn, nhÆ°ng náº¿u báº¡n nÃªu ra Ä‘Æ°á»£c, ngÆ°á»i tuyá»ƒn dá»¥ng sáº½ cÃ³ cÃ¡i nhÃ¬n khÃ¡c. CÃ²n há» nhÃ¬n nhÆ° tháº¿ nÃ o thÃ¬ mÃ¬nh chÆ°a biáº¿t.

BÃ¢y giá» chÃºng ta Ä‘Ã£ cÃ³ cÃ¡i nhÃ¬n tá»•ng quan, giá» cáº§n Ä‘Ã¡nh giÃ¡ xem cÃ´ng Ä‘oáº¡n lÃ m cho trang web bá»‹ truy cáº­p cháº­m.

CÃ¡c nguyÃªn nhÃ¢n cÃ³ thá»ƒ lÃ m website bá»‹ cháº­m:
* Chá»‰ cháº­m Ä‘á»‘i vá»›i user á»Ÿ khÃ¡c vÃ¹ng Ä‘á»‹a lÃ­
* Chá»‰ cháº­m vá»›i má»™t sá»‘ thiáº¿t bá»‹ nhÆ° desktop, mobile, tablet
* ToÃ n bá»™ cÃ¡c pháº§n cá»§a website Ä‘á»u cháº­m hay chá»‰ má»™t sá»‘ module/chá»©c nÄƒng cháº­m?
* Website chá»‰ bá»‹ cháº­m á»Ÿ má»™t khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh trong ngÃ y.
* Äá»ƒ biáº¿t Ä‘Æ°á»£c lÃ½ do cá»¥ thá»ƒ, chÃºng ta cáº§n pháº£i phÃ¢n tÃ­ch, kiá»ƒm tra log, xÃ¡c Ä‘á»‹nh nguyÃªn nhÃ¢n Ä‘á»ƒ cÃ³ biá»‡n phÃ¡p tá»‘i Æ°u thÃ­ch há»£p. Khi load giao diá»‡n cháº­m, mÃ¬nh thÆ°á»ng sá»­ dá»¥ng https://developers.google.com/speed/pagespeed/insights/ Ä‘á»ƒ kiá»ƒm tra xem pháº§n nÃ o lÃ m cho website bá»‹ cháº­m. Náº¿u nhÆ° website bá»‹ cháº­m do viá»‡c gá»i API quÃ¡ lÃ¢u thÃ¬ mÃ¬nh sáº½ Ä‘i kiá»ƒm tra log/metric á»Ÿ backend, DB

### **Frontend load cháº­m:**

Äáº§u tiÃªn vÃ  quan trá»ng nháº¥t mÃ  mÃ¬nh nghÄ© táº¥t cáº£ developer pháº£i biáº¿t Ä‘Ã³ lÃ  khi cháº¡y frontend, chÃºng ta cáº§n pháº£i bundle code Ä‘á»ƒ giáº£m thiá»ƒu kÃ­ch thÆ°á»›c. GiÃºp cho viá»‡c táº£i trang Ä‘Æ°á»£c nhanh chÃ³ng hÆ¡n. Báº¡n cÃ³ thá»ƒ dÃ¹ng webpack, vite hoáº·c nhiá»u thÆ° viá»‡n khÃ¡c Ä‘á»ƒ bundle code. ThÆ° viá»‡n bundle sáº½ remove cÃ¡c khoáº£ng tráº¯ng, Ä‘á»•i tÃªn biáº¿n tá»« thÃ¢n thiá»‡n tá»›i ngÆ°á»i dÃ¹ng thÃ nh tÃªn biáº¿n Ä‘Æ¡n giáº£n hÆ¡n. ThÆ° viá»‡n bundle sáº½ xÃ¢y dá»±ng dependency tree, loáº¡i bá» nhá»¯ng pháº§n code khÃ´ng cáº§n thiáº¿t, chá»‰ bundle nhá»¯ng pháº§n code cÃ³ sá»­ dá»¥ng... vÃ  nhiá»u cÃ´ng Ä‘oáº¡n khÃ¡c. 

Dá»±a vÃ o https://developers.google.com/speed/pagespeed/insights/ báº¡n cÃ³ thá»ƒ biáº¿t Ä‘Æ°á»£c frontend load cháº­m vÃ¬ lÃ­ do gÃ¬.
Vá»›i má»™t sá»‘ lÃ­ do thÃ´ng dá»¥ng nhÆ°:

KÃ­ch thÆ°á»›c áº£nh quÃ¡ lá»›n: ChÃºng ta cÃ³ thá»ƒ giáº£m kÃ­ch thÆ°á»›c áº£nh. Má»™t sá»‘ pháº§n áº£nh chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng á»Ÿ dáº¡ng thumbnail. Sá»­ dá»¥ng má»™t sá»‘ plugin Ä‘á»ƒ nÃ©n áº£nh. Sá»­ dá»¥ng lazy load vá»›i áº£nh

Load file js/css quÃ¡ lÃ¢u: ChÃºng ta cÃ³ thá»ƒ config webpack Ä‘á»ƒ bundle code, loáº¡i bá» nhá»¯ng pháº§n khÃ´ng liÃªn quan, chá»‰ bundle nhá»¯ng pháº§n code phá»¥ thuá»™c, cáº§n dÃ¹ng tá»›i.

Ãp dá»¥ng kiáº¿n trÃºc micro frontend

Má»™t sá»‘ khu vá»±c Ä‘á»‹a lÃ­ bá»‹ truy cáº­p cháº­m: sá»­ dá»¥ng CDN

NgoÃ i ra chÃºng ta nÃªn sá»­ dá»¥ng http2. MÃ¬nh sáº½ cÃ³ má»™t bÃ i viáº¿t mÃ´ táº£ vá» cÃ¡ch váº­n hÃ nh cá»§a http2, lá»£i Ä‘iá»ƒm cá»§a nÃ³ so vá»›i http1


### **Backend pháº£n há»“i lÃ¢u:**

Báº¡n cÃ³ thá»ƒ kiá»ƒm tra log/metric Ä‘á»ƒ biáº¿t Ä‘Æ°á»£c API nÃ o/thá»i Ä‘iá»ƒm nÃ o xá»­ lÃ­ lÃ¢u. MÃ¬nh Ä‘ang lÃ m vá»›i AWS, nÃ³ cung cáº¥p ráº¥t nhiá»u dá»‹ch vá»¥ nhÆ° cloudwatch Ä‘á»ƒ log láº¡i thÃ´ng tin.

Náº¿u báº¡n chá»‰ sá»­ dá»¥ng má»™t machines, báº¡n cÃ³ thá»ƒ thÃªm thÃªm nhiá»u machines vÃ  dÃ¹ng load balancer Ä‘á»ƒ phÃ¢n phá»‘i request tá»›i cÃ¡c machines Ä‘Ã³. 

Náº¿u báº¡n sá»­ dá»¥ng cÃ¡c dá»‹ch vá»¥ cloud, báº¡n cÃ³ thá»ƒ config Ä‘á»ƒ khi sá»‘ lÆ°á»£ng request tá»›i má»™t ngÆ°á»¡ng nÃ o Ä‘Ã³ cÃ³ thá»ƒ auto scaling

Náº¿u backend cháº­m do sá»­ dá»¥ng cÃ¡c dá»‹ch vá»¥ bÃªn thá»© ba, chÃºng ta cÃ³ thá»ƒ cache láº¡i cÃ¡c thÃ´ng tin cá»§a bÃªn thá»© ba.

NgoÃ i ra chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng bá»™ nhá»› cache Ä‘á»ƒ há»— trá»£ truy váº¥n má»™t cÃ¡ch nhanh hÆ¡n.

ChÃºng ta cÅ©ng cáº§n tá»‘i Æ°u code. Sau quÃ¡ trÃ¬nh va cháº¡m, mÃ¬nh tháº¥y khÃ¡ nhiá»u ngÆ°á»i khÃ´ng Ä‘á»ƒ Ã½ tá»›i váº¥n Ä‘á» nÃ y, nhÆ°ng cÃ¡i nÃ y tháº­t sá»± ráº¥t quan trá»ng. ChÃºng ta cáº§n pháº£i tá»‘i Æ°u code, xá»­ lÃ­ batch operation thay vÃ¬ xá»­ lÃ­ tá»«ng pháº§n Ä‘Æ¡n láº».

### **DB xá»­ lÃ­ lÃ¢u:**

ChÃºng ta cÃ³ thá»ƒ scaling theo hai hÆ°á»›ng horizontally scale hoáº·c vertically scale

Sá»­ dá»¥ng sharing/replicas

Cache data náº¿u dá»¯ liá»‡u Ã­t thay Ä‘á»•i

Tá»‘i Æ°u cÃ¢u query. Váº¥n Ä‘á» nÃ y mÃ¬nh tháº¥y khÃ¡ nhiá»u dev gáº·p pháº£i. Ban Ä‘áº§u mÃ¬nh bÆ°á»›c chÃ¢n vÃ o nghá» cÅ©ng gáº·p pháº£i váº¥n Ä‘á» nÃ y. LÃºc Ä‘Ã³ dá»± Ã¡n mÃ¬nh kinh phÃ­ cÃ²n háº¡n háº¹p, lÆ°á»£ng khÃ¡ch hÃ ng cÃ²n Ã­t, nÃªn viá»‡c tá»‘i Æ°u scale theo chiá»u ngang hay chiá»u dá»c vá»›i DB gáº§n nhÆ° lÃ  khÃ´ng cÃ³ chi phÃ­.  LÃºc Ä‘Ã³ mÃ¬nh Ä‘i tá»‘i Æ°u nhiá»u query, join báº£ng, vá»‹ trÃ­ Ä‘áº·t cÃ¢u Ä‘iá»u kiá»‡n join sao cho há»£p lÃ­, giáº£m thiá»ƒu thá»i gian query. CÃ³ nhá»¯ng lÃºc mÃ¬nh giáº£m thá»i gian query tá»« Ä‘Æ¡n vá»‹ giÃ¢y xuá»‘ng Ä‘Æ¡n vá»‹ miliseconds.

BÃªn trÃªn lÃ  má»™t sá»‘ cÃ¡ch Ä‘á»ƒ xá»­ lÃ½ váº¥n Ä‘á» trang web truy cáº­p cháº­m. Tuy nhiÃªn chÃºng ta nÃªn tÃ¬m cÃ¡ch trÃ¡nh váº¥n Ä‘á» xáº£y ra trÆ°á»›c khi nÃ³ lÃ m ngÆ°á»i dÃ¹ng cáº£m tháº¥y khÃ³ chá»‹u.

ThÃªm metrics/alarm

Cháº¡y load/performance test

ThÃªm automation test


TrÃªn Ä‘Ã¢y lÃ  nhá»¯ng suy nghÄ©, cÅ©ng nhÆ° tÃ¬m hiá»ƒu, tá»•ng há»£p Ä‘Æ°á»£c trÃªn máº¡ng. Hi vá»ng nÃ³ cÃ³ Ã­ch vá»›i báº¡n.


# Sau táº¥t cáº£
**Sau táº¥t cáº£, mÃ¬nh lÃ  [Ryan Cao](https://ryancao.netlify.app/about/)**, lÃ  má»™t developer chÃ¢n chÃ­nh Ä‘ang trÃªn Ä‘Æ°á»ng chÃ©m giÃ³. Äá»ƒ á»§ng há»™ mÃ¬nh cÃ¡c báº¡n cÃ³ thá»ƒ upvote bÃ i viáº¿t nÃ y, follow [Github Caophuc799](https://github.com/Caophuc799) vÃ  Ä‘Ã³n Ä‘á»c cÃ¡c bÃ i viáº¿t trÃªn [Ryan Cao blog](https://ryancao.netlify.app/) chÃ­nh thá»©c cá»§a mÃ¬nh Ä‘á»ƒ mÃ¬nh cÃ³ thÃªm Ä‘á»™ng lá»±c chia sáº½ nhá»¯ng bÃ i viáº¿t hay, Ã½ nghÄ©a khÃ¡c nhÃ©