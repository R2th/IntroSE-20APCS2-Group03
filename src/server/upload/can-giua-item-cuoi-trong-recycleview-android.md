Xin ch√†o c√°c b·∫°n h√¥m nay m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c√°c b·∫°n l√†m sao ƒë·ªÉ ƒë·∫°t ƒë∆∞·ª£c cƒÉn gi·ªØa item ·ªü d√≤ng cu·ªëi trong recyclevView nh∆∞ h√¨nh b√™n d∆∞·ªõi, m√¨nh ƒë√£ t·ª´ng kh√° ch·∫≠t v·∫≠t ƒë·ªÉ ƒë∆∞a ra ph∆∞∆°ng √°n v√† c≈©ng ƒë√£ nh·ªù support n√™n b√¢y gi·ªù m√¨nh s·∫Ω chia s·∫ª l·∫°i cho c√°c b·∫°n c√πng bi·∫øt, c√°c b·∫°n c√πng xem nha üòä

![image.png](https://images.viblo.asia/3d284dd2-e10a-416f-b03a-5d2dcdb6567f.png)

C√°ch ƒë·∫°t ƒë∆∞·ª£c item nh∆∞ v·∫≠y theo m√¨nh t√¨m hi·ªÉu s·∫Ω c√≥ nhi·ªÅu c√°ch trong ƒë√≥ c√≥ 3 c√°ch m√¨nh t·ªïng h·ª£p ƒë∆∞·ª£c:

+ C√°ch 1: S·ª≠ d·ª•ng th∆∞ vi·ªán support FlexBoxLayoutManager: m√¨nh kh√¥ng ƒë√°nh gi√° cao c√°ch n√†y b·ªüi v√¨ 3 y·∫øu t·ªë: Th·ª© nh·∫•t l√† khi m√¨nh s·ª≠ d·ª•ng FlexBoxLayoutManager th√¨ oncreateViewHolder lu√¥n ƒë∆∞·ª£c g·ªçi all time, nghƒ©a l√† ch√∫ng ta s·ª≠ d·ª•ng RecycleView m√† gi·ªëng nh∆∞ ListView. M√¨nh kh√¥ng r√µ code core ch√≠nh c·ªßa flexboxlayoutmanager vi·∫øt nh∆∞ th·∫ø n√†o m√† kh√¥ng s·ª≠ d·ª•ng l·∫°i ƒë∆∞·ª£c ViewHolder. Th·ª© 2 l√† khi s·ª≠ d·ª•ng FlexBoxLayoutManager th√¨ b·∫£n th√¢n m√¨nh apply v√†o project c√≥ m·ªôt s·ªë issue nh∆∞ c√°c funtion findFirstVisibleItemPosition, findLastVisibleItemPosition tr·∫£ k·∫øt qu·∫£ kh√¥ng ch√≠nh x√°c, b·∫°n c√≥ th·ªÉ t√°i hi·ªán issue b·∫±ng c√°ch g·ªçi recycleView.addOnScrollListener() -> v√† in ra ƒë·ªÉ ki·ªÉm tra. Th·ª© 3 m·∫∑c d√π l√† lib c·ªßa google nh∆∞ng c√≥ kh√° nhi·ªÅu issue ch∆∞a ƒë∆∞·ª£c gi·∫£i quy√™t v√† lib ƒë√£ kh√¥ng ƒë∆∞·ª£c update kh√° l√¢u r·ªìi.

+ C√°ch 2: S·ª≠ d·ª•ng GridlayoutManager,  ItemSpanSizeLookup v√† ItemDecoration: c√°ch n√†y c√≥ th·ªÉ tri·ªÉn khai ƒë∆∞·ª£c nh∆∞ng kh√° ph·ª©c t·∫°p.

+ C√°ch 3: S·ª≠ d·ª•ng GridlayoutManager, ItemSpanSizeLookup v√† set gravity: c√°ch n√†y m√¨nh th·∫•y ƒë∆°n gi·∫£n v√† hi·ªáu qu·∫£ nh·∫•t so v·ªõi nh·ªØng c√°ch ·ªü tr√™n v√¨ n√≥ s·ª≠ d·ª•ng LayoutManger c·ªßa android n√™n vi·ªác implement n√≥ c·ª±c k√¨ d·ªÖ hi·ªÉu. Nh·∫£y lu√¥n v√†o project th√¥i n√†o üòú

**Tri·ªÉn khai**

M√¨nh s·ª≠ d·ª•ng viewbinding thay th·∫ø cho findViewById ƒë·ªÉ ƒë∆°n gi·∫£n h√≥a code,  ƒë·ªÉ b·∫≠t view binding, h√£y ƒë·ªãnh c·∫•u h√¨nh viewBinding trong build.gradle ·ªü c·∫•p module c·ªßa b·∫°n.
```
android {
    buildFeatures {
        viewBinding true
    }
}
```

M√¨nh t·∫°o itemview.xml

```
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content">

    <FrameLayout
        android:id="@+id/main_item"
        android:layout_width="160dp"
        android:layout_height="180dp"
        android:layout_gravity="center"
        android:layout_margin="8dp"
        android:background="#ECECEC"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent">

        <TextView
            android:id="@+id/tv_item"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_gravity="center"
            android:textSize="20sp"
            tools:text="Item 1" />

    </FrameLayout>

</FrameLayout>

```
M√¨nh t·∫°o m·ªôt FrameLayout bao main Item c·ªßa m√¨nh. √ù t∆∞·ªüng c·ªßa m√¨nh khi t·∫°o item n√†y l√† m√¨nh c√≥ th·ªÉ **gravity left, right** cho **main_item** , xu·ªëng d∆∞·ªõi m√¨nh gi·∫£i th√≠ch ti·∫øp nh√©

**1>T·∫°o ViewHolder cho RecycleView**

```
import android.util.Size
import android.widget.FrameLayout
import androidx.recyclerview.widget.RecyclerView
import com.example.demogridlayoutmanager.databinding.ItemInRecyclerviewBinding

class ItemViewHolder(
    private val binding: ItemInRecyclerviewBinding,
    itemSize: Size
) : RecyclerView.ViewHolder(binding.root) {

    init {
        val layoutParams = binding.mainItem.layoutParams
        layoutParams.width = itemSize.width
        layoutParams.height = itemSize.height
        binding.mainItem.layoutParams = layoutParams
    }

    fun bind(text: ViewItem) {
        val layoutParams = binding.mainItem.layoutParams as FrameLayout.LayoutParams
        layoutParams.gravity = text.gravity
        binding.mainItem.layoutParams = layoutParams
        binding.tvItem.text = text.name
    }
}
```

**init{}** d√πng ƒë·ªÉ set layoutparams c·ªßa itemView

**bind(text: ViewItem)** d√πng ƒë·ªÉ bind data v√†o itemView. T·∫°i ƒë√¢y c√≥ m·ªôt l·ªánh quan tr·ªçng l√† **layoutParams.gravity = text.gravity**. L·ªánh n√†y r·∫•t ƒë∆°n gi·∫£n nh∆∞ng n√≥ s·∫Ω l√† key ch√≠nh ƒë·ªÉ th·ª±c hi·ªán layout center n√†y

**2>T·∫°o Adapter cho RecycleView**

```
import android.util.Size
import android.view.LayoutInflater
import android.view.ViewGroup
import androidx.recyclerview.widget.ListAdapter
import com.example.demogridlayoutmanager.databinding.ItemInRecyclerviewBinding

class ItemsAdapter(private val itemSize: Size) : ListAdapter<ViewItem, ItemViewHolder>(ITEM_DIFF) {

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ItemViewHolder {
        val inflater = LayoutInflater.from(parent.context)
        return ItemViewHolder(
            ItemInRecyclerviewBinding.inflate(inflater, parent, false),
            itemSize = itemSize
        )
    }

    override fun onBindViewHolder(holder: ItemViewHolder, position: Int) {
        holder.bind(getItem(position))
    }
}
```
·ªû ƒë√¢y m√¨nh s·ª≠ d·ª•ng ListAdapter ƒë·ªÉ c√≥ th·ªÉ notity, submitList d·ªÖ d√†ng, **ITEM_DIFF** l√† m·ªôt object DiffUtils. C√°c b·∫°n ch∆∞a bi·∫øt v·ªÅ ListAdapter th√¨ xem th√™m [t·∫°i ƒë√¢y](https://developer.android.com/reference/androidx/recyclerview/widget/ListAdapter)

**3>T·∫°o Xml cho ActivityMain**

```
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".MainActivity">

    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/rv_items"
        android:layout_width="0dp"
        android:layout_height="match_parent"
        android:padding="8dp"
        app:layoutManager="androidx.recyclerview.widget.GridLayoutManager"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintHorizontal_bias="0.0"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintVertical_bias="0.498"
        app:spanCount="2"
        tools:itemCount="3"
        tools:listitem="@layout/item_in_recyclerview" />

</androidx.constraintlayout.widget.ConstraintLayout>
```
T·∫°i ƒë√¢y s·∫Ω c√≥ m·ªôt recycleView ƒë·ªÉ hi·ªÉn th·ªã List Item 

**4>Vi·∫øt MainActivity**

```
package com.example.demogridlayoutmanager

import android.os.Bundle
import android.util.Size
import android.view.Gravity
import androidx.appcompat.app.AppCompatActivity
import androidx.recyclerview.widget.GridLayoutManager
import com.example.demogridlayoutmanager.databinding.ActivityMainBinding

class MainActivity : AppCompatActivity() {

    private lateinit var viewBinding: ActivityMainBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        viewBinding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(viewBinding.root)
        setupRecyclerView()
    }

    private fun setupRecyclerView() {
        val items = List(5) {
            "Item ${it + 1}"
        }
        val adapter = ItemsAdapter(getItemSize())
        val girdLayoutManager = GridLayoutManager(this, 6)
        girdLayoutManager.spanSizeLookup = ItemSpanSizeLookup(adapter)
        submitNewData(adapter, items)
        viewBinding.rvItems.setHasFixedSize(true)
        viewBinding.rvItems.layoutManager = girdLayoutManager
        viewBinding.rvItems.adapter = adapter
    }

    private fun submitNewData(
        adapter: ItemsAdapter,
        items: List<String>
    ) {
        adapter.submitList(items.mapIndexed { index, s ->
            ViewItem(
                id = index,
                name = s,
                gravity = getGravity(items.size, index)
            )
        })
    }

    private fun getGravity(size: Int, position: Int): Int {
        if (size % 3 == 0) return Gravity.CENTER
        if ((size % 3) == 2) {
            // Last item
            if (position == size - 1) return Gravity.START
            if (position == size - 2) return Gravity.END
        }
        return Gravity.CENTER
    }

    private fun getItemSize(): Size {
        val screenSize = resources.displayMetrics.widthPixels
        val itemPadding = resources.getDimensionPixelSize(R.dimen.item_padding)
        val width = (screenSize - (8 * itemPadding)) / 3
        val height = width * 1.2f // Ratio 1:1.2
        return Size(width, height.toInt())
    }
}

```

**setupRecyclerView**, t·∫°i ƒë√¢y ta kh·ªüi t·∫°o adpater, set layoutManager, spanSizeLookup cho recycleView, sau ƒë√≥ ch√∫ng ta submitList. C√°c b·∫°n c√≥ th·∫•y func **getGravity** func n√†y n·∫±m trong **submitListNewData** m·ª•c ƒë√≠ch c·ªßa n√≥ l√† mu·ªën get gravity c·ªßa t·ª´ng item trong recycleView, nh∆∞ ·∫£nh ·ªü ƒë·∫ßu b√†i ch√∫ng ta c√≥ 5 item chia l√†m 2 h√†ng, h√†ng ƒë·∫ßu ti√™n c√≥ 3 item, h√†ng th·ª© 2 c√≥ 2 item. T·∫°i h√†ng th·ª© 2 ch√∫ng ta mu·ªën th·∫•y item ƒë·∫ßu ti√™n n√≥ hi·ªÉn th·ªã b√™n ph·∫£i -> t·∫°i item n√†y ch√∫ng ta ph·∫£i set marginEnd cho n√≥, ti·∫øp theo item th·ª© hai ch√∫ng ta mu·ªën hi·ªÉn th·ªã b√™n tr√°i -> t·∫°i item n√†y ch√∫ng ta ph·∫£i set marginStart cho n√≥. 

C√°c b·∫°n c√≥ th·ªÉ th·∫•y ch√∫ng ta ƒë√£ set **setspanSizeLookUp** v√† ƒëi·ªÅu n√†y d·∫´n t·ªõi h√†ng th·ª© 2 n√≥ chi·∫øm ƒë∆∞·ª£c b·ªë c·ª•c nh∆∞ v·∫≠y ƒë√≥, c√°c b·∫°n c√πng xem file custom **SpanSizeLookUp** d∆∞·ªõi ƒë√¢y

```
class ItemSpanSizeLookup(private val adapter: ItemsAdapter) : GridLayoutManager.SpanSizeLookup() {
    override fun getSpanSize(position: Int): Int {
        val realSpanCount = 3
        val fullRow = adapter.itemCount / realSpanCount + 1
        if (adapter.itemCount % 3 == 0) {
            return 2
        }
        if ((position.toDouble()) / realSpanCount.toDouble() >= (fullRow - 1)) {
            if (adapter.currentList.size % 3 == 1) {
                return 6
            }
            if ((position + 1) % 3 == 1 || (position + 1) % 3 == 2) {
                return 3
            }
        }
        return 2
    }
}
```

√ù t∆∞·ªüng c·ªßa **SpanSizeLookup** l√† trong m·ªôt h√†ng t√πy v√†o tr∆∞·ªùng h·ª£p m√† chia ph·∫ßn trƒÉm chi·∫øm cho **itemView**. Trong acitivity ch√∫ng ta set spanCount = 6 c√≥ nghƒ©a l√† 1 d√≤ng n√≥ chia ra l√†m 6 ph·∫ßn. ·ªû class **ItemSpanSizeLookup** ch√∫ng ta k·∫ø th·ª´a **GridLayoutManager.SpanSizeLookup()**  v√† override  **getSpanSize(position: Int)** ƒë·ªÉ ch·ªâ ƒë·ªãnh s·ªë ph·∫ßn m√† item mu·ªën chi·∫øm h·ªØu. Logic tr√™n m√¥ t·∫£ r·∫±ng n·∫øu ƒë√≥ l√† h√†ng cu·ªëi c√πng: H√†ng ƒë√≥ ch·ª©a 1 item th√¨ item ƒë√≥ s·∫Ω chi·∫øm 6 ph·∫ßn; H√†ng ƒë√≥ c√≥ 2 item th√¨ m·ªói item s·∫Ω chi·∫øm 3 ph·∫ßn; H√†ng ƒë√≥ ch·ª©a 3 iten th√¨ m·ªói item s·∫Ω chi·∫øm 2 ph·∫ßn. Ch√∫ng ta c·∫ßn ƒë·ªãnh nghƒ©a nh∆∞ th·∫ø n√†y ƒë·ªÉ c√≥ th·ªÉ c√¢n ƒë·ªëi ƒë∆∞·ª£c b·ªë c·ª•c layout. 

![image.png](https://images.viblo.asia/09848a6b-5f30-4242-9258-3f7c8bae1154.png)

K·∫øt h·ª£p v·ªõi set gravity ch√∫ng ta ƒë·∫°t ƒë∆∞·ª£c h√¨nh sau ƒë√¢y

![image.png](https://images.viblo.asia/d997495c-e668-42af-afc9-de3b51a67081.png)

T·ªõi ƒë√¢y nh√¨n chung ƒë√£ gi·∫£i quy·∫øt th√†nh c√¥ng vi·ªác center item d√≤ng cu·ªëi trong recycleview. M·∫•u ch·ªët c·ªßa vi·ªác tri·ªÉn khai n√†y c·∫ßn x√°c ƒëinh % m√† item chi·∫øm h·ªØu tr√™n m·ªôt h√†ng  v√† d·ª±a v√†o s·ªë l∆∞·ª£ng item m√† t√≠nh to√°n v√† set gravity cho n√≥. C√°c b·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a theo m·ªói nhu c·∫ßu d·ª± √°n, c√≥ th·ªÉ apply nhi·ªÅu tr∆∞·ªùng h·ª£p h∆°n v√≠ d·ª• 2 h√†ng cu·ªëi t·∫•t c·∫£ item center, 3 h√†ng cu·ªëi t·∫•t c·∫£ item center,... nh·ªØng y√™u c·∫ßu li√™n quan ƒë·∫øn item center. ƒê·ªëi v·ªõi m√†n h√¨nh landscape n·∫øu c√°c b·∫°n c·∫ßn s·ªë l∆∞·ª£ng item tr√™n m·ªôt h√†ng kh√°c v∆°i portraint, nh∆∞ng v·∫´n gi·ªØ ƒë∆∞·ª£c center th√¨ m√¨nh g√≥p √Ω c√°c b·∫°n n√™n t·∫°o ra 2 file ItemSpanSizeLookup, 1 file apply khi portraint, 1 file apply khi landscape. N√≥ s·∫Ω d·ªÖ h√†ng h∆°n n·∫øu ch√∫ng ta t·∫°o m·ªôt file v√† ph·∫£i check if else.

ƒê·∫øn ƒë√¢y b√†i chia s·∫ª c·ªßa m√¨nh ƒë√£ k·∫øt th√∫c, c√°c b·∫°n c√≥ th·∫Øc m·∫Øc g√¨, ch∆∞a hi·ªÉu ch·ªó n√†o v√† c·∫ßn bi·∫øt th√™m nh·ªØng g√¨ th√¨ c√°c b·∫°n b√¨nh lu·∫≠n cho m√¨nh bi·∫øt v·ªõi nha, v√† b√†i vi·∫øt c·ªßa m√¨nh c√≥ ƒë·ªông v√†o tr√°i tim th√¨ cho m√¨nh 1 vote ƒë·ªÉ ·ªßng h·ªô tinh th·∫ßn h√¨ h√¨. C·∫£m ∆°n c√°c b·∫°n üòä

Link code: https://github.com/nambmt97s/CenterItemLastRowRecycleView